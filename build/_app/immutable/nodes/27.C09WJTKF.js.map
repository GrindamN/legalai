{"version":3,"file":"27.C09WJTKF.js","sources":["../../../../../../src/routes/s/[id]/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\r\n\timport { onMount, tick, getContext } from 'svelte';\r\n\timport { goto } from '$app/navigation';\r\n\timport { page } from '$app/stores';\r\n\r\n\timport dayjs from 'dayjs';\r\n\r\n\timport { settings, chatId, WEBUI_NAME, models } from '$lib/stores';\r\n\timport { convertMessagesToHistory } from '$lib/utils';\r\n\r\n\timport { getChatByShareId } from '$lib/apis/chats';\r\n\r\n\timport Messages from '$lib/components/chat/Messages.svelte';\r\n\timport Navbar from '$lib/components/layout/Navbar.svelte';\r\n\timport { getUserById } from '$lib/apis/users';\r\n\timport { error } from '@sveltejs/kit';\r\n\timport { getModels } from '$lib/apis';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\tlet loaded = false;\r\n\r\n\tlet autoScroll = true;\r\n\tlet processing = '';\r\n\tlet messagesContainerElement: HTMLDivElement;\r\n\r\n\t// let chatId = $page.params.id;\r\n\tlet showModelSelector = false;\r\n\tlet selectedModels = [''];\r\n\r\n\tlet chat = null;\r\n\tlet user = null;\r\n\r\n\tlet title = '';\r\n\tlet files = [];\r\n\r\n\tlet messages = [];\r\n\tlet history = {\r\n\t\tmessages: {},\r\n\t\tcurrentId: null\r\n\t};\r\n\r\n\t$: if (history.currentId !== null) {\r\n\t\tlet _messages = [];\r\n\r\n\t\tlet currentMessage = history.messages[history.currentId];\r\n\t\twhile (currentMessage !== null) {\r\n\t\t\t_messages.unshift({ ...currentMessage });\r\n\t\t\tcurrentMessage =\r\n\t\t\t\tcurrentMessage.parentId !== null ? history.messages[currentMessage.parentId] : null;\r\n\t\t}\r\n\t\tmessages = _messages;\r\n\t} else {\r\n\t\tmessages = [];\r\n\t}\r\n\r\n\t$: if ($page.params.id) {\r\n\t\t(async () => {\r\n\t\t\tif (await loadSharedChat()) {\r\n\t\t\t\tawait tick();\r\n\t\t\t\tloaded = true;\r\n\t\t\t} else {\r\n\t\t\t\tawait goto('/');\r\n\t\t\t}\r\n\t\t})();\r\n\t}\r\n\r\n\t//////////////////////////\r\n\t// Web functions\r\n\t//////////////////////////\r\n\r\n\tconst loadSharedChat = async () => {\r\n\t\tawait models.set(await getModels(localStorage.token));\r\n\t\tawait chatId.set($page.params.id);\r\n\t\tchat = await getChatByShareId(localStorage.token, $chatId).catch(async (error) => {\r\n\t\t\tawait goto('/');\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (chat) {\r\n\t\t\tuser = await getUserById(localStorage.token, chat.user_id).catch((error) => {\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\r\n\t\t\tconst chatContent = chat.chat;\r\n\r\n\t\t\tif (chatContent) {\r\n\t\t\t\tconsole.log(chatContent);\r\n\r\n\t\t\t\tselectedModels =\r\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\r\n\t\t\t\t\t\t? chatContent.models\r\n\t\t\t\t\t\t: [chatContent.models ?? ''];\r\n\t\t\t\thistory =\r\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\r\n\t\t\t\t\t\t? chatContent.history\r\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\r\n\t\t\t\ttitle = chatContent.title;\r\n\r\n\t\t\t\tautoScroll = true;\r\n\t\t\t\tawait tick();\r\n\r\n\t\t\t\tif (messages.length > 0) {\r\n\t\t\t\t\thistory.messages[messages.at(-1).id].done = true;\r\n\t\t\t\t}\r\n\t\t\t\tawait tick();\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<svelte:head>\r\n\t<title>\r\n\t\t{title\r\n\t\t\t? `${title.length > 30 ? `${title.slice(0, 30)}...` : title} | ${$WEBUI_NAME}`\r\n\t\t\t: `${$WEBUI_NAME}`}\r\n\t</title>\r\n</svelte:head>\r\n\r\n{#if loaded}\r\n\t<div\r\n\t\tclass=\"min-h-screen max-h-screen w-full flex flex-col text-gray-700 dark:text-gray-100 bg-white dark:bg-gray-900\"\r\n\t>\r\n\t\t<div class=\"flex flex-col flex-auto justify-center py-8\">\r\n\t\t\t<div class=\"px-3 w-full max-w-5xl mx-auto\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<div class=\" text-3xl font-semibold line-clamp-1\">\r\n\t\t\t\t\t\t{title}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\" mt-1 text-gray-400\">\r\n\t\t\t\t\t\t{dayjs(chat.chat.timestamp).format($i18n.t('MMMM DD, YYYY'))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<hr class=\" dark:border-gray-800 mt-6 mb-2\" />\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\" flex flex-col w-full flex-auto overflow-auto h-0\" id=\"messages-container\">\r\n\t\t\t\t<div class=\" h-full w-full flex flex-col py-4\">\r\n\t\t\t\t\t<div class=\"py-2\">\r\n\t\t\t\t\t\t<Messages\r\n\t\t\t\t\t\t\t{user}\r\n\t\t\t\t\t\t\tchatId={$chatId}\r\n\t\t\t\t\t\t\treadOnly={true}\r\n\t\t\t\t\t\t\t{selectedModels}\r\n\t\t\t\t\t\t\t{processing}\r\n\t\t\t\t\t\t\tbind:history\r\n\t\t\t\t\t\t\tbind:messages\r\n\t\t\t\t\t\t\tbind:autoScroll\r\n\t\t\t\t\t\t\tbottomPadding={files.length > 0}\r\n\t\t\t\t\t\t\tsendPrompt={() => {}}\r\n\t\t\t\t\t\t\tcontinueGeneration={() => {}}\r\n\t\t\t\t\t\t\tregenerateResponse={() => {}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n"],"names":["t2_value","dayjs","ctx","insert_hydration","target","div8","anchor","append_hydration","div7","div3","div2","div0","div1","hr","div6","div5","div4","current","dirty","set_data","t2","create_if_block","processing","i18n","getContext","loaded","autoScroll","selectedModels","chat","user","title","files","messages","history","loadSharedChat","models","getModels","chatId","$page","$$invalidate","getChatByShareId","$chatId","error","goto","getUserById","chatContent","convertMessagesToHistory","tick","_messages","currentMessage"],"mappings":"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"}