{"version":3,"file":"ToolkitEditor.Dye3L0GK.js","sources":["../../../../../../src/lib/components/workspace/Tools/ToolkitEditor.svelte"],"sourcesContent":["<script>\r\n\timport { getContext, createEventDispatcher, onMount } from 'svelte';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\timport CodeEditor from '$lib/components/common/CodeEditor.svelte';\r\n\timport { goto } from '$app/navigation';\r\n\timport ConfirmDialog from '$lib/components/common/ConfirmDialog.svelte';\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\tlet formElement = null;\r\n\tlet loading = false;\r\n\tlet showConfirm = false;\r\n\r\n\texport let edit = false;\r\n\texport let clone = false;\r\n\r\n\texport let id = '';\r\n\texport let name = '';\r\n\texport let meta = {\r\n\t\tdescription: ''\r\n\t};\r\n\texport let content = '';\r\n\r\n\t$: if (name && !edit && !clone) {\r\n\t\tid = name.replace(/\\s+/g, '_').toLowerCase();\r\n\t}\r\n\r\n\tlet codeEditor;\r\n\tlet boilerplate = `import os\r\nimport requests\r\nfrom datetime import datetime\r\n\r\n\r\nclass Tools:\r\n    def __init__(self):\r\n        pass\r\n\r\n    # Add your custom tools using pure Python code here, make sure to add type hints\r\n    # Use Sphinx-style docstrings to document your tools, they will be used for generating tools specifications\r\n    # Please refer to function_calling_filter_pipeline.py file from pipelines project for an example\r\n\r\n    def get_user_name_and_email_and_id(self, __user__: dict = {}) -> str:\r\n        \"\"\"\r\n        Get the user name, Email and ID from the user object.\r\n        \"\"\"\r\n\r\n        # Do not include :param for __user__ in the docstring as it should not be shown in the tool's specification\r\n        # The session user object will be passed as a parameter when the function is called\r\n\r\n        print(__user__)\r\n        result = \"\"\r\n\r\n        if \"name\" in __user__:\r\n            result += f\"User: {__user__['name']}\"\r\n        if \"id\" in __user__:\r\n            result += f\" (ID: {__user__['id']})\"\r\n        if \"email\" in __user__:\r\n            result += f\" (Email: {__user__['email']})\"\r\n\r\n        if result == \"\":\r\n            result = \"User: Unknown\"\r\n\r\n        return result\r\n\r\n    def get_current_time(self) -> str:\r\n        \"\"\"\r\n        Get the current time in a more human-readable format.\r\n        :return: The current time.\r\n        \"\"\"\r\n\r\n        now = datetime.now()\r\n        current_time = now.strftime(\"%I:%M:%S %p\")  # Using 12-hour format with AM/PM\r\n        current_date = now.strftime(\r\n            \"%A, %B %d, %Y\"\r\n        )  # Full weekday, month name, day, and year\r\n\r\n        return f\"Current Date and Time = {current_date}, {current_time}\"\r\n\r\n    def calculator(self, equation: str) -> str:\r\n        \"\"\"\r\n        Calculate the result of an equation.\r\n        :param equation: The equation to calculate.\r\n        \"\"\"\r\n\r\n        # Avoid using eval in production code\r\n        # https://nedbatchelder.com/blog/201206/eval_really_is_dangerous.html\r\n        try:\r\n            result = eval(equation)\r\n            return f\"{equation} = {result}\"\r\n        except Exception as e:\r\n            print(e)\r\n            return \"Invalid equation\"\r\n\r\n    def get_current_weather(self, city: str) -> str:\r\n        \"\"\"\r\n        Get the current weather for a given city.\r\n        :param city: The name of the city to get the weather for.\r\n        :return: The current weather information or an error message.\r\n        \"\"\"\r\n        api_key = os.getenv(\"OPENWEATHER_API_KEY\")\r\n        if not api_key:\r\n            return (\r\n                \"API key is not set in the environment variable 'OPENWEATHER_API_KEY'.\"\r\n            )\r\n\r\n        base_url = \"http://api.openweathermap.org/data/2.5/weather\"\r\n        params = {\r\n            \"q\": city,\r\n            \"appid\": api_key,\r\n            \"units\": \"metric\",  # Optional: Use 'imperial' for Fahrenheit\r\n        }\r\n\r\n        try:\r\n            response = requests.get(base_url, params=params)\r\n            response.raise_for_status()  # Raise HTTPError for bad responses (4xx and 5xx)\r\n            data = response.json()\r\n\r\n            if data.get(\"cod\") != 200:\r\n                return f\"Error fetching weather data: {data.get('message')}\"\r\n\r\n            weather_description = data[\"weather\"][0][\"description\"]\r\n            temperature = data[\"main\"][\"temp\"]\r\n            humidity = data[\"main\"][\"humidity\"]\r\n            wind_speed = data[\"wind\"][\"speed\"]\r\n\r\n            return f\"Weather in {city}: {temperature}°C\"\r\n        except requests.RequestException as e:\r\n            return f\"Error fetching weather data: {str(e)}\"\r\n`;\r\n\r\n\tconst saveHandler = async () => {\r\n\t\tloading = true;\r\n\t\tdispatch('save', {\r\n\t\t\tid,\r\n\t\t\tname,\r\n\t\t\tmeta,\r\n\t\t\tcontent\r\n\t\t});\r\n\t};\r\n\r\n\tconst submitHandler = async () => {\r\n\t\tif (codeEditor) {\r\n\t\t\tconst res = await codeEditor.formatPythonCodeHandler();\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tconsole.log('Code formatted successfully');\r\n\t\t\t\tsaveHandler();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<div class=\" flex flex-col justify-between w-full overflow-y-auto h-full\">\r\n\t<div class=\"mx-auto w-full md:px-0 h-full\">\r\n\t\t<form\r\n\t\t\tbind:this={formElement}\r\n\t\t\tclass=\" flex flex-col max-h-[100dvh] h-full\"\r\n\t\t\ton:submit|preventDefault={() => {\r\n\t\t\t\tif (edit) {\r\n\t\t\t\t\tsubmitHandler();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshowConfirm = true;\r\n\t\t\t\t}\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<div class=\"mb-2.5\">\r\n\t\t\t\t<button\r\n\t\t\t\t\tclass=\"flex space-x-1\"\r\n\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\tgoto('/workspace/tools');\r\n\t\t\t\t\t}}\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div class=\" self-center\">\r\n\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\tclass=\"w-4 h-4\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\td=\"M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z\"\r\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\" self-center font-medium text-sm\">{$i18n.t('Back')}</div>\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"flex flex-col flex-1 overflow-auto h-0 rounded-lg\">\r\n\t\t\t\t<div class=\"w-full mb-2 flex flex-col gap-1.5\">\r\n\t\t\t\t\t<div class=\"flex gap-2 w-full\">\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\tclass=\"w-full px-3 py-2 text-sm font-medium bg-gray-50 dark:bg-gray-850 dark:text-gray-200 rounded-lg outline-none\"\r\n\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Toolkit Name (e.g. My ToolKit)')}\r\n\t\t\t\t\t\t\tbind:value={name}\r\n\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\tclass=\"w-full px-3 py-2 text-sm font-medium disabled:text-gray-300 dark:disabled:text-gray-700 bg-gray-50 dark:bg-gray-850 dark:text-gray-200 rounded-lg outline-none\"\r\n\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Toolkit ID (e.g. my_toolkit)')}\r\n\t\t\t\t\t\t\tbind:value={id}\r\n\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\tdisabled={edit}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tclass=\"w-full px-3 py-2 text-sm font-medium bg-gray-50 dark:bg-gray-850 dark:text-gray-200 rounded-lg outline-none\"\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tplaceholder={$i18n.t(\r\n\t\t\t\t\t\t\t'Toolkit Description (e.g. A toolkit for performing various operations)'\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\tbind:value={meta.description}\r\n\t\t\t\t\t\trequired\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"mb-2 flex-1 overflow-auto h-0 rounded-lg\">\r\n\t\t\t\t\t<CodeEditor\r\n\t\t\t\t\t\tbind:value={content}\r\n\t\t\t\t\t\tbind:this={codeEditor}\r\n\t\t\t\t\t\t{boilerplate}\r\n\t\t\t\t\t\ton:save={() => {\r\n\t\t\t\t\t\t\tif (formElement) {\r\n\t\t\t\t\t\t\t\tformElement.requestSubmit();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"pb-3 flex justify-between\">\r\n\t\t\t\t\t<div class=\"flex-1 pr-3\">\r\n\t\t\t\t\t\t<div class=\"text-xs text-gray-500 line-clamp-2\">\r\n\t\t\t\t\t\t\t<span class=\" font-semibold dark:text-gray-200\">{$i18n.t('Warning:')}</span>\r\n\t\t\t\t\t\t\t{$i18n.t('Tools are a function calling system with arbitrary code execution')} <br />—\r\n\t\t\t\t\t\t\t<span class=\" font-medium dark:text-gray-400\"\r\n\t\t\t\t\t\t\t\t>{$i18n.t(`don't install random tools from sources you don't trust.`)}</span\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tclass=\"px-3 py-1.5 text-sm font-medium bg-emerald-600 hover:bg-emerald-700 text-gray-50 transition rounded-lg\"\r\n\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{$i18n.t('Save')}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</form>\r\n\t</div>\r\n</div>\r\n\r\n<ConfirmDialog\r\n\tbind:show={showConfirm}\r\n\ton:confirm={() => {\r\n\t\tsubmitHandler();\r\n\t}}\r\n>\r\n\t<div class=\"text-sm text-gray-500\">\r\n\t\t<div class=\" bg-yellow-500/20 text-yellow-700 dark:text-yellow-200 rounded-lg px-4 py-3\">\r\n\t\t\t<div>{$i18n.t('Please carefully review the following warnings:')}</div>\r\n\r\n\t\t\t<ul class=\" mt-1 list-disc pl-4 text-xs\">\r\n\t\t\t\t<li>\r\n\t\t\t\t\t{$i18n.t('Tools have a function calling system that allows arbitrary code execution.')}\r\n\t\t\t\t</li>\r\n\t\t\t\t<li>{$i18n.t('Do not install tools from sources you do not fully trust.')}</li>\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"my-3\">\r\n\t\t\t{$i18n.t(\r\n\t\t\t\t'I acknowledge that I have read and I understand the implications of my action. I am aware of the risks associated with executing arbitrary code and I have verified the trustworthiness of the source.'\r\n\t\t\t)}\r\n\t\t</div>\r\n\t</div>\r\n</ConfirmDialog>\r\n"],"names":["ctx","insert_hydration","target","div3","anchor","append_hydration","div1","div0","ul","li0","li1","div2","set_data","t0","t0_value","t2","t2_value","t4","t4_value","t6","t6_value","t12_value","div11","div10","form","button0","div9","div4","input0","input1","input2","set_input_value","div5","div8","div7","div6","span0","br","span1","button1","t1","t1_value","dirty","t7","t7_value","t9","t9_value","current","t12","t14","t14_value","i18n","getContext","dispatch","createEventDispatcher","formElement","showConfirm","edit","$$props","clone","id","name","meta","content","codeEditor","boilerplate","saveHandler","submitHandler","goto","value","$$value","$$invalidate"],"mappings":"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"}