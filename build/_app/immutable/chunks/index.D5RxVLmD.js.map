{"version":3,"file":"index.D5RxVLmD.js","sources":["../../../../../../node_modules/uuid/dist/esm-browser/rng.js","../../../../../../node_modules/uuid/dist/esm-browser/stringify.js","../../../../../../node_modules/uuid/dist/esm-browser/native.js","../../../../../../node_modules/uuid/dist/esm-browser/v4.js","../../../../../../src/lib/types/index.ts","../../../../../../src/lib/utils/index.ts"],"sourcesContent":["// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]];\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","export type Banner = {\r\n\tid: string;\r\n\ttype: string;\r\n\ttitle?: string;\r\n\tcontent: string;\r\n\turl?: string;\r\n\tdismissible?: boolean;\r\n\ttimestamp: number;\r\n};\r\n\r\nexport enum TTS_RESPONSE_SPLIT {\r\n\tPUNCTUATION = 'punctuation',\r\n\tPARAGRAPHS = 'paragraphs',\r\n\tNONE = 'none'\r\n}\r\n","import { v4 as uuidv4 } from 'uuid';\r\nimport sha256 from 'js-sha256';\r\n\r\nimport { WEBUI_BASE_URL } from '$lib/constants';\r\nimport { TTS_RESPONSE_SPLIT } from '$lib/types';\r\n\r\n//////////////////////////\r\n// Helper functions\r\n//////////////////////////\r\n\r\nconst convertLatexToSingleLine = (content) => {\r\n\t// Patterns to match multiline LaTeX blocks\r\n\tconst patterns = [\r\n\t\t/(\\$\\$\\s[\\s\\S]*?\\s\\$\\$)/g, // Match $$ ... $$\r\n\t\t/(\\\\\\[[\\s\\S]*?\\\\\\])/g, // Match \\[ ... \\]\r\n\t\t/(\\\\begin\\{[a-z]+\\}[\\s\\S]*?\\\\end\\{[a-z]+\\})/g // Match \\begin{...} ... \\end{...}\r\n\t];\r\n\r\n\tpatterns.forEach((pattern) => {\r\n\t\tcontent = content.replace(pattern, (match) => {\r\n\t\t\treturn match.replace(/\\s*\\n\\s*/g, ' ').trim();\r\n\t\t});\r\n\t});\r\n\r\n\treturn content;\r\n};\r\n\r\nexport const replaceTokens = (content, char, user) => {\r\n\tconst charToken = /{{char}}/gi;\r\n\tconst userToken = /{{user}}/gi;\r\n\tconst videoIdToken = /{{VIDEO_FILE_ID_([a-f0-9-]+)}}/gi; // Regex to capture the video ID\r\n\tconst htmlIdToken = /{{HTML_FILE_ID_([a-f0-9-]+)}}/gi; // Regex to capture the HTML ID\r\n\r\n\t// Replace {{char}} if char is provided\r\n\tif (char !== undefined && char !== null) {\r\n\t\tcontent = content.replace(charToken, char);\r\n\t}\r\n\r\n\t// Replace {{user}} if user is provided\r\n\tif (user !== undefined && user !== null) {\r\n\t\tcontent = content.replace(userToken, user);\r\n\t}\r\n\r\n\t// Replace video ID tags with corresponding <video> elements\r\n\tcontent = content.replace(videoIdToken, (match, fileId) => {\r\n\t\tconst videoUrl = `${WEBUI_BASE_URL}/api/v1/files/${fileId}/content`;\r\n\t\treturn `<video src=\"${videoUrl}\" controls></video>`;\r\n\t});\r\n\r\n\t// Replace HTML ID tags with corresponding HTML content\r\n\tcontent = content.replace(htmlIdToken, (match, fileId) => {\r\n\t\tconst htmlUrl = `${WEBUI_BASE_URL}/api/v1/files/${fileId}/content`;\r\n\t\treturn `<iframe src=\"${htmlUrl}\" width=\"100%\" frameborder=\"0\" onload=\"this.style.height=(this.contentWindow.document.body.scrollHeight+20)+'px';\"></iframe>`;\r\n\t});\r\n\r\n\treturn content;\r\n};\r\n\r\nexport const sanitizeResponseContent = (content: string) => {\r\n\treturn content\r\n\t\t.replace(/<\\|[a-z]*$/, '')\r\n\t\t.replace(/<\\|[a-z]+\\|$/, '')\r\n\t\t.replace(/<$/, '')\r\n\t\t.replaceAll(/<\\|[a-z]+\\|>/g, ' ')\r\n\t\t.replaceAll('<', '&lt;')\r\n\t\t.replaceAll('>', '&gt;')\r\n\t\t.trim();\r\n};\r\n\r\nexport const processResponseContent = (content: string) => {\r\n\tcontent = convertLatexToSingleLine(content);\r\n\treturn content.trim();\r\n};\r\n\r\nexport const revertSanitizedResponseContent = (content: string) => {\r\n\treturn content.replaceAll('&lt;', '<').replaceAll('&gt;', '>');\r\n};\r\n\r\nexport function unescapeHtml(html: string) {\r\n\tconst doc = new DOMParser().parseFromString(html, 'text/html');\r\n\treturn doc.documentElement.textContent;\r\n}\r\n\r\nexport const capitalizeFirstLetter = (string) => {\r\n\treturn string.charAt(0).toUpperCase() + string.slice(1);\r\n};\r\n\r\nexport const splitStream = (splitOn) => {\r\n\tlet buffer = '';\r\n\treturn new TransformStream({\r\n\t\ttransform(chunk, controller) {\r\n\t\t\tbuffer += chunk;\r\n\t\t\tconst parts = buffer.split(splitOn);\r\n\t\t\tparts.slice(0, -1).forEach((part) => controller.enqueue(part));\r\n\t\t\tbuffer = parts[parts.length - 1];\r\n\t\t},\r\n\t\tflush(controller) {\r\n\t\t\tif (buffer) controller.enqueue(buffer);\r\n\t\t}\r\n\t});\r\n};\r\n\r\nexport const convertMessagesToHistory = (messages) => {\r\n\tconst history = {\r\n\t\tmessages: {},\r\n\t\tcurrentId: null\r\n\t};\r\n\r\n\tlet parentMessageId = null;\r\n\tlet messageId = null;\r\n\r\n\tfor (const message of messages) {\r\n\t\tmessageId = uuidv4();\r\n\r\n\t\tif (parentMessageId !== null) {\r\n\t\t\thistory.messages[parentMessageId].childrenIds = [\r\n\t\t\t\t...history.messages[parentMessageId].childrenIds,\r\n\t\t\t\tmessageId\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\thistory.messages[messageId] = {\r\n\t\t\t...message,\r\n\t\t\tid: messageId,\r\n\t\t\tparentId: parentMessageId,\r\n\t\t\tchildrenIds: []\r\n\t\t};\r\n\r\n\t\tparentMessageId = messageId;\r\n\t}\r\n\r\n\thistory.currentId = messageId;\r\n\treturn history;\r\n};\r\n\r\nexport const getGravatarURL = (email) => {\r\n\t// Trim leading and trailing whitespace from\r\n\t// an email address and force all characters\r\n\t// to lower case\r\n\tconst address = String(email).trim().toLowerCase();\r\n\r\n\t// Create a SHA256 hash of the final string\r\n\tconst hash = sha256(address);\r\n\r\n\t// Grab the actual image URL\r\n\treturn `https://www.gravatar.com/avatar/${hash}`;\r\n};\r\n\r\nexport const canvasPixelTest = () => {\r\n\t// Test a 1x1 pixel to potentially identify browser/plugin fingerprint blocking or spoofing\r\n\t// Inspiration: https://github.com/kkapsner/CanvasBlocker/blob/master/test/detectionTest.js\r\n\tconst canvas = document.createElement('canvas');\r\n\tconst ctx = canvas.getContext('2d');\r\n\tcanvas.height = 1;\r\n\tcanvas.width = 1;\r\n\tconst imageData = new ImageData(canvas.width, canvas.height);\r\n\tconst pixelValues = imageData.data;\r\n\r\n\t// Generate RGB test data\r\n\tfor (let i = 0; i < imageData.data.length; i += 1) {\r\n\t\tif (i % 4 !== 3) {\r\n\t\t\tpixelValues[i] = Math.floor(256 * Math.random());\r\n\t\t} else {\r\n\t\t\tpixelValues[i] = 255;\r\n\t\t}\r\n\t}\r\n\r\n\tctx.putImageData(imageData, 0, 0);\r\n\tconst p = ctx.getImageData(0, 0, canvas.width, canvas.height).data;\r\n\r\n\t// Read RGB data and fail if unmatched\r\n\tfor (let i = 0; i < p.length; i += 1) {\r\n\t\tif (p[i] !== pixelValues[i]) {\r\n\t\t\tconsole.log(\r\n\t\t\t\t'canvasPixelTest: Wrong canvas pixel RGB value detected:',\r\n\t\t\t\tp[i],\r\n\t\t\t\t'at:',\r\n\t\t\t\ti,\r\n\t\t\t\t'expected:',\r\n\t\t\t\tpixelValues[i]\r\n\t\t\t);\r\n\t\t\tconsole.log('canvasPixelTest: Canvas blocking or spoofing is likely');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\nexport const generateInitialsImage = (name) => {\r\n\tconst canvas = document.createElement('canvas');\r\n\tconst ctx = canvas.getContext('2d');\r\n\tcanvas.width = 100;\r\n\tcanvas.height = 100;\r\n\r\n\tif (!canvasPixelTest()) {\r\n\t\tconsole.log(\r\n\t\t\t'generateInitialsImage: failed pixel test, fingerprint evasion is likely. Using default image.'\r\n\t\t);\r\n\t\treturn '/user.png';\r\n\t}\r\n\r\n\tctx.fillStyle = '#F39C12';\r\n\tctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n\tctx.fillStyle = '#FFFFFF';\r\n\tctx.font = '40px Helvetica';\r\n\tctx.textAlign = 'center';\r\n\tctx.textBaseline = 'middle';\r\n\r\n\tconst sanitizedName = name.trim();\r\n\tconst initials =\r\n\t\tsanitizedName.length > 0\r\n\t\t\t? sanitizedName[0] +\r\n\t\t\t\t(sanitizedName.split(' ').length > 1\r\n\t\t\t\t\t? sanitizedName[sanitizedName.lastIndexOf(' ') + 1]\r\n\t\t\t\t\t: '')\r\n\t\t\t: '';\r\n\r\n\tctx.fillText(initials.toUpperCase(), canvas.width / 2, canvas.height / 2);\r\n\r\n\treturn canvas.toDataURL();\r\n};\r\n\r\nexport const copyToClipboard = async (text) => {\r\n\tlet result = false;\r\n\tif (!navigator.clipboard) {\r\n\t\tconst textArea = document.createElement('textarea');\r\n\t\ttextArea.value = text;\r\n\r\n\t\t// Avoid scrolling to bottom\r\n\t\ttextArea.style.top = '0';\r\n\t\ttextArea.style.left = '0';\r\n\t\ttextArea.style.position = 'fixed';\r\n\r\n\t\tdocument.body.appendChild(textArea);\r\n\t\ttextArea.focus();\r\n\t\ttextArea.select();\r\n\r\n\t\ttry {\r\n\t\t\tconst successful = document.execCommand('copy');\r\n\t\t\tconst msg = successful ? 'successful' : 'unsuccessful';\r\n\t\t\tconsole.log('Fallback: Copying text command was ' + msg);\r\n\t\t\tresult = true;\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error('Fallback: Oops, unable to copy', err);\r\n\t\t}\r\n\r\n\t\tdocument.body.removeChild(textArea);\r\n\t\treturn result;\r\n\t}\r\n\r\n\tresult = await navigator.clipboard\r\n\t\t.writeText(text)\r\n\t\t.then(() => {\r\n\t\t\tconsole.log('Async: Copying to clipboard was successful!');\r\n\t\t\treturn true;\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tconsole.error('Async: Could not copy text: ', error);\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\treturn result;\r\n};\r\n\r\nexport const compareVersion = (latest, current) => {\r\n\treturn current === '0.0.0'\r\n\t\t? false\r\n\t\t: current.localeCompare(latest, undefined, {\r\n\t\t\t\tnumeric: true,\r\n\t\t\t\tsensitivity: 'case',\r\n\t\t\t\tcaseFirst: 'upper'\r\n\t\t\t}) < 0;\r\n};\r\n\r\nexport const findWordIndices = (text) => {\r\n\tconst regex = /\\[([^\\]]+)\\]/g;\r\n\tconst matches = [];\r\n\tlet match;\r\n\r\n\twhile ((match = regex.exec(text)) !== null) {\r\n\t\tmatches.push({\r\n\t\t\tword: match[1],\r\n\t\t\tstartIndex: match.index,\r\n\t\t\tendIndex: regex.lastIndex - 1\r\n\t\t});\r\n\t}\r\n\r\n\treturn matches;\r\n};\r\n\r\nexport const removeLastWordFromString = (inputString, wordString) => {\r\n\t// Split the string into an array of words\r\n\tconst words = inputString.split(' ');\r\n\r\n\tif (words.at(-1) === wordString) {\r\n\t\twords.pop();\r\n\t}\r\n\r\n\t// Join the remaining words back into a string\r\n\tlet resultString = words.join(' ');\r\n\tif (resultString !== '') {\r\n\t\tresultString += ' ';\r\n\t}\r\n\r\n\treturn resultString;\r\n};\r\n\r\nexport const removeFirstHashWord = (inputString) => {\r\n\t// Split the string into an array of words\r\n\tconst words = inputString.split(' ');\r\n\r\n\t// Find the index of the first word that starts with #\r\n\tconst index = words.findIndex((word) => word.startsWith('#'));\r\n\r\n\t// Remove the first word with #\r\n\tif (index !== -1) {\r\n\t\twords.splice(index, 1);\r\n\t}\r\n\r\n\t// Join the remaining words back into a string\r\n\tconst resultString = words.join(' ');\r\n\r\n\treturn resultString;\r\n};\r\n\r\nexport const transformFileName = (fileName) => {\r\n\t// Convert to lowercase\r\n\tconst lowerCaseFileName = fileName.toLowerCase();\r\n\r\n\t// Remove special characters using regular expression\r\n\tconst sanitizedFileName = lowerCaseFileName.replace(/[^\\w\\s]/g, '');\r\n\r\n\t// Replace spaces with dashes\r\n\tconst finalFileName = sanitizedFileName.replace(/\\s+/g, '-');\r\n\r\n\treturn finalFileName;\r\n};\r\n\r\nexport const calculateSHA256 = async (file) => {\r\n\t// Create a FileReader to read the file asynchronously\r\n\tconst reader = new FileReader();\r\n\r\n\t// Define a promise to handle the file reading\r\n\tconst readFile = new Promise((resolve, reject) => {\r\n\t\treader.onload = () => resolve(reader.result);\r\n\t\treader.onerror = reject;\r\n\t});\r\n\r\n\t// Read the file as an ArrayBuffer\r\n\treader.readAsArrayBuffer(file);\r\n\r\n\ttry {\r\n\t\t// Wait for the FileReader to finish reading the file\r\n\t\tconst buffer = await readFile;\r\n\r\n\t\t// Convert the ArrayBuffer to a Uint8Array\r\n\t\tconst uint8Array = new Uint8Array(buffer);\r\n\r\n\t\t// Calculate the SHA-256 hash using Web Crypto API\r\n\t\tconst hashBuffer = await crypto.subtle.digest('SHA-256', uint8Array);\r\n\r\n\t\t// Convert the hash to a hexadecimal string\r\n\t\tconst hashArray = Array.from(new Uint8Array(hashBuffer));\r\n\t\tconst hashHex = hashArray.map((byte) => byte.toString(16).padStart(2, '0')).join('');\r\n\r\n\t\treturn `${hashHex}`;\r\n\t} catch (error) {\r\n\t\tconsole.error('Error calculating SHA-256 hash:', error);\r\n\t\tthrow error;\r\n\t}\r\n};\r\n\r\nexport const getImportOrigin = (_chats) => {\r\n\t// Check what external service chat imports are from\r\n\tif ('mapping' in _chats[0]) {\r\n\t\treturn 'openai';\r\n\t}\r\n\treturn 'webui';\r\n};\r\n\r\nexport const getUserPosition = async (raw = false) => {\r\n\t// Get the user's location using the Geolocation API\r\n\tconst position = await new Promise((resolve, reject) => {\r\n\t\tnavigator.geolocation.getCurrentPosition(resolve, reject);\r\n\t}).catch((error) => {\r\n\t\tconsole.error('Error getting user location:', error);\r\n\t\tthrow error;\r\n\t});\r\n\r\n\tif (!position) {\r\n\t\treturn 'Location not available';\r\n\t}\r\n\r\n\t// Extract the latitude and longitude from the position\r\n\tconst { latitude, longitude } = position.coords;\r\n\r\n\tif (raw) {\r\n\t\treturn { latitude, longitude };\r\n\t} else {\r\n\t\treturn `${latitude.toFixed(3)}, ${longitude.toFixed(3)} (lat, long)`;\r\n\t}\r\n};\r\n\r\nconst convertOpenAIMessages = (convo) => {\r\n\t// Parse OpenAI chat messages and create chat dictionary for creating new chats\r\n\tconst mapping = convo['mapping'];\r\n\tconst messages = [];\r\n\tlet currentId = '';\r\n\tlet lastId = null;\r\n\r\n\tfor (const message_id in mapping) {\r\n\t\tconst message = mapping[message_id];\r\n\t\tcurrentId = message_id;\r\n\t\ttry {\r\n\t\t\tif (\r\n\t\t\t\tmessages.length == 0 &&\r\n\t\t\t\t(message['message'] == null ||\r\n\t\t\t\t\t(message['message']['content']['parts']?.[0] == '' &&\r\n\t\t\t\t\t\tmessage['message']['content']['text'] == null))\r\n\t\t\t) {\r\n\t\t\t\t// Skip chat messages with no content\r\n\t\t\t\tcontinue;\r\n\t\t\t} else {\r\n\t\t\t\tconst new_chat = {\r\n\t\t\t\t\tid: message_id,\r\n\t\t\t\t\tparentId: lastId,\r\n\t\t\t\t\tchildrenIds: message['children'] || [],\r\n\t\t\t\t\trole: message['message']?.['author']?.['role'] !== 'user' ? 'assistant' : 'user',\r\n\t\t\t\t\tcontent:\r\n\t\t\t\t\t\tmessage['message']?.['content']?.['parts']?.[0] ||\r\n\t\t\t\t\t\tmessage['message']?.['content']?.['text'] ||\r\n\t\t\t\t\t\t'',\r\n\t\t\t\t\tmodel: 'gpt-3.5-turbo',\r\n\t\t\t\t\tdone: true,\r\n\t\t\t\t\tcontext: null\r\n\t\t\t\t};\r\n\t\t\t\tmessages.push(new_chat);\r\n\t\t\t\tlastId = currentId;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log('Error with', message, '\\nError:', error);\r\n\t\t}\r\n\t}\r\n\r\n\tconst history: Record<PropertyKey, (typeof messages)[number]> = {};\r\n\tmessages.forEach((obj) => (history[obj.id] = obj));\r\n\r\n\tconst chat = {\r\n\t\thistory: {\r\n\t\t\tcurrentId: currentId,\r\n\t\t\tmessages: history // Need to convert this to not a list and instead a json object\r\n\t\t},\r\n\t\tmodels: ['gpt-3.5-turbo'],\r\n\t\tmessages: messages,\r\n\t\toptions: {},\r\n\t\ttimestamp: convo['create_time'],\r\n\t\ttitle: convo['title'] ?? 'New Chat'\r\n\t};\r\n\treturn chat;\r\n};\r\n\r\nconst validateChat = (chat) => {\r\n\t// Because ChatGPT sometimes has features we can't use like DALL-E or migh have corrupted messages, need to validate\r\n\tconst messages = chat.messages;\r\n\r\n\t// Check if messages array is empty\r\n\tif (messages.length === 0) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Last message's children should be an empty array\r\n\tconst lastMessage = messages[messages.length - 1];\r\n\tif (lastMessage.childrenIds.length !== 0) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// First message's parent should be null\r\n\tconst firstMessage = messages[0];\r\n\tif (firstMessage.parentId !== null) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Every message's content should be a string\r\n\tfor (const message of messages) {\r\n\t\tif (typeof message.content !== 'string') {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\nexport const convertOpenAIChats = (_chats) => {\r\n\t// Create a list of dictionaries with each conversation from import\r\n\tconst chats = [];\r\n\tlet failed = 0;\r\n\tfor (const convo of _chats) {\r\n\t\tconst chat = convertOpenAIMessages(convo);\r\n\r\n\t\tif (validateChat(chat)) {\r\n\t\t\tchats.push({\r\n\t\t\t\tid: convo['id'],\r\n\t\t\t\tuser_id: '',\r\n\t\t\t\ttitle: convo['title'],\r\n\t\t\t\tchat: chat,\r\n\t\t\t\ttimestamp: convo['timestamp']\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tfailed++;\r\n\t\t}\r\n\t}\r\n\tconsole.log(failed, 'Conversations could not be imported');\r\n\treturn chats;\r\n};\r\n\r\nexport const isValidHttpUrl = (string: string) => {\r\n\tlet url;\r\n\r\n\ttry {\r\n\t\turl = new URL(string);\r\n\t} catch (_) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn url.protocol === 'http:' || url.protocol === 'https:';\r\n};\r\n\r\nexport const removeEmojis = (str: string) => {\r\n\t// Regular expression to match emojis\r\n\tconst emojiRegex = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDE4F]/g;\r\n\r\n\t// Replace emojis with an empty string\r\n\treturn str.replace(emojiRegex, '');\r\n};\r\n\r\nexport const removeFormattings = (str: string) => {\r\n\treturn str.replace(/(\\*)(.*?)\\1/g, '').replace(/(```)(.*?)\\1/gs, '');\r\n};\r\n\r\nexport const cleanText = (content: string) => {\r\n\treturn removeFormattings(removeEmojis(content.trim()));\r\n};\r\n\r\n// This regular expression matches code blocks marked by triple backticks\r\nconst codeBlockRegex = /```[\\s\\S]*?```/g;\r\n\r\nexport const extractSentences = (text: string) => {\r\n\tconst codeBlocks: string[] = [];\r\n\tlet index = 0;\r\n\r\n\t// Temporarily replace code blocks with placeholders and store the blocks separately\r\n\ttext = text.replace(codeBlockRegex, (match) => {\r\n\t\tconst placeholder = `\\u0000${index}\\u0000`; // Use a unique placeholder\r\n\t\tcodeBlocks[index++] = match;\r\n\t\treturn placeholder;\r\n\t});\r\n\r\n\t// Split the modified text into sentences based on common punctuation marks, avoiding these blocks\r\n\tlet sentences = text.split(/(?<=[.!?])\\s+/);\r\n\r\n\t// Restore code blocks and process sentences\r\n\tsentences = sentences.map((sentence) => {\r\n\t\t// Check if the sentence includes a placeholder for a code block\r\n\t\treturn sentence.replace(/\\u0000(\\d+)\\u0000/g, (_, idx) => codeBlocks[idx]);\r\n\t});\r\n\r\n\treturn sentences.map(cleanText).filter(Boolean);\r\n};\r\n\r\nexport const extractParagraphsForAudio = (text: string) => {\r\n\tconst codeBlocks: string[] = [];\r\n\tlet index = 0;\r\n\r\n\t// Temporarily replace code blocks with placeholders and store the blocks separately\r\n\ttext = text.replace(codeBlockRegex, (match) => {\r\n\t\tconst placeholder = `\\u0000${index}\\u0000`; // Use a unique placeholder\r\n\t\tcodeBlocks[index++] = match;\r\n\t\treturn placeholder;\r\n\t});\r\n\r\n\t// Split the modified text into paragraphs based on newlines, avoiding these blocks\r\n\tlet paragraphs = text.split(/\\n+/);\r\n\r\n\t// Restore code blocks and process paragraphs\r\n\tparagraphs = paragraphs.map((paragraph) => {\r\n\t\t// Check if the paragraph includes a placeholder for a code block\r\n\t\treturn paragraph.replace(/\\u0000(\\d+)\\u0000/g, (_, idx) => codeBlocks[idx]);\r\n\t});\r\n\r\n\treturn paragraphs.map(cleanText).filter(Boolean);\r\n};\r\n\r\nexport const extractSentencesForAudio = (text: string) => {\r\n\treturn extractSentences(text).reduce((mergedTexts, currentText) => {\r\n\t\tconst lastIndex = mergedTexts.length - 1;\r\n\t\tif (lastIndex >= 0) {\r\n\t\t\tconst previousText = mergedTexts[lastIndex];\r\n\t\t\tconst wordCount = previousText.split(/\\s+/).length;\r\n\t\t\tconst charCount = previousText.length;\r\n\t\t\tif (wordCount < 4 || charCount < 50) {\r\n\t\t\t\tmergedTexts[lastIndex] = previousText + ' ' + currentText;\r\n\t\t\t} else {\r\n\t\t\t\tmergedTexts.push(currentText);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tmergedTexts.push(currentText);\r\n\t\t}\r\n\t\treturn mergedTexts;\r\n\t}, [] as string[]);\r\n};\r\n\r\nexport const getMessageContentParts = (content: string, split_on: string = 'punctuation') => {\r\n\tconst messageContentParts: string[] = [];\r\n\r\n\tswitch (split_on) {\r\n\t\tdefault:\r\n\t\tcase TTS_RESPONSE_SPLIT.PUNCTUATION:\r\n\t\t\tmessageContentParts.push(...extractSentencesForAudio(content));\r\n\t\t\tbreak;\r\n\t\tcase TTS_RESPONSE_SPLIT.PARAGRAPHS:\r\n\t\t\tmessageContentParts.push(...extractParagraphsForAudio(content));\r\n\t\t\tbreak;\r\n\t\tcase TTS_RESPONSE_SPLIT.NONE:\r\n\t\t\tmessageContentParts.push(cleanText(content));\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn messageContentParts;\r\n};\r\n\r\nexport const blobToFile = (blob, fileName) => {\r\n\t// Create a new File object from the Blob\r\n\tconst file = new File([blob], fileName, { type: blob.type });\r\n\treturn file;\r\n};\r\n\r\n/**\r\n * @param {string} template - The template string containing placeholders.\r\n * @returns {string} The template string with the placeholders replaced by the prompt.\r\n */\r\nexport const promptTemplate = (\r\n\ttemplate: string,\r\n\tuser_name?: string,\r\n\tuser_location?: string\r\n): string => {\r\n\t// Get the current date\r\n\tconst currentDate = new Date();\r\n\r\n\t// Format the date to YYYY-MM-DD\r\n\tconst formattedDate =\r\n\t\tcurrentDate.getFullYear() +\r\n\t\t'-' +\r\n\t\tString(currentDate.getMonth() + 1).padStart(2, '0') +\r\n\t\t'-' +\r\n\t\tString(currentDate.getDate()).padStart(2, '0');\r\n\r\n\t// Format the time to HH:MM:SS AM/PM\r\n\tconst currentTime = currentDate.toLocaleTimeString('en-US', {\r\n\t\thour: 'numeric',\r\n\t\tminute: 'numeric',\r\n\t\tsecond: 'numeric',\r\n\t\thour12: true\r\n\t});\r\n\r\n\t// Replace {{CURRENT_DATETIME}} in the template with the formatted datetime\r\n\ttemplate = template.replace('{{CURRENT_DATETIME}}', `${formattedDate} ${currentTime}`);\r\n\r\n\t// Replace {{CURRENT_DATE}} in the template with the formatted date\r\n\ttemplate = template.replace('{{CURRENT_DATE}}', formattedDate);\r\n\r\n\t// Replace {{CURRENT_TIME}} in the template with the formatted time\r\n\ttemplate = template.replace('{{CURRENT_TIME}}', currentTime);\r\n\r\n\tif (user_name) {\r\n\t\t// Replace {{USER_NAME}} in the template with the user's name\r\n\t\ttemplate = template.replace('{{USER_NAME}}', user_name);\r\n\t}\r\n\r\n\tif (user_location) {\r\n\t\t// Replace {{USER_LOCATION}} in the template with the current location\r\n\t\ttemplate = template.replace('{{USER_LOCATION}}', user_location);\r\n\t}\r\n\r\n\treturn template;\r\n};\r\n\r\n/**\r\n * This function is used to replace placeholders in a template string with the provided prompt.\r\n * The placeholders can be in the following formats:\r\n * - `{{prompt}}`: This will be replaced with the entire prompt.\r\n * - `{{prompt:start:<length>}}`: This will be replaced with the first <length> characters of the prompt.\r\n * - `{{prompt:end:<length>}}`: This will be replaced with the last <length> characters of the prompt.\r\n * - `{{prompt:middletruncate:<length>}}`: This will be replaced with the prompt truncated to <length> characters, with '...' in the middle.\r\n *\r\n * @param {string} template - The template string containing placeholders.\r\n * @param {string} prompt - The string to replace the placeholders with.\r\n * @returns {string} The template string with the placeholders replaced by the prompt.\r\n */\r\nexport const titleGenerationTemplate = (template: string, prompt: string): string => {\r\n\ttemplate = template.replace(\r\n\t\t/{{prompt}}|{{prompt:start:(\\d+)}}|{{prompt:end:(\\d+)}}|{{prompt:middletruncate:(\\d+)}}/g,\r\n\t\t(match, startLength, endLength, middleLength) => {\r\n\t\t\tif (match === '{{prompt}}') {\r\n\t\t\t\treturn prompt;\r\n\t\t\t} else if (match.startsWith('{{prompt:start:')) {\r\n\t\t\t\treturn prompt.substring(0, startLength);\r\n\t\t\t} else if (match.startsWith('{{prompt:end:')) {\r\n\t\t\t\treturn prompt.slice(-endLength);\r\n\t\t\t} else if (match.startsWith('{{prompt:middletruncate:')) {\r\n\t\t\t\tif (prompt.length <= middleLength) {\r\n\t\t\t\t\treturn prompt;\r\n\t\t\t\t}\r\n\t\t\t\tconst start = prompt.slice(0, Math.ceil(middleLength / 2));\r\n\t\t\t\tconst end = prompt.slice(-Math.floor(middleLength / 2));\r\n\t\t\t\treturn `${start}...${end}`;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t}\r\n\t);\r\n\r\n\ttemplate = promptTemplate(template);\r\n\r\n\treturn template;\r\n};\r\n\r\nexport const approximateToHumanReadable = (nanoseconds: number) => {\r\n\tconst seconds = Math.floor((nanoseconds / 1e9) % 60);\r\n\tconst minutes = Math.floor((nanoseconds / 6e10) % 60);\r\n\tconst hours = Math.floor((nanoseconds / 3.6e12) % 24);\r\n\r\n\tconst results: string[] = [];\r\n\r\n\tif (seconds >= 0) {\r\n\t\tresults.push(`${seconds}s`);\r\n\t}\r\n\r\n\tif (minutes > 0) {\r\n\t\tresults.push(`${minutes}m`);\r\n\t}\r\n\r\n\tif (hours > 0) {\r\n\t\tresults.push(`${hours}h`);\r\n\t}\r\n\r\n\treturn results.reverse().join(' ');\r\n};\r\n\r\nexport const getTimeRange = (timestamp) => {\r\n\tconst now = new Date();\r\n\tconst date = new Date(timestamp * 1000); // Convert Unix timestamp to milliseconds\r\n\r\n\t// Calculate the difference in milliseconds\r\n\tconst diffTime = now.getTime() - date.getTime();\r\n\tconst diffDays = diffTime / (1000 * 3600 * 24);\r\n\r\n\tconst nowDate = now.getDate();\r\n\tconst nowMonth = now.getMonth();\r\n\tconst nowYear = now.getFullYear();\r\n\r\n\tconst dateDate = date.getDate();\r\n\tconst dateMonth = date.getMonth();\r\n\tconst dateYear = date.getFullYear();\r\n\r\n\tif (nowYear === dateYear && nowMonth === dateMonth && nowDate === dateDate) {\r\n\t\treturn 'Today';\r\n\t} else if (nowYear === dateYear && nowMonth === dateMonth && nowDate - dateDate === 1) {\r\n\t\treturn 'Yesterday';\r\n\t} else if (diffDays <= 7) {\r\n\t\treturn 'Previous 7 days';\r\n\t} else if (diffDays <= 30) {\r\n\t\treturn 'Previous 30 days';\r\n\t} else if (nowYear === dateYear) {\r\n\t\treturn date.toLocaleString('default', { month: 'long' });\r\n\t} else {\r\n\t\treturn date.getFullYear().toString();\r\n\t}\r\n};\r\n\r\n/**\r\n * Extract frontmatter as a dictionary from the specified content string.\r\n * @param content {string} - The content string with potential frontmatter.\r\n * @returns {Object} - The extracted frontmatter as a dictionary.\r\n */\r\nexport const extractFrontmatter = (content) => {\r\n\tconst frontmatter = {};\r\n\tlet frontmatterStarted = false;\r\n\tlet frontmatterEnded = false;\r\n\tconst frontmatterPattern = /^\\s*([a-z_]+):\\s*(.*)\\s*$/i;\r\n\r\n\t// Split content into lines\r\n\tconst lines = content.split('\\n');\r\n\r\n\t// Check if the content starts with triple quotes\r\n\tif (lines[0].trim() !== '\"\"\"') {\r\n\t\treturn {};\r\n\t}\r\n\r\n\tfrontmatterStarted = true;\r\n\r\n\tfor (let i = 1; i < lines.length; i++) {\r\n\t\tconst line = lines[i];\r\n\r\n\t\tif (line.includes('\"\"\"')) {\r\n\t\t\tif (frontmatterStarted) {\r\n\t\t\t\tfrontmatterEnded = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (frontmatterStarted && !frontmatterEnded) {\r\n\t\t\tconst match = frontmatterPattern.exec(line);\r\n\t\t\tif (match) {\r\n\t\t\t\tconst [, key, value] = match;\r\n\t\t\t\tfrontmatter[key.trim()] = value.trim();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn frontmatter;\r\n};\r\n\r\n// Function to determine the best matching language\r\nexport const bestMatchingLanguage = (supportedLanguages, preferredLanguages, defaultLocale) => {\r\n\tconst languages = supportedLanguages.map((lang) => lang.code);\r\n\r\n\tconst match = preferredLanguages\r\n\t\t.map((prefLang) => languages.find((lang) => lang.startsWith(prefLang)))\r\n\t\t.find(Boolean);\r\n\r\n\tconsole.log(languages, preferredLanguages, match, defaultLocale);\r\n\treturn match || defaultLocale;\r\n};\r\n"],"names":["getRandomValues","rnds8","rng","byteToHex","i","unsafeStringify","arr","offset","randomUUID","native","v4","options","buf","rnds","TTS_RESPONSE_SPLIT","convertLatexToSingleLine","content","pattern","match","replaceTokens","char","user","charToken","userToken","videoIdToken","htmlIdToken","fileId","WEBUI_BASE_URL","sanitizeResponseContent","processResponseContent","revertSanitizedResponseContent","unescapeHtml","html","splitStream","splitOn","buffer","chunk","controller","parts","part","convertMessagesToHistory","messages","history","parentMessageId","messageId","message","uuidv4","canvasPixelTest","canvas","ctx","imageData","pixelValues","p","generateInitialsImage","name","sanitizedName","initials","copyToClipboard","text","result","textArea","msg","err","error","compareVersion","latest","current","findWordIndices","regex","matches","removeLastWordFromString","inputString","wordString","words","resultString","transformFileName","fileName","getImportOrigin","_chats","getUserPosition","raw","position","resolve","reject","latitude","longitude","convertOpenAIMessages","convo","mapping","currentId","lastId","message_id","_a","new_chat","_c","_b","_f","_e","_d","_h","_g","obj","validateChat","chat","convertOpenAIChats","chats","failed","isValidHttpUrl","string","url","removeEmojis","str","emojiRegex","removeFormattings","cleanText","codeBlockRegex","extractSentences","codeBlocks","index","placeholder","sentences","sentence","_","idx","extractParagraphsForAudio","paragraphs","paragraph","extractSentencesForAudio","mergedTexts","currentText","lastIndex","previousText","wordCount","charCount","getMessageContentParts","split_on","messageContentParts","blobToFile","blob","promptTemplate","template","user_name","user_location","currentDate","formattedDate","currentTime","approximateToHumanReadable","nanoseconds","seconds","minutes","hours","results","getTimeRange","timestamp","now","date","diffDays","nowDate","nowMonth","nowYear","dateDate","dateMonth","dateYear","extractFrontmatter","frontmatter","frontmatterStarted","frontmatterEnded","frontmatterPattern","lines","line","key","value","bestMatchingLanguage","supportedLanguages","preferredLanguages","defaultLocale","languages","lang","prefLang"],"mappings":"qEAGA,IAAIA,EACJ,MAAMC,EAAQ,IAAI,WAAW,EAAE,EAChB,SAASC,GAAM,CAE5B,GAAI,CAACF,IAEHA,EAAkB,OAAO,OAAW,KAAe,OAAO,iBAAmB,OAAO,gBAAgB,KAAK,MAAM,EAE3G,CAACA,GACH,MAAM,IAAI,MAAM,0GAA0G,EAI9H,OAAOA,EAAgBC,CAAK,CAC9B,CCXA,MAAME,EAAY,CAAA,EAElB,QAASC,EAAI,EAAGA,EAAI,IAAK,EAAEA,EACzBD,EAAU,MAAMC,EAAI,KAAO,SAAS,EAAE,EAAE,MAAM,CAAC,CAAC,EAG3C,SAASC,EAAgBC,EAAKC,EAAS,EAAG,CAG/C,OAAOJ,EAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,EAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,EAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,EAAUG,EAAIC,EAAS,CAAC,CAAC,EAAI,IAAMJ,EAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,EAAUG,EAAIC,EAAS,CAAC,CAAC,EAAI,IAAMJ,EAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,EAAUG,EAAIC,EAAS,CAAC,CAAC,EAAI,IAAMJ,EAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,EAAUG,EAAIC,EAAS,CAAC,CAAC,EAAI,IAAMJ,EAAUG,EAAIC,EAAS,EAAE,CAAC,EAAIJ,EAAUG,EAAIC,EAAS,EAAE,CAAC,EAAIJ,EAAUG,EAAIC,EAAS,EAAE,CAAC,EAAIJ,EAAUG,EAAIC,EAAS,EAAE,CAAC,EAAIJ,EAAUG,EAAIC,EAAS,EAAE,CAAC,EAAIJ,EAAUG,EAAIC,EAAS,EAAE,CAAC,CACnf,CChBA,MAAMC,EAAa,OAAO,OAAW,KAAe,OAAO,YAAc,OAAO,WAAW,KAAK,MAAM,EACvFC,EAAA,CACb,WAAAD,CACF,ECCA,SAASE,EAAGC,EAASC,EAAKL,EAAQ,CAChC,GAAIE,EAAO,YAAc,CAACG,GAAO,CAACD,EAChC,OAAOF,EAAO,aAGhBE,EAAUA,GAAW,GACrB,MAAME,EAAOF,EAAQ,SAAWA,EAAQ,KAAOT,KAE/C,OAAAW,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAI,GAAO,GAC3BA,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAI,GAAO,IAYpBR,EAAgBQ,CAAI,CAC7B,CChBY,IAAAC,GAAAA,IACXA,EAAA,YAAc,cACdA,EAAA,WAAa,aACbA,EAAA,KAAO,OAHIA,IAAAA,GAAA,CAAA,CAAA,ECAZ,MAAMC,EAA4BC,IAEhB,CAChB,0BACA,sBACA,6CAAA,EAGQ,QAASC,GAAY,CAC7BD,EAAUA,EAAQ,QAAQC,EAAUC,GAC5BA,EAAM,QAAQ,YAAa,GAAG,EAAE,KAAK,CAC5C,CAAA,CACD,EAEMF,GAGKG,EAAgB,CAACH,EAASI,EAAMC,IAAS,CACrD,MAAMC,EAAY,aACZC,EAAY,aACZC,EAAe,mCACfC,EAAc,kCAGhB,OAAsBL,GAAS,OACxBJ,EAAAA,EAAQ,QAAQM,EAAWF,CAAI,GAIhBC,GAAS,OACxBL,EAAAA,EAAQ,QAAQO,EAAWF,CAAI,GAI1CL,EAAUA,EAAQ,QAAQQ,EAAc,CAACN,EAAOQ,IAExC,eADU,GAAGC,CAAc,iBAAiBD,CAAM,UAC3B,qBAC9B,EAGDV,EAAUA,EAAQ,QAAQS,EAAa,CAACP,EAAOQ,IAEvC,gBADS,GAAGC,CAAc,iBAAiBD,CAAM,UAC1B,8HAC9B,EAEMV,CACR,EAEaY,EAA2BZ,GAChCA,EACL,QAAQ,aAAc,EAAE,EACxB,QAAQ,eAAgB,EAAE,EAC1B,QAAQ,KAAM,EAAE,EAChB,WAAW,gBAAiB,GAAG,EAC/B,WAAW,IAAK,MAAM,EACtB,WAAW,IAAK,MAAM,EACtB,KAAK,EAGKa,EAA0Bb,IACtCA,EAAUD,EAAyBC,CAAO,EACnCA,EAAQ,QAGHc,EAAkCd,GACvCA,EAAQ,WAAW,OAAQ,GAAG,EAAE,WAAW,OAAQ,GAAG,EAGvD,SAASe,EAAaC,EAAc,CAE1C,OADY,IAAI,UAAA,EAAY,gBAAgBA,EAAM,WAAW,EAClD,gBAAgB,WAC5B,CAMa,MAAAC,EAAeC,GAAY,CACvC,IAAIC,EAAS,GACb,OAAO,IAAI,gBAAgB,CAC1B,UAAUC,EAAOC,EAAY,CAClBF,GAAAC,EACJ,MAAAE,EAAQH,EAAO,MAAMD,CAAO,EAC5BI,EAAA,MAAM,EAAG,EAAE,EAAE,QAASC,GAASF,EAAW,QAAQE,CAAI,CAAC,EACpDJ,EAAAG,EAAMA,EAAM,OAAS,CAAC,CAChC,EACA,MAAMD,EAAY,CACbF,GAAmBE,EAAA,QAAQF,CAAM,CACtC,CAAA,CACA,CACF,EAEaK,EAA4BC,GAAa,CACrD,MAAMC,EAAU,CACf,SAAU,CAAC,EACX,UAAW,IAAA,EAGZ,IAAIC,EAAkB,KAClBC,EAAY,KAEhB,UAAWC,KAAWJ,EACrBG,EAAYE,EAAO,EAEfH,IAAoB,OACfD,EAAA,SAASC,CAAe,EAAE,YAAc,CAC/C,GAAGD,EAAQ,SAASC,CAAe,EAAE,YACrCC,CAAA,GAIMF,EAAA,SAASE,CAAS,EAAI,CAC7B,GAAGC,EACH,GAAID,EACJ,SAAUD,EACV,YAAa,CAAC,CAAA,EAGGA,EAAAC,EAGnB,OAAAF,EAAQ,UAAYE,EACbF,CACR,EAeaK,EAAkB,IAAM,CAG9B,MAAAC,EAAS,SAAS,cAAc,QAAQ,EACxCC,EAAMD,EAAO,WAAW,IAAI,EAClCA,EAAO,OAAS,EAChBA,EAAO,MAAQ,EACf,MAAME,EAAY,IAAI,UAAUF,EAAO,MAAOA,EAAO,MAAM,EACrDG,EAAcD,EAAU,KAG9B,QAAS9C,EAAI,EAAGA,EAAI8C,EAAU,KAAK,OAAQ9C,GAAK,EAC3CA,EAAI,IAAM,EACb+C,EAAY/C,CAAC,EAAI,KAAK,MAAM,IAAM,KAAK,QAAQ,EAE/C+C,EAAY/C,CAAC,EAAI,IAIf6C,EAAA,aAAaC,EAAW,EAAG,CAAC,EAC1B,MAAAE,EAAIH,EAAI,aAAa,EAAG,EAAGD,EAAO,MAAOA,EAAO,MAAM,EAAE,KAG9D,QAAS5C,EAAI,EAAGA,EAAIgD,EAAE,OAAQhD,GAAK,EAClC,GAAIgD,EAAEhD,CAAC,IAAM+C,EAAY/C,CAAC,EACjB,eAAA,IACP,0DACAgD,EAAEhD,CAAC,EACH,MACAA,EACA,YACA+C,EAAY/C,CAAC,CAAA,EAEd,QAAQ,IAAI,wDAAwD,EAC7D,GAIF,MAAA,EACR,EAEaiD,EAAyBC,GAAS,CACxC,MAAAN,EAAS,SAAS,cAAc,QAAQ,EACxCC,EAAMD,EAAO,WAAW,IAAI,EAI9B,GAHJA,EAAO,MAAQ,IACfA,EAAO,OAAS,IAEZ,CAACD,IACI,eAAA,IACP,+FAAA,EAEM,YAGRE,EAAI,UAAY,UAChBA,EAAI,SAAS,EAAG,EAAGD,EAAO,MAAOA,EAAO,MAAM,EAE9CC,EAAI,UAAY,UAChBA,EAAI,KAAO,iBACXA,EAAI,UAAY,SAChBA,EAAI,aAAe,SAEb,MAAAM,EAAgBD,EAAK,OACrBE,EACLD,EAAc,OAAS,EACpBA,EAAc,CAAC,GACfA,EAAc,MAAM,GAAG,EAAE,OAAS,EAChCA,EAAcA,EAAc,YAAY,GAAG,EAAI,CAAC,EAChD,IACF,GAEA,OAAAN,EAAA,SAASO,EAAS,cAAeR,EAAO,MAAQ,EAAGA,EAAO,OAAS,CAAC,EAEjEA,EAAO,WACf,EAEaS,EAAkB,MAAOC,GAAS,CAC9C,IAAIC,EAAS,GACT,GAAA,CAAC,UAAU,UAAW,CACnB,MAAAC,EAAW,SAAS,cAAc,UAAU,EAClDA,EAAS,MAAQF,EAGjBE,EAAS,MAAM,IAAM,IACrBA,EAAS,MAAM,KAAO,IACtBA,EAAS,MAAM,SAAW,QAEjB,SAAA,KAAK,YAAYA,CAAQ,EAClCA,EAAS,MAAM,EACfA,EAAS,OAAO,EAEZ,GAAA,CAEG,MAAAC,EADa,SAAS,YAAY,MAAM,EACrB,aAAe,eAChC,QAAA,IAAI,sCAAwCA,CAAG,EAC9CF,EAAA,SACDG,EAAK,CACL,QAAA,MAAM,iCAAkCA,CAAG,CACpD,CAES,gBAAA,KAAK,YAAYF,CAAQ,EAC3BD,CACR,CAEA,OAAAA,EAAS,MAAM,UAAU,UACvB,UAAUD,CAAI,EACd,KAAK,KACL,QAAQ,IAAI,6CAA6C,EAClD,GACP,EACA,MAAOK,IACC,QAAA,MAAM,+BAAgCA,CAAK,EAC5C,GACP,EAEKJ,CACR,EAEaK,EAAiB,CAACC,EAAQC,IAC/BA,IAAY,QAChB,GACAA,EAAQ,cAAcD,EAAQ,OAAW,CACzC,QAAS,GACT,YAAa,OACb,UAAW,OACX,CAAA,EAAI,EAGKE,EAAmBT,GAAS,CACxC,MAAMU,EAAQ,gBACRC,EAAU,CAAA,EACZ,IAAAnD,EAEJ,MAAQA,EAAQkD,EAAM,KAAKV,CAAI,KAAO,MACrCW,EAAQ,KAAK,CACZ,KAAMnD,EAAM,CAAC,EACb,WAAYA,EAAM,MAClB,SAAUkD,EAAM,UAAY,CAAA,CAC5B,EAGK,OAAAC,CACR,EAEaC,EAA2B,CAACC,EAAaC,IAAe,CAE9D,MAAAC,EAAQF,EAAY,MAAM,GAAG,EAE/BE,EAAM,GAAG,EAAE,IAAMD,GACpBC,EAAM,IAAI,EAIP,IAAAC,EAAeD,EAAM,KAAK,GAAG,EACjC,OAAIC,IAAiB,KACJA,GAAA,KAGVA,CACR,EAoBaC,EAAqBC,GAEPA,EAAS,cAGS,QAAQ,WAAY,EAAE,EAG1B,QAAQ,OAAQ,GAAG,EAuC/CC,GAAmBC,GAE3B,YAAaA,EAAO,CAAC,EACjB,SAED,QAGKC,GAAkB,MAAOC,EAAM,KAAU,CAErD,MAAMC,EAAW,MAAM,IAAI,QAAQ,CAACC,EAASC,IAAW,CAC7C,UAAA,YAAY,mBAAmBD,EAASC,CAAM,CAAA,CACxD,EAAE,MAAOpB,GAAU,CACX,cAAA,MAAM,+BAAgCA,CAAK,EAC7CA,CAAA,CACN,EAED,GAAI,CAACkB,EACG,MAAA,yBAIR,KAAM,CAAE,SAAAG,EAAU,UAAAC,GAAcJ,EAAS,OAEzC,OAAID,EACI,CAAE,SAAAI,EAAU,UAAAC,GAEZ,GAAGD,EAAS,QAAQ,CAAC,CAAC,KAAKC,EAAU,QAAQ,CAAC,CAAC,cAExD,EAEMC,EAAyBC,GAAU,qBAElC,MAAAC,EAAUD,EAAM,QAChB9C,EAAW,CAAA,EACjB,IAAIgD,EAAY,GACZC,EAAS,KAEb,UAAWC,KAAcH,EAAS,CAC3B,MAAA3C,EAAU2C,EAAQG,CAAU,EACtBF,EAAAE,EACR,GAAA,CAEF,GAAAlD,EAAS,QAAU,IAClBI,EAAQ,SAAc,QACrB+C,EAAA/C,EAAQ,QAAW,QAAW,QAA9B,YAAA+C,EAAyC,KAAM,IAC/C/C,EAAQ,QAAW,QAAW,MAAW,MAG3C,SACM,CACN,MAAMgD,EAAW,CAChB,GAAIF,EACJ,SAAUD,EACV,YAAa7C,EAAQ,UAAe,CAAC,EACrC,OAAMiD,GAAAC,EAAAlD,EAAQ,UAAR,YAAAkD,EAAqB,SAArB,YAAAD,EAAiC,QAAY,OAAS,YAAc,OAC1E,UACCE,GAAAC,GAAAC,EAAArD,EAAQ,UAAR,YAAAqD,EAAqB,UAArB,YAAAD,EAAkC,QAAlC,YAAAD,EAA6C,OAC7CG,GAAAC,EAAAvD,EAAQ,UAAR,YAAAuD,EAAqB,UAArB,YAAAD,EAAkC,OAClC,GACD,MAAO,gBACP,KAAM,GACN,QAAS,IAAA,EAEV1D,EAAS,KAAKoD,CAAQ,EACbH,EAAAD,CACV,QACQ1B,EAAO,CACf,QAAQ,IAAI,aAAclB,EAAS;AAAA,QAAYkB,CAAK,CACrD,CACD,CAEA,MAAMrB,EAA0D,CAAA,EAChE,OAAAD,EAAS,QAAS4D,GAAS3D,EAAQ2D,EAAI,EAAE,EAAIA,CAAI,EAEpC,CACZ,QAAS,CACR,UAAAZ,EACA,SAAU/C,CACX,EACA,OAAQ,CAAC,eAAe,EACxB,SAAAD,EACA,QAAS,CAAC,EACV,UAAW8C,EAAM,YACjB,MAAOA,EAAM,OAAY,UAAA,CAG3B,EAEMe,EAAgBC,GAAS,CAE9B,MAAM9D,EAAW8D,EAAK,SAelB,GAZA9D,EAAS,SAAW,GAKJA,EAASA,EAAS,OAAS,CAAC,EAChC,YAAY,SAAW,GAKlBA,EAAS,CAAC,EACd,WAAa,KACtB,MAAA,GAIR,UAAWI,KAAWJ,EACjB,GAAA,OAAOI,EAAQ,SAAY,SACvB,MAAA,GAIF,MAAA,EACR,EAEa2D,GAAsB1B,GAAW,CAE7C,MAAM2B,EAAQ,CAAA,EACd,IAAIC,EAAS,EACb,UAAWnB,KAAST,EAAQ,CACrB,MAAAyB,EAAOjB,EAAsBC,CAAK,EAEpCe,EAAaC,CAAI,EACpBE,EAAM,KAAK,CACV,GAAIlB,EAAM,GACV,QAAS,GACT,MAAOA,EAAM,MACb,KAAAgB,EACA,UAAWhB,EAAM,SAAW,CAC5B,EAEDmB,GAEF,CACQ,eAAA,IAAIA,EAAQ,qCAAqC,EAClDD,CACR,EAEaE,GAAkBC,GAAmB,CAC7C,IAAAC,EAEA,GAAA,CACGA,EAAA,IAAI,IAAID,CAAM,OACT,CACJ,MAAA,EACR,CAEA,OAAOC,EAAI,WAAa,SAAWA,EAAI,WAAa,QACrD,EAEaC,EAAgBC,GAAgB,CAE5C,MAAMC,EAAa,8EAGZ,OAAAD,EAAI,QAAQC,EAAY,EAAE,CAClC,EAEaC,EAAqBF,GAC1BA,EAAI,QAAQ,eAAgB,EAAE,EAAE,QAAQ,iBAAkB,EAAE,EAGvDG,EAAalG,GAClBiG,EAAkBH,EAAa9F,EAAQ,KAAA,CAAM,CAAC,EAIhDmG,EAAiB,kBAEVC,EAAoB1D,GAAiB,CACjD,MAAM2D,EAAuB,CAAA,EAC7B,IAAIC,EAAQ,EAGZ5D,EAAOA,EAAK,QAAQyD,EAAiBjG,GAAU,CACxC,MAAAqG,EAAc,KAASD,CAAK,KAClC,OAAAD,EAAWC,GAAO,EAAIpG,EACfqG,CAAA,CACP,EAGG,IAAAC,EAAY9D,EAAK,MAAM,WAAe,gBAAA,GAG9B,OAAA8D,EAAAA,EAAU,IAAKC,GAEnBA,EAAS,QAAQ,qBAAsB,CAACC,EAAGC,IAAQN,EAAWM,CAAG,CAAC,CACzE,EAEMH,EAAU,IAAIN,CAAS,EAAE,OAAO,OAAO,CAC/C,EAEaU,EAA6BlE,GAAiB,CAC1D,MAAM2D,EAAuB,CAAA,EAC7B,IAAIC,EAAQ,EAGZ5D,EAAOA,EAAK,QAAQyD,EAAiBjG,GAAU,CACxC,MAAAqG,EAAc,KAASD,CAAK,KAClC,OAAAD,EAAWC,GAAO,EAAIpG,EACfqG,CAAA,CACP,EAGG,IAAAM,EAAanE,EAAK,MAAM,KAAK,EAGpB,OAAAmE,EAAAA,EAAW,IAAKC,GAErBA,EAAU,QAAQ,qBAAsB,CAACJ,EAAGC,IAAQN,EAAWM,CAAG,CAAC,CAC1E,EAEME,EAAW,IAAIX,CAAS,EAAE,OAAO,OAAO,CAChD,EAEaa,EAA4BrE,GACjC0D,EAAiB1D,CAAI,EAAE,OAAO,CAACsE,EAAaC,IAAgB,CAC5D,MAAAC,EAAYF,EAAY,OAAS,EACvC,GAAIE,GAAa,EAAG,CACb,MAAAC,EAAeH,EAAYE,CAAS,EACpCE,EAAYD,EAAa,MAAM,KAAK,EAAE,OACtCE,EAAYF,EAAa,OAC3BC,EAAY,GAAKC,EAAY,GACpBL,EAAAE,CAAS,EAAIC,EAAe,IAAMF,EAE9CD,EAAY,KAAKC,CAAW,CAC7B,MAEAD,EAAY,KAAKC,CAAW,EAEtB,OAAAD,CACR,EAAG,CAAc,CAAA,EAGLM,GAAyB,CAACtH,EAAiBuH,EAAmB,gBAAkB,CAC5F,MAAMC,EAAgC,CAAA,EAEtC,OAAQD,EAAU,CACjB,QACA,KAAKzH,EAAmB,YACvB0H,EAAoB,KAAK,GAAGT,EAAyB/G,CAAO,CAAC,EAC7D,MACD,KAAKF,EAAmB,WACvB0H,EAAoB,KAAK,GAAGZ,EAA0B5G,CAAO,CAAC,EAC9D,MACD,KAAKF,EAAmB,KACH0H,EAAA,KAAKtB,EAAUlG,CAAO,CAAC,EAC3C,KACF,CAEO,OAAAwH,CACR,EAEaC,GAAa,CAACC,EAAM9D,IAEnB,IAAI,KAAK,CAAC8D,CAAI,EAAG9D,EAAU,CAAE,KAAM8D,EAAK,IAAA,CAAM,EAQ/CC,GAAiB,CAC7BC,EACAC,EACAC,IACY,CAEN,MAAAC,MAAkB,KAGlBC,EACLD,EAAY,cACZ,IACA,OAAOA,EAAY,WAAa,CAAC,EAAE,SAAS,EAAG,GAAG,EAClD,IACA,OAAOA,EAAY,QAAS,CAAA,EAAE,SAAS,EAAG,GAAG,EAGxCE,EAAcF,EAAY,mBAAmB,QAAS,CAC3D,KAAM,UACN,OAAQ,UACR,OAAQ,UACR,OAAQ,EAAA,CACR,EAGD,OAAAH,EAAWA,EAAS,QAAQ,uBAAwB,GAAGI,CAAa,IAAIC,CAAW,EAAE,EAG1EL,EAAAA,EAAS,QAAQ,mBAAoBI,CAAa,EAGlDJ,EAAAA,EAAS,QAAQ,mBAAoBK,CAAW,EAEvDJ,IAEQD,EAAAA,EAAS,QAAQ,gBAAiBC,CAAS,GAGnDC,IAEQF,EAAAA,EAAS,QAAQ,oBAAqBE,CAAa,GAGxDF,CACR,EAyCaM,GAA8BC,GAAwB,CAClE,MAAMC,EAAU,KAAK,MAAOD,EAAc,IAAO,EAAE,EAC7CE,EAAU,KAAK,MAAOF,EAAc,KAAQ,EAAE,EAC9CG,EAAQ,KAAK,MAAOH,EAAc,MAAU,EAAE,EAE9CI,EAAoB,CAAA,EAE1B,OAAIH,GAAW,GACNG,EAAA,KAAK,GAAGH,CAAO,GAAG,EAGvBC,EAAU,GACLE,EAAA,KAAK,GAAGF,CAAO,GAAG,EAGvBC,EAAQ,GACHC,EAAA,KAAK,GAAGD,CAAK,GAAG,EAGlBC,EAAQ,QAAA,EAAU,KAAK,GAAG,CAClC,EAEaC,GAAgBC,GAAc,CACpC,MAAAC,MAAU,KACVC,EAAO,IAAI,KAAKF,EAAY,GAAI,EAIhCG,GADWF,EAAI,QAAQ,EAAIC,EAAK,QAAQ,IACjB,IAAO,KAAO,IAErCE,EAAUH,EAAI,UACdI,EAAWJ,EAAI,WACfK,EAAUL,EAAI,cAEdM,EAAWL,EAAK,UAChBM,EAAYN,EAAK,WACjBO,EAAWP,EAAK,cAEtB,OAAII,IAAYG,GAAYJ,IAAaG,GAAaJ,IAAYG,EAC1D,QACGD,IAAYG,GAAYJ,IAAaG,GAAaJ,EAAUG,IAAa,EAC5E,YACGJ,GAAY,EACf,kBACGA,GAAY,GACf,mBACGG,IAAYG,EACfP,EAAK,eAAe,UAAW,CAAE,MAAO,OAAQ,EAEhDA,EAAK,cAAc,UAE5B,EAOaQ,GAAsBnJ,GAAY,CAC9C,MAAMoJ,EAAc,CAAA,EACpB,IAAIC,EAAqB,GACrBC,EAAmB,GACvB,MAAMC,EAAqB,6BAGrBC,EAAQxJ,EAAQ,MAAM;AAAA,CAAI,EAGhC,GAAIwJ,EAAM,CAAC,EAAE,KAAA,IAAW,MACvB,MAAO,GAGaH,EAAA,GAErB,QAASjK,EAAI,EAAGA,EAAIoK,EAAM,OAAQpK,IAAK,CAChC,MAAAqK,EAAOD,EAAMpK,CAAC,EAEhB,GAAAqK,EAAK,SAAS,KAAK,GAClBJ,EAAoB,CACJC,EAAA,GACnB,KACD,CAGG,GAAAD,GAAsB,CAACC,EAAkB,CACtC,MAAApJ,EAAQqJ,EAAmB,KAAKE,CAAI,EAC1C,GAAIvJ,EAAO,CACV,KAAM,EAAGwJ,EAAKC,CAAK,EAAIzJ,EACvBkJ,EAAYM,EAAI,KAAA,CAAM,EAAIC,EAAM,KAAK,CACtC,CACD,CACD,CAEO,OAAAP,CACR,EAGaQ,GAAuB,CAACC,EAAoBC,EAAoBC,IAAkB,CAC9F,MAAMC,EAAYH,EAAmB,IAAKI,GAASA,EAAK,IAAI,EAEtD/J,EAAQ4J,EACZ,IAAKI,GAAaF,EAAU,KAAMC,GAASA,EAAK,WAAWC,CAAQ,CAAC,CAAC,EACrE,KAAK,OAAO,EAEd,eAAQ,IAAIF,EAAWF,EAAoB5J,EAAO6J,CAAa,EACxD7J,GAAS6J,CACjB","x_google_ignoreList":[0,1,2,3]}