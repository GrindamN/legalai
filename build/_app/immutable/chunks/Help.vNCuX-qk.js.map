{"version":3,"file":"Help.vNCuX-qk.js","sources":["../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub.svelte","../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub-content.svelte","../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub-trigger.svelte","../../../../../../node_modules/eventsource-parser/dist/index.js","../../../../../../node_modules/eventsource-parser/dist/stream.js","../../../../../../src/lib/apis/streaming/index.ts","../../../../../../src/lib/components/common/Banner.svelte","../../../../../../src/lib/components/icons/DocumentArrowUpSolid.svelte","../../../../../../src/lib/components/icons/GlobeAltSolid.svelte","../../../../../../src/lib/components/icons/WrenchSolid.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu.svelte","../../../../../../src/lib/components/icons/Headphone.svelte","../../../../../../src/lib/components/chat/MessageInput/VoiceRecording.svelte","../../../../../../src/lib/components/chat/MessageInput/FilesOverlay.svelte","../../../../../../src/lib/components/chat/MessageInput/Commands/Prompts.svelte","../../../../../../src/lib/components/chat/MessageInput/Commands/Documents.svelte","../../../../../../src/lib/components/chat/MessageInput/Commands/Models.svelte","../../../../../../src/lib/components/chat/MessageInput/Commands.svelte","../../../../../../src/lib/components/icons/XMark.svelte","../../../../../../src/lib/components/chat/MessageInput.svelte","../../../../../../src/lib/components/chat/ModelSelector.svelte","../../../../../../src/lib/components/layout/Navbar/Menu.svelte","../../../../../../src/lib/components/icons/AdjustmentsHorizontal.svelte","../../../../../../src/lib/components/layout/Navbar.svelte","../../../../../../src/lib/components/chat/Controls/Valves.svelte","../../../../../../src/lib/components/chat/Controls/Controls.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay/VideoInputMenu.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay.svelte","../../../../../../src/lib/components/common/Drawer.svelte","../../../../../../src/lib/components/chat/ChatControls.svelte","../../../../../../src/lib/components/chat/Chat.svelte","../../../../../../src/lib/components/chat/ShortcutsModal.svelte","../../../../../../src/lib/components/icons/QuestionMarkCircle.svelte","../../../../../../src/lib/components/icons/Keyboard.svelte","../../../../../../src/lib/components/layout/Help/HelpMenu.svelte","../../../../../../src/lib/components/layout/Help.svelte"],"sourcesContent":["<script>import { derived } from \"svelte/store\";\nimport { setSubMenuCtx } from \"../ctx.js\";\nexport let disabled = void 0;\nexport let open = void 0;\nexport let onOpenChange = void 0;\nconst {\n  updateOption,\n  ids,\n  states: { subOpen }\n} = setSubMenuCtx({\n  disabled,\n  onOpenChange: ({ next }) => {\n    if (open !== next) {\n      onOpenChange?.(next);\n      open = next;\n    }\n    return next;\n  }\n});\nconst idValues = derived([ids.menu, ids.trigger], ([$menuId, $triggerId]) => ({\n  menu: $menuId,\n  trigger: $triggerId\n}));\n$:\n  open !== void 0 && subOpen.set(open);\n$:\n  updateOption(\"disabled\", disabled);\n</script>\n\n<slot subIds={$idValues} />\n","<script>import { melt } from \"@melt-ui/svelte\";\nimport { createDispatcher } from \"../../../internal/index.js\";\nimport { getSubmenuCtx, updateSubPositioning } from \"../ctx.js\";\nexport let transition = void 0;\nexport let transitionConfig = void 0;\nexport let inTransition = void 0;\nexport let inTransitionConfig = void 0;\nexport let outTransition = void 0;\nexport let outTransitionConfig = void 0;\nexport let asChild = false;\nexport let id = void 0;\nexport let side = \"right\";\nexport let align = \"start\";\nexport let sideOffset = 0;\nexport let alignOffset = 0;\nexport let collisionPadding = 8;\nexport let avoidCollisions = true;\nexport let collisionBoundary = void 0;\nexport let sameWidth = false;\nexport let fitViewport = false;\nexport let strategy = \"absolute\";\nexport let overlap = false;\nexport let el = void 0;\nconst {\n  elements: { subMenu },\n  states: { subOpen },\n  ids,\n  getAttrs\n} = getSubmenuCtx();\nconst dispatch = createDispatcher();\nconst attrs = getAttrs(\"sub-content\");\n$:\n  if (id) {\n    ids.menu.set(id);\n  }\n$:\n  builder = $subMenu;\n$:\n  Object.assign(builder, attrs);\n$:\n  updateSubPositioning({\n    side,\n    align,\n    sideOffset,\n    alignOffset,\n    collisionPadding,\n    avoidCollisions,\n    collisionBoundary,\n    sameWidth,\n    fitViewport,\n    strategy,\n    overlap\n  });\n</script>\n\n{#if asChild && $subOpen}\n\t<slot {builder} />\n{:else if transition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\ttransition:transition={transitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if inTransition && outTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tin:inTransition={inTransitionConfig}\n\t\tout:outTransition={outTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if inTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tin:inTransition={inTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if outTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tout:outTransition={outTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{/if}\n","<script>import { melt } from \"@melt-ui/svelte\";\nimport { disabledAttrs } from \"../../../internal/index.js\";\nimport { getSubTrigger } from \"../ctx.js\";\nimport { createDispatcher } from \"../../../internal/events.js\";\nexport let disabled = false;\nexport let asChild = false;\nexport let id = void 0;\nexport let el = void 0;\nconst {\n  elements: { subTrigger },\n  ids,\n  getAttrs,\n  options\n} = getSubTrigger();\nconst { disabled: disabledStore } = options;\nconst dispatch = createDispatcher();\n$:\n  if (id) {\n    ids.trigger.set(id);\n  }\n$:\n  builder = $subTrigger;\n$:\n  attrs = {\n    ...getAttrs(\"sub-trigger\"),\n    ...disabledAttrs(disabled || $disabledStore)\n  };\n$:\n  Object.assign(builder, attrs);\n</script>\n\n{#if asChild}\n\t<slot {builder} />\n{:else}\n\t<div\n\t\tbind:this={el}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-click={dispatch}\n\t\ton:m-focusin={dispatch}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointerleave={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{/if}\n","function createParser(onParse) {\n  let isFirstChunk;\n  let buffer;\n  let startingPosition;\n  let startingFieldLength;\n  let eventId;\n  let eventName;\n  let data;\n  reset();\n  return {\n    feed,\n    reset\n  };\n  function reset() {\n    isFirstChunk = true;\n    buffer = \"\";\n    startingPosition = 0;\n    startingFieldLength = -1;\n    eventId = void 0;\n    eventName = void 0;\n    data = \"\";\n  }\n  function feed(chunk) {\n    buffer = buffer ? buffer + chunk : chunk;\n    if (isFirstChunk && hasBom(buffer)) {\n      buffer = buffer.slice(BOM.length);\n    }\n    isFirstChunk = false;\n    const length = buffer.length;\n    let position = 0;\n    let discardTrailingNewline = false;\n    while (position < length) {\n      if (discardTrailingNewline) {\n        if (buffer[position] === \"\\n\") {\n          ++position;\n        }\n        discardTrailingNewline = false;\n      }\n      let lineLength = -1;\n      let fieldLength = startingFieldLength;\n      let character;\n      for (let index = startingPosition; lineLength < 0 && index < length; ++index) {\n        character = buffer[index];\n        if (character === \":\" && fieldLength < 0) {\n          fieldLength = index - position;\n        } else if (character === \"\\r\") {\n          discardTrailingNewline = true;\n          lineLength = index - position;\n        } else if (character === \"\\n\") {\n          lineLength = index - position;\n        }\n      }\n      if (lineLength < 0) {\n        startingPosition = length - position;\n        startingFieldLength = fieldLength;\n        break;\n      } else {\n        startingPosition = 0;\n        startingFieldLength = -1;\n      }\n      parseEventStreamLine(buffer, position, fieldLength, lineLength);\n      position += lineLength + 1;\n    }\n    if (position === length) {\n      buffer = \"\";\n    } else if (position > 0) {\n      buffer = buffer.slice(position);\n    }\n  }\n  function parseEventStreamLine(lineBuffer, index, fieldLength, lineLength) {\n    if (lineLength === 0) {\n      if (data.length > 0) {\n        onParse({\n          type: \"event\",\n          id: eventId,\n          event: eventName || void 0,\n          data: data.slice(0, -1)\n          // remove trailing newline\n        });\n\n        data = \"\";\n        eventId = void 0;\n      }\n      eventName = void 0;\n      return;\n    }\n    const noValue = fieldLength < 0;\n    const field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength));\n    let step = 0;\n    if (noValue) {\n      step = lineLength;\n    } else if (lineBuffer[index + fieldLength + 1] === \" \") {\n      step = fieldLength + 2;\n    } else {\n      step = fieldLength + 1;\n    }\n    const position = index + step;\n    const valueLength = lineLength - step;\n    const value = lineBuffer.slice(position, position + valueLength).toString();\n    if (field === \"data\") {\n      data += value ? \"\".concat(value, \"\\n\") : \"\\n\";\n    } else if (field === \"event\") {\n      eventName = value;\n    } else if (field === \"id\" && !value.includes(\"\\0\")) {\n      eventId = value;\n    } else if (field === \"retry\") {\n      const retry = parseInt(value, 10);\n      if (!Number.isNaN(retry)) {\n        onParse({\n          type: \"reconnect-interval\",\n          value: retry\n        });\n      }\n    }\n  }\n}\nconst BOM = [239, 187, 191];\nfunction hasBom(buffer) {\n  return BOM.every((charCode, index) => buffer.charCodeAt(index) === charCode);\n}\nexport { createParser };\n//# sourceMappingURL=index.js.map\n","import { createParser } from './index.js';\nclass EventSourceParserStream extends TransformStream {\n  constructor() {\n    let parser;\n    super({\n      start(controller) {\n        parser = createParser(event => {\n          if (event.type === \"event\") {\n            controller.enqueue(event);\n          }\n        });\n      },\n      transform(chunk) {\n        parser.feed(chunk);\n      }\n    });\n  }\n}\nexport { EventSourceParserStream };\n//# sourceMappingURL=stream.js.map\n","import { EventSourceParserStream } from 'eventsource-parser/stream';\r\nimport type { ParsedEvent } from 'eventsource-parser';\r\n\r\ntype TextStreamUpdate = {\r\n\tdone: boolean;\r\n\tvalue: string;\r\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\tcitations?: any;\r\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\terror?: any;\r\n\tusage?: ResponseUsage;\r\n};\r\n\r\ntype ResponseUsage = {\r\n\t/** Including images and tools if any */\r\n\tprompt_tokens: number;\r\n\t/** The tokens generated */\r\n\tcompletion_tokens: number;\r\n\t/** Sum of the above two fields */\r\n\ttotal_tokens: number;\r\n};\r\n\r\n// createOpenAITextStream takes a responseBody with a SSE response,\r\n// and returns an async generator that emits delta updates with large deltas chunked into random sized chunks\r\nexport async function createOpenAITextStream(\r\n\tresponseBody: ReadableStream<Uint8Array>,\r\n\tsplitLargeDeltas: boolean\r\n): Promise<AsyncGenerator<TextStreamUpdate>> {\r\n\tconst eventStream = responseBody\r\n\t\t.pipeThrough(new TextDecoderStream())\r\n\t\t.pipeThrough(new EventSourceParserStream())\r\n\t\t.getReader();\r\n\tlet iterator = openAIStreamToIterator(eventStream);\r\n\tif (splitLargeDeltas) {\r\n\t\titerator = streamLargeDeltasAsRandomChunks(iterator);\r\n\t}\r\n\treturn iterator;\r\n}\r\n\r\nasync function* openAIStreamToIterator(\r\n\treader: ReadableStreamDefaultReader<ParsedEvent>\r\n): AsyncGenerator<TextStreamUpdate> {\r\n\twhile (true) {\r\n\t\tconst { value, done } = await reader.read();\r\n\t\tif (done) {\r\n\t\t\tyield { done: true, value: '' };\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif (!value) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst data = value.data;\r\n\t\tif (data.startsWith('[DONE]')) {\r\n\t\t\tyield { done: true, value: '' };\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst parsedData = JSON.parse(data);\r\n\t\t\tconsole.log(parsedData);\r\n\r\n\t\t\tif (parsedData.error) {\r\n\t\t\t\tyield { done: true, value: '', error: parsedData.error };\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (parsedData.citations) {\r\n\t\t\t\tyield { done: false, value: '', citations: parsedData.citations };\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tyield {\r\n\t\t\t\tdone: false,\r\n\t\t\t\tvalue: parsedData.choices?.[0]?.delta?.content ?? '',\r\n\t\t\t\tusage: parsedData.usage\r\n\t\t\t};\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error('Error extracting delta from SSE event:', e);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// streamLargeDeltasAsRandomChunks will chunk large deltas (length > 5) into random sized chunks between 1-3 characters\r\n// This is to simulate a more fluid streaming, even though some providers may send large chunks of text at once\r\nasync function* streamLargeDeltasAsRandomChunks(\r\n\titerator: AsyncGenerator<TextStreamUpdate>\r\n): AsyncGenerator<TextStreamUpdate> {\r\n\tfor await (const textStreamUpdate of iterator) {\r\n\t\tif (textStreamUpdate.done) {\r\n\t\t\tyield textStreamUpdate;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (textStreamUpdate.citations) {\r\n\t\t\tyield textStreamUpdate;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tlet content = textStreamUpdate.value;\r\n\t\tif (content.length < 5) {\r\n\t\t\tyield { done: false, value: content };\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\twhile (content != '') {\r\n\t\t\tconst chunkSize = Math.min(Math.floor(Math.random() * 3) + 1, content.length);\r\n\t\t\tconst chunk = content.slice(0, chunkSize);\r\n\t\t\tyield { done: false, value: chunk };\r\n\t\t\t// Do not sleep if the tab is hidden\r\n\t\t\t// Timers are throttled to 1s in hidden tabs\r\n\t\t\tif (document?.visibilityState !== 'hidden') {\r\n\t\t\t\tawait sleep(5);\r\n\t\t\t}\r\n\t\t\tcontent = content.slice(chunkSize);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\r\n","<script lang=\"ts\">\r\n\timport type { Banner } from '$lib/types';\r\n\timport { onMount, createEventDispatcher } from 'svelte';\r\n\timport { fade } from 'svelte/transition';\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\texport let banner: Banner = {\r\n\t\tid: '',\r\n\t\ttype: 'info',\r\n\t\ttitle: '',\r\n\t\tcontent: '',\r\n\t\turl: '',\r\n\t\tdismissable: true,\r\n\t\ttimestamp: Math.floor(Date.now() / 1000)\r\n\t};\r\n\r\n\texport let dismissed = false;\r\n\r\n\tlet mounted = false;\r\n\r\n\tconst classNames: Record<string, string> = {\r\n\t\tinfo: 'bg-blue-500/20 text-blue-700 dark:text-blue-200 ',\r\n\t\tsuccess: 'bg-green-500/20 text-green-700 dark:text-green-200',\r\n\t\twarning: 'bg-yellow-500/20 text-yellow-700 dark:text-yellow-200',\r\n\t\terror: 'bg-red-500/20 text-red-700 dark:text-red-200'\r\n\t};\r\n\r\n\tconst dismiss = (id) => {\r\n\t\tdismissed = true;\r\n\t\tdispatch('dismiss', id);\r\n\t};\r\n\r\n\tonMount(() => {\r\n\t\tmounted = true;\r\n\t});\r\n</script>\r\n\r\n{#if !dismissed}\r\n\t{#if mounted}\r\n\t\t<div\r\n\t\t\tclass=\" top-0 left-0 right-0 p-2 mx-4 px-3 flex justify-center items-center relative rounded-xl border border-gray-50 dark:border-gray-850 text-gray-800 dark:text-gary-100 bg-white dark:bg-gray-900 backdrop-blur-xl z-30\"\r\n\t\t\ttransition:fade={{ delay: 100, duration: 300 }}\r\n\t\t>\r\n\t\t\t<div class=\" flex flex-col md:flex-row md:items-center flex-1 text-sm w-fit gap-1.5\">\r\n\t\t\t\t<div class=\"flex justify-between self-start\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclass=\" text-xs font-bold {classNames[banner.type] ??\r\n\t\t\t\t\t\t\tclassNames['info']}  w-fit px-2 rounded uppercase line-clamp-1 mr-0.5\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{banner.type}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{#if banner.url}\r\n\t\t\t\t\t\t<div class=\"flex md:hidden group w-fit md:items-center\">\r\n\t\t\t\t\t\t\t<a\r\n\t\t\t\t\t\t\t\tclass=\"text-gray-700 dark:text-white text-xs font-semibold underline\"\r\n\t\t\t\t\t\t\t\thref=\"/assets/files/whitepaper.pdf\"\r\n\t\t\t\t\t\t\t\ttarget=\"_blank\">Learn More</a\r\n\t\t\t\t\t\t\t>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<!--  -->\r\n\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\r\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\r\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t{/if}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"flex-1 text-xs text-gray-700 dark:text-white\">\r\n\t\t\t\t\t{banner.content}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t{#if banner.url}\r\n\t\t\t\t<div class=\"hidden md:flex group w-fit md:items-center\">\r\n\t\t\t\t\t<a\r\n\t\t\t\t\t\tclass=\"text-gray-700 dark:text-white text-xs font-semibold underline\"\r\n\t\t\t\t\t\thref=\"/\"\r\n\t\t\t\t\t\ttarget=\"_blank\">Learn More</a\r\n\t\t\t\t\t>\r\n\r\n\t\t\t\t\t<div class=\" ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white\">\r\n\t\t\t\t\t\t<!--  -->\r\n\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\r\n\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\tclass=\"size-4\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\r\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t{/if}\r\n\t\t\t<div class=\"flex self-start\">\r\n\t\t\t\t{#if banner.dismissible}\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\tdismiss(banner.id);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tclass=\"  -mt-1 -mb-2 -translate-y-[1px] ml-1.5 mr-1 text-gray-400 dark:hover:text-white\"\r\n\t\t\t\t\t\t>&times;</button\r\n\t\t\t\t\t>\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t{/if}\r\n{/if}\r\n","<script lang=\"ts\">\r\n\texport let className = 'size-4';\r\n</script>\r\n\r\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\r\n\t<path\r\n\t\tfill-rule=\"evenodd\"\r\n\t\td=\"M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6.905 9.97a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72V18a.75.75 0 0 0 1.5 0v-4.19l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z\"\r\n\t\tclip-rule=\"evenodd\"\r\n\t/>\r\n\t<path\r\n\t\td=\"M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z\"\r\n\t/>\r\n</svg>\r\n","<script lang=\"ts\">\r\n\texport let className = 'size-4';\r\n</script>\r\n\r\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\r\n\t<path\r\n\t\td=\"M21.721 12.752a9.711 9.711 0 0 0-.945-5.003 12.754 12.754 0 0 1-4.339 2.708 18.991 18.991 0 0 1-.214 4.772 17.165 17.165 0 0 0 5.498-2.477ZM14.634 15.55a17.324 17.324 0 0 0 .332-4.647c-.952.227-1.945.347-2.966.347-1.021 0-2.014-.12-2.966-.347a17.515 17.515 0 0 0 .332 4.647 17.385 17.385 0 0 0 5.268 0ZM9.772 17.119a18.963 18.963 0 0 0 4.456 0A17.182 17.182 0 0 1 12 21.724a17.18 17.18 0 0 1-2.228-4.605ZM7.777 15.23a18.87 18.87 0 0 1-.214-4.774 12.753 12.753 0 0 1-4.34-2.708 9.711 9.711 0 0 0-.944 5.004 17.165 17.165 0 0 0 5.498 2.477ZM21.356 14.752a9.765 9.765 0 0 1-7.478 6.817 18.64 18.64 0 0 0 1.988-4.718 18.627 18.627 0 0 0 5.49-2.098ZM2.644 14.752c1.682.971 3.53 1.688 5.49 2.099a18.64 18.64 0 0 0 1.988 4.718 9.765 9.765 0 0 1-7.478-6.816ZM13.878 2.43a9.755 9.755 0 0 1 6.116 3.986 11.267 11.267 0 0 1-3.746 2.504 18.63 18.63 0 0 0-2.37-6.49ZM12 2.276a17.152 17.152 0 0 1 2.805 7.121c-.897.23-1.837.353-2.805.353-.968 0-1.908-.122-2.805-.353A17.151 17.151 0 0 1 12 2.276ZM10.122 2.43a18.629 18.629 0 0 0-2.37 6.49 11.266 11.266 0 0 1-3.746-2.504 9.754 9.754 0 0 1 6.116-3.985Z\"\r\n\t/>\r\n</svg>\r\n","<script lang=\"ts\">\r\n\texport let className = 'size-4';\r\n</script>\r\n\r\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\r\n\t<path\r\n\t\tfill-rule=\"evenodd\"\r\n\t\td=\"M12 6.75a5.25 5.25 0 0 1 6.775-5.025.75.75 0 0 1 .313 1.248l-3.32 3.319c.063.475.276.934.641 1.299.365.365.824.578 1.3.64l3.318-3.319a.75.75 0 0 1 1.248.313 5.25 5.25 0 0 1-5.472 6.756c-1.018-.086-1.87.1-2.309.634L7.344 21.3A3.298 3.298 0 1 1 2.7 16.657l8.684-7.151c.533-.44.72-1.291.634-2.309A5.342 5.342 0 0 1 12 6.75ZM4.117 19.125a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75h-.008a.75.75 0 0 1-.75-.75v-.008Z\"\r\n\t\tclip-rule=\"evenodd\"\r\n\t/>\r\n</svg>\r\n","<script lang=\"ts\">\r\n\timport { DropdownMenu } from 'bits-ui';\r\n\timport { flyAndScale } from '$lib/utils/transitions';\r\n\timport { getContext } from 'svelte';\r\n\r\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\r\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\r\n\timport DocumentArrowUpSolid from '$lib/components/icons/DocumentArrowUpSolid.svelte';\r\n\timport Switch from '$lib/components/common/Switch.svelte';\r\n\timport GlobeAltSolid from '$lib/components/icons/GlobeAltSolid.svelte';\r\n\timport { config } from '$lib/stores';\r\n\timport WrenchSolid from '$lib/components/icons/WrenchSolid.svelte';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let uploadFilesHandler: Function;\r\n\r\n\texport let selectedToolIds: string[] = [];\r\n\texport let webSearchEnabled: boolean;\r\n\r\n\texport let tools = {};\r\n\texport let onClose: Function;\r\n\r\n\t$: tools = Object.fromEntries(\r\n\t\tObject.keys(tools).map((toolId) => [\r\n\t\t\ttoolId,\r\n\t\t\t{\r\n\t\t\t\t...tools[toolId],\r\n\t\t\t\tenabled: selectedToolIds.includes(toolId)\r\n\t\t\t}\r\n\t\t])\r\n\t);\r\n\r\n\tlet show = false;\r\n</script>\r\n\r\n<Dropdown\r\n\tbind:show\r\n\ton:change={(e) => {\r\n\t\tif (e.detail === false) {\r\n\t\t\tonClose();\r\n\t\t}\r\n\t}}\r\n>\r\n\t<Tooltip content={$i18n.t('More')}>\r\n\t\t<slot />\r\n\t</Tooltip>\r\n\r\n\t<div slot=\"content\">\r\n\t\t<DropdownMenu.Content\r\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1  border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow\"\r\n\t\t\tsideOffset={15}\r\n\t\t\talignOffset={-8}\r\n\t\t\tside=\"top\"\r\n\t\t\talign=\"start\"\r\n\t\t\ttransition={flyAndScale}\r\n\t\t>\r\n\t\t\t{#if Object.keys(tools).length > 0}\r\n\t\t\t\t<div class=\"  max-h-28 overflow-y-auto scrollbar-hidden\">\r\n\t\t\t\t\t{#each Object.keys(tools) as toolId}\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\"flex-1 flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t<WrenchSolid />\r\n\t\t\t\t\t\t\t\t<Tooltip content={tools[toolId]?.description ?? ''} className=\"flex-1\">\r\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">{tools[toolId].name}</div>\r\n\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<Switch\r\n\t\t\t\t\t\t\t\tbind:state={tools[toolId].enabled}\r\n\t\t\t\t\t\t\t\ton:change={(e) => {\r\n\t\t\t\t\t\t\t\t\tselectedToolIds = e.detail\r\n\t\t\t\t\t\t\t\t\t\t? [...selectedToolIds, toolId]\r\n\t\t\t\t\t\t\t\t\t\t: selectedToolIds.filter((id) => id !== toolId);\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t{/each}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 my-1\" />\r\n\t\t\t{/if}\r\n\r\n\t\t\t{#if $config?.features?.enable_web_search}\r\n\t\t\t\t<div\r\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div class=\"flex-1 flex items-center gap-2\">\r\n\t\t\t\t\t\t<GlobeAltSolid />\r\n\t\t\t\t\t\t<div class=\" line-clamp-1\">{$i18n.t('Web Search')}</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<Switch bind:state={webSearchEnabled} />\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 my-1\" />\r\n\t\t\t{/if}\r\n\r\n\t\t\t<DropdownMenu.Item\r\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl\"\r\n\t\t\t\ton:click={() => {\r\n\t\t\t\t\tuploadFilesHandler();\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<DocumentArrowUpSolid />\r\n\t\t\t\t<div class=\" line-clamp-1\">{$i18n.t('Upload Files')}</div>\r\n\t\t\t</DropdownMenu.Item>\r\n\t\t</DropdownMenu.Content>\r\n\t</div>\r\n</Dropdown>\r\n","<script lang=\"ts\">\r\n\texport let className = 'w-4 h-4';\r\n\texport let strokeWidth = '0';\r\n</script>\r\n\r\n<svg\r\n\taria-hidden=\"true\"\r\n\txmlns=\"http://www.w3.org/2000/svg\"\r\n\tfill=\"currentColor\"\r\n\tviewBox=\"0 0 24 24\"\r\n\tstroke-width={strokeWidth}\r\n\tstroke=\"currentColor\"\r\n\tclass={className}\r\n>\r\n\t<path\r\n\t\tfill-rule=\"evenodd\"\r\n\t\td=\"M12 5a7 7 0 0 0-7 7v1.17c.313-.11.65-.17 1-.17h2a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a3 3 0 0 1-3-3v-6a9 9 0 0 1 18 0v6a3 3 0 0 1-3 3h-2a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2c.35 0 .687.06 1 .17V12a7 7 0 0 0-7-7Z\"\r\n\t\tclip-rule=\"evenodd\"\r\n\t/>\r\n</svg>\r\n","<script lang=\"ts\">\r\n\timport { toast } from 'svelte-sonner';\r\n\timport { createEventDispatcher, tick, getContext } from 'svelte';\r\n\timport { config, settings } from '$lib/stores';\r\n\timport { blobToFile, calculateSHA256, findWordIndices } from '$lib/utils';\r\n\r\n\timport { transcribeAudio } from '$lib/apis/audio';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\texport let recording = false;\r\n\r\n\tlet loading = false;\r\n\tlet confirmed = false;\r\n\r\n\tlet durationSeconds = 0;\r\n\tlet durationCounter = null;\r\n\r\n\tlet transcription = '';\r\n\r\n\tconst startDurationCounter = () => {\r\n\t\tdurationCounter = setInterval(() => {\r\n\t\t\tdurationSeconds++;\r\n\t\t}, 1000);\r\n\t};\r\n\r\n\tconst stopDurationCounter = () => {\r\n\t\tclearInterval(durationCounter);\r\n\t\tdurationSeconds = 0;\r\n\t};\r\n\r\n\t$: if (recording) {\r\n\t\tstartRecording();\r\n\t} else {\r\n\t\tstopRecording();\r\n\t}\r\n\r\n\tconst formatSeconds = (seconds) => {\r\n\t\tconst minutes = Math.floor(seconds / 60);\r\n\t\tconst remainingSeconds = seconds % 60;\r\n\t\tconst formattedSeconds = remainingSeconds < 10 ? `0${remainingSeconds}` : remainingSeconds;\r\n\t\treturn `${minutes}:${formattedSeconds}`;\r\n\t};\r\n\r\n\tlet speechRecognition;\r\n\r\n\tlet mediaRecorder;\r\n\tlet audioChunks = [];\r\n\r\n\tconst MIN_DECIBELS = -45;\r\n\tconst VISUALIZER_BUFFER_LENGTH = 300;\r\n\r\n\tlet visualizerData = Array(VISUALIZER_BUFFER_LENGTH).fill(0);\r\n\r\n\t// Function to calculate the RMS level from time domain data\r\n\tconst calculateRMS = (data: Uint8Array) => {\r\n\t\tlet sumSquares = 0;\r\n\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\r\n\t\t\tsumSquares += normalizedValue * normalizedValue;\r\n\t\t}\r\n\t\treturn Math.sqrt(sumSquares / data.length);\r\n\t};\r\n\r\n\tconst normalizeRMS = (rms) => {\r\n\t\trms = rms * 10;\r\n\t\tconst exp = 1.5; // Adjust exponent value; values greater than 1 expand larger numbers more and compress smaller numbers more\r\n\t\tconst scaledRMS = Math.pow(rms, exp);\r\n\r\n\t\t// Scale between 0.01 (1%) and 1.0 (100%)\r\n\t\treturn Math.min(1.0, Math.max(0.01, scaledRMS));\r\n\t};\r\n\r\n\tconst analyseAudio = (stream) => {\r\n\t\tconst audioContext = new AudioContext();\r\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\r\n\r\n\t\tconst analyser = audioContext.createAnalyser();\r\n\t\tanalyser.minDecibels = MIN_DECIBELS;\r\n\t\taudioStreamSource.connect(analyser);\r\n\r\n\t\tconst bufferLength = analyser.frequencyBinCount;\r\n\r\n\t\tconst domainData = new Uint8Array(bufferLength);\r\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\r\n\r\n\t\tlet lastSoundTime = Date.now();\r\n\r\n\t\tconst detectSound = () => {\r\n\t\t\tconst processFrame = () => {\r\n\t\t\t\tif (!recording || loading) return;\r\n\r\n\t\t\t\tif (recording && !loading) {\r\n\t\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\r\n\t\t\t\t\tanalyser.getByteFrequencyData(domainData);\r\n\r\n\t\t\t\t\t// Calculate RMS level from time domain data\r\n\t\t\t\t\tconst rmsLevel = calculateRMS(timeDomainData);\r\n\t\t\t\t\t// Push the calculated decibel level to visualizerData\r\n\t\t\t\t\tvisualizerData.push(normalizeRMS(rmsLevel));\r\n\r\n\t\t\t\t\t// Ensure visualizerData array stays within the buffer length\r\n\t\t\t\t\tif (visualizerData.length >= VISUALIZER_BUFFER_LENGTH) {\r\n\t\t\t\t\t\tvisualizerData.shift();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvisualizerData = visualizerData;\r\n\r\n\t\t\t\t\t// if (domainData.some((value) => value > 0)) {\r\n\t\t\t\t\t// \tlastSoundTime = Date.now();\r\n\t\t\t\t\t// }\r\n\r\n\t\t\t\t\t// if (recording && Date.now() - lastSoundTime > 3000) {\r\n\t\t\t\t\t// \tif ($settings?.speechAutoSend ?? false) {\r\n\t\t\t\t\t// \t\tconfirmRecording();\r\n\t\t\t\t\t// \t}\r\n\t\t\t\t\t// }\r\n\t\t\t\t}\r\n\r\n\t\t\t\twindow.requestAnimationFrame(processFrame);\r\n\t\t\t};\r\n\r\n\t\t\twindow.requestAnimationFrame(processFrame);\r\n\t\t};\r\n\r\n\t\tdetectSound();\r\n\t};\r\n\r\n\tconst transcribeHandler = async (audioBlob) => {\r\n\t\t// Create a blob from the audio chunks\r\n\r\n\t\tawait tick();\r\n\t\tconst file = blobToFile(audioBlob, 'recording.wav');\r\n\r\n\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\r\n\t\t\ttoast.error(error);\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (res) {\r\n\t\t\tconsole.log(res.text);\r\n\t\t\tdispatch('confirm', res.text);\r\n\t\t}\r\n\t};\r\n\r\n\tconst saveRecording = (blob) => {\r\n\t\tconst url = URL.createObjectURL(blob);\r\n\t\tconst a = document.createElement('a');\r\n\t\tdocument.body.appendChild(a);\r\n\t\ta.style = 'display: none';\r\n\t\ta.href = url;\r\n\t\ta.download = 'recording.wav';\r\n\t\ta.click();\r\n\t\twindow.URL.revokeObjectURL(url);\r\n\t};\r\n\r\n\tconst startRecording = async () => {\r\n\t\tstartDurationCounter();\r\n\r\n\t\tconst stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n\t\tmediaRecorder = new MediaRecorder(stream);\r\n\t\tmediaRecorder.onstart = () => {\r\n\t\t\tconsole.log('Recording started');\r\n\t\t\taudioChunks = [];\r\n\t\t\tanalyseAudio(stream);\r\n\t\t};\r\n\t\tmediaRecorder.ondataavailable = (event) => audioChunks.push(event.data);\r\n\t\tmediaRecorder.onstop = async () => {\r\n\t\t\tconsole.log('Recording stopped');\r\n\t\t\tif (($settings?.audio?.stt?.engine ?? '') === 'web') {\r\n\t\t\t\taudioChunks = [];\r\n\t\t\t} else {\r\n\t\t\t\tif (confirmed) {\r\n\t\t\t\t\tconst audioBlob = new Blob(audioChunks, { type: 'audio/wav' });\r\n\r\n\t\t\t\t\tawait transcribeHandler(audioBlob);\r\n\r\n\t\t\t\t\tconfirmed = false;\r\n\t\t\t\t\tloading = false;\r\n\t\t\t\t}\r\n\t\t\t\taudioChunks = [];\r\n\t\t\t\trecording = false;\r\n\t\t\t}\r\n\t\t};\r\n\t\tmediaRecorder.start();\r\n\t\tif ($config.audio.stt.engine === 'web' || ($settings?.audio?.stt?.engine ?? '') === 'web') {\r\n\t\t\tif ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {\r\n\t\t\t\t// Create a SpeechRecognition object\r\n\t\t\t\tspeechRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();\r\n\r\n\t\t\t\t// Set continuous to true for continuous recognition\r\n\t\t\t\tspeechRecognition.continuous = true;\r\n\r\n\t\t\t\t// Set the timeout for turning off the recognition after inactivity (in milliseconds)\r\n\t\t\t\tconst inactivityTimeout = 2000; // 3 seconds\r\n\r\n\t\t\t\tlet timeoutId;\r\n\t\t\t\t// Start recognition\r\n\t\t\t\tspeechRecognition.start();\r\n\r\n\t\t\t\t// Event triggered when speech is recognized\r\n\t\t\t\tspeechRecognition.onresult = async (event) => {\r\n\t\t\t\t\t// Clear the inactivity timeout\r\n\t\t\t\t\tclearTimeout(timeoutId);\r\n\r\n\t\t\t\t\t// Handle recognized speech\r\n\t\t\t\t\tconsole.log(event);\r\n\t\t\t\t\tconst transcript = event.results[Object.keys(event.results).length - 1][0].transcript;\r\n\r\n\t\t\t\t\ttranscription = `${transcription}${transcript}`;\r\n\r\n\t\t\t\t\tawait tick();\r\n\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\r\n\r\n\t\t\t\t\t// Restart the inactivity timeout\r\n\t\t\t\t\ttimeoutId = setTimeout(() => {\r\n\t\t\t\t\t\tconsole.log('Speech recognition turned off due to inactivity.');\r\n\t\t\t\t\t\tspeechRecognition.stop();\r\n\t\t\t\t\t}, inactivityTimeout);\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Event triggered when recognition is ended\r\n\t\t\t\tspeechRecognition.onend = function () {\r\n\t\t\t\t\t// Restart recognition after it ends\r\n\t\t\t\t\tconsole.log('recognition ended');\r\n\r\n\t\t\t\t\tconfirmRecording();\r\n\t\t\t\t\tdispatch('confirm', transcription);\r\n\r\n\t\t\t\t\tconfirmed = false;\r\n\t\t\t\t\tloading = false;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Event triggered when an error occurs\r\n\t\t\t\tspeechRecognition.onerror = function (event) {\r\n\t\t\t\t\tconsole.log(event);\r\n\t\t\t\t\ttoast.error($i18n.t(`Speech recognition error: {{error}}`, { error: event.error }));\r\n\t\t\t\t\tdispatch('cancel');\r\n\r\n\t\t\t\t\tstopRecording();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst stopRecording = async () => {\r\n\t\tif (recording && mediaRecorder) {\r\n\t\t\tawait mediaRecorder.stop();\r\n\t\t}\r\n\t\tstopDurationCounter();\r\n\t\taudioChunks = [];\r\n\t};\r\n\r\n\tconst confirmRecording = async () => {\r\n\t\tloading = true;\r\n\t\tconfirmed = true;\r\n\r\n\t\tif (recording && mediaRecorder) {\r\n\t\t\tawait mediaRecorder.stop();\r\n\t\t}\r\n\t\tclearInterval(durationCounter);\r\n\t};\r\n</script>\r\n\r\n<div\r\n\tclass=\"{loading\r\n\t\t? ' bg-gray-100/50 dark:bg-gray-850/50'\r\n\t\t: 'bg-indigo-300/10 dark:bg-indigo-500/10 '} rounded-full flex p-2.5\"\r\n>\r\n\t<div class=\"flex items-center mr-1\">\r\n\t\t<button\r\n\t\t\ttype=\"button\"\r\n\t\t\tclass=\"p-1.5\r\n\r\n            {loading\r\n\t\t\t\t? ' bg-gray-200 dark:bg-gray-700/50'\r\n\t\t\t\t: 'bg-indigo-400/20 text-indigo-600 dark:text-indigo-300 '} \r\n\r\n\r\n             rounded-full\"\r\n\t\t\ton:click={async () => {\r\n\t\t\t\tdispatch('cancel');\r\n\t\t\t\tstopRecording();\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<svg\r\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\tfill=\"none\"\r\n\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\tstroke-width=\"3\"\r\n\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\tclass=\"size-4\"\r\n\t\t\t>\r\n\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18 18 6M6 6l12 12\" />\r\n\t\t\t</svg>\r\n\t\t</button>\r\n\t</div>\r\n\r\n\t<div\r\n\t\tclass=\"flex flex-1 self-center items-center justify-between ml-2 mx-1 overflow-hidden h-6\"\r\n\t\tdir=\"rtl\"\r\n\t>\r\n\t\t<div class=\"flex-1 flex items-center gap-0.5 h-6\">\r\n\t\t\t{#each visualizerData.slice().reverse() as rms}\r\n\t\t\t\t<div\r\n\t\t\t\t\tclass=\"w-[2px]\r\n                    \r\n                    {loading\r\n\t\t\t\t\t\t? ' bg-gray-500 dark:bg-gray-400   '\r\n\t\t\t\t\t\t: 'bg-indigo-500 dark:bg-indigo-400  '} \r\n                    \r\n                    inline-block h-full\"\r\n\t\t\t\t\tstyle=\"height: {Math.min(100, Math.max(14, rms * 100))}%;\"\r\n\t\t\t\t/>\r\n\t\t\t{/each}\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div class=\"  mx-1.5 pr-1 flex justify-center items-center\">\r\n\t\t<div\r\n\t\t\tclass=\"text-sm\r\n        \r\n        \r\n        {loading ? ' text-gray-500  dark:text-gray-400  ' : ' text-indigo-400 '} \r\n       font-medium flex-1 mx-auto text-center\"\r\n\t\t>\r\n\t\t\t{formatSeconds(durationSeconds)}\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div class=\"flex items-center mr-1\">\r\n\t\t{#if loading}\r\n\t\t\t<div class=\" text-gray-500 rounded-full cursor-not-allowed\">\r\n\t\t\t\t<svg\r\n\t\t\t\t\twidth=\"24\"\r\n\t\t\t\t\theight=\"24\"\r\n\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t><style>\r\n\t\t\t\t\t\t.spinner_OSmW {\r\n\t\t\t\t\t\t\ttransform-origin: center;\r\n\t\t\t\t\t\t\tanimation: spinner_T6mA 0.75s step-end infinite;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t@keyframes spinner_T6mA {\r\n\t\t\t\t\t\t\t8.3% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(30deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t16.6% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(60deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t25% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(90deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t33.3% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(120deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t41.6% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(150deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t50% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(180deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t58.3% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(210deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t66.6% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(240deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t75% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(270deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t83.3% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(300deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t91.6% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(330deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t100% {\r\n\t\t\t\t\t\t\t\ttransform: rotate(360deg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</style><g class=\"spinner_OSmW\"\r\n\t\t\t\t\t\t><rect x=\"11\" y=\"1\" width=\"2\" height=\"5\" opacity=\".14\" /><rect\r\n\t\t\t\t\t\t\tx=\"11\"\r\n\t\t\t\t\t\t\ty=\"1\"\r\n\t\t\t\t\t\t\twidth=\"2\"\r\n\t\t\t\t\t\t\theight=\"5\"\r\n\t\t\t\t\t\t\ttransform=\"rotate(30 12 12)\"\r\n\t\t\t\t\t\t\topacity=\".29\"\r\n\t\t\t\t\t\t/><rect\r\n\t\t\t\t\t\t\tx=\"11\"\r\n\t\t\t\t\t\t\ty=\"1\"\r\n\t\t\t\t\t\t\twidth=\"2\"\r\n\t\t\t\t\t\t\theight=\"5\"\r\n\t\t\t\t\t\t\ttransform=\"rotate(60 12 12)\"\r\n\t\t\t\t\t\t\topacity=\".43\"\r\n\t\t\t\t\t\t/><rect\r\n\t\t\t\t\t\t\tx=\"11\"\r\n\t\t\t\t\t\t\ty=\"1\"\r\n\t\t\t\t\t\t\twidth=\"2\"\r\n\t\t\t\t\t\t\theight=\"5\"\r\n\t\t\t\t\t\t\ttransform=\"rotate(90 12 12)\"\r\n\t\t\t\t\t\t\topacity=\".57\"\r\n\t\t\t\t\t\t/><rect\r\n\t\t\t\t\t\t\tx=\"11\"\r\n\t\t\t\t\t\t\ty=\"1\"\r\n\t\t\t\t\t\t\twidth=\"2\"\r\n\t\t\t\t\t\t\theight=\"5\"\r\n\t\t\t\t\t\t\ttransform=\"rotate(120 12 12)\"\r\n\t\t\t\t\t\t\topacity=\".71\"\r\n\t\t\t\t\t\t/><rect\r\n\t\t\t\t\t\t\tx=\"11\"\r\n\t\t\t\t\t\t\ty=\"1\"\r\n\t\t\t\t\t\t\twidth=\"2\"\r\n\t\t\t\t\t\t\theight=\"5\"\r\n\t\t\t\t\t\t\ttransform=\"rotate(150 12 12)\"\r\n\t\t\t\t\t\t\topacity=\".86\"\r\n\t\t\t\t\t\t/><rect x=\"11\" y=\"1\" width=\"2\" height=\"5\" transform=\"rotate(180 12 12)\" /></g\r\n\t\t\t\t\t></svg\r\n\t\t\t\t>\r\n\t\t\t</div>\r\n\t\t{:else}\r\n\t\t\t<button\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tclass=\"p-1.5 bg-indigo-500 text-white dark:bg-indigo-500 dark:text-blue-950 rounded-full\"\r\n\t\t\t\ton:click={async () => {\r\n\t\t\t\t\tawait confirmRecording();\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<svg\r\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\tstroke-width=\"2.5\"\r\n\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\tclass=\"size-4\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m4.5 12.75 6 6 9-13.5\" />\r\n\t\t\t\t</svg>\r\n\t\t\t</button>\r\n\t\t{/if}\r\n\t</div>\r\n</div>\r\n\r\n<style>\r\n\t.visualizer {\r\n\t\tdisplay: flex;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.visualizer-bar {\r\n\t\twidth: 2px;\r\n\t\tbackground-color: #4a5aba; /* or whatever color you need */\r\n\t}\r\n</style>\r\n","<script lang=\"ts\">\r\n\timport { showSidebar } from '$lib/stores';\r\n\timport AddFilesPlaceholder from '$lib/components/AddFilesPlaceholder.svelte';\r\n\r\n\texport let show = false;\r\n\tlet overlayElement = null;\r\n\r\n\t$: if (show && overlayElement) {\r\n\t\tdocument.body.appendChild(overlayElement);\r\n\t\tdocument.body.style.overflow = 'hidden';\r\n\t} else if (overlayElement) {\r\n\t\tdocument.body.removeChild(overlayElement);\r\n\t\tdocument.body.style.overflow = 'unset';\r\n\t}\r\n</script>\r\n\r\n{#if show}\r\n\t<div\r\n\t\tbind:this={overlayElement}\r\n\t\tclass=\"fixed {$showSidebar\r\n\t\t\t? 'left-0 md:left-[260px] md:w-[calc(100%-260px)]'\r\n\t\t\t: 'left-0'}  fixed top-0 right-0 bottom-0 w-full h-full flex z-[9999] touch-none pointer-events-none\"\r\n\t\tid=\"dropzone\"\r\n\t\trole=\"region\"\r\n\t\taria-label=\"Drag and Drop Container\"\r\n\t>\r\n\t\t<div class=\"absolute w-full h-full backdrop-blur bg-gray-800/40 flex justify-center\">\r\n\t\t\t<div class=\"m-auto pt-64 flex flex-col justify-center\">\r\n\t\t\t\t<div class=\"max-w-md\">\r\n\t\t\t\t\t<AddFilesPlaceholder />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n","<script lang=\"ts\">\r\n\timport { prompts } from '$lib/stores';\r\n\timport { findWordIndices } from '$lib/utils';\r\n\timport { tick, getContext } from 'svelte';\r\n\timport { toast } from 'svelte-sonner';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let files;\r\n\r\n\texport let prompt = '';\r\n\texport let command = '';\r\n\r\n\tlet selectedPromptIdx = 0;\r\n\tlet filteredPrompts = [];\r\n\r\n\t$: filteredPrompts = $prompts\r\n\t\t.filter((p) => p.command.toLowerCase().includes(command.toLowerCase()))\r\n\t\t.sort((a, b) => a.title.localeCompare(b.title));\r\n\r\n\t$: if (command) {\r\n\t\tselectedPromptIdx = 0;\r\n\t}\r\n\r\n\texport const selectUp = () => {\r\n\t\tselectedPromptIdx = Math.max(0, selectedPromptIdx - 1);\r\n\t};\r\n\r\n\texport const selectDown = () => {\r\n\t\tselectedPromptIdx = Math.min(selectedPromptIdx + 1, filteredPrompts.length - 1);\r\n\t};\r\n\r\n\tconst confirmPrompt = async (command) => {\r\n\t\tlet text = command.content;\r\n\r\n\t\tif (command.content.includes('{{CLIPBOARD}}')) {\r\n\t\t\tconst clipboardText = await navigator.clipboard.readText().catch((err) => {\r\n\t\t\t\ttoast.error($i18n.t('Failed to read clipboard contents'));\r\n\t\t\t\treturn '{{CLIPBOARD}}';\r\n\t\t\t});\r\n\r\n\t\t\tconsole.log(clipboardText);\r\n\r\n\t\t\tconst clipboardItems = await navigator.clipboard.read();\r\n\r\n\t\t\tlet imageUrl = null;\r\n\t\t\tfor (const item of clipboardItems) {\r\n\t\t\t\t// Check for known image types\r\n\t\t\t\tfor (const type of item.types) {\r\n\t\t\t\t\tif (type.startsWith('image/')) {\r\n\t\t\t\t\t\tconst blob = await item.getType(type);\r\n\t\t\t\t\t\timageUrl = URL.createObjectURL(blob);\r\n\t\t\t\t\t\tconsole.log(`Image URL (${type}): ${imageUrl}`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (imageUrl) {\r\n\t\t\t\tfiles = [\r\n\t\t\t\t\t...files,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\turl: imageUrl\r\n\t\t\t\t\t}\r\n\t\t\t\t];\r\n\t\t\t}\r\n\r\n\t\t\ttext = command.content.replaceAll('{{CLIPBOARD}}', clipboardText);\r\n\t\t}\r\n\r\n\t\tprompt = text;\r\n\r\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\r\n\r\n\t\tawait tick();\r\n\r\n\t\tchatInputElement.style.height = '';\r\n\t\tchatInputElement.style.height = Math.min(chatInputElement.scrollHeight, 200) + 'px';\r\n\r\n\t\tchatInputElement?.focus();\r\n\r\n\t\tawait tick();\r\n\r\n\t\tconst words = findWordIndices(prompt);\r\n\t\tif (words.length > 0) {\r\n\t\t\tconst word = words.at(0);\r\n\t\t\tchatInputElement.setSelectionRange(word?.startIndex, word.endIndex + 1);\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n{#if filteredPrompts.length > 0}\r\n\t<div\r\n\t\tid=\"commands-container\"\r\n\t\tclass=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0 z-10\"\r\n\t>\r\n\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\r\n\t\t\t<div class=\"  bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\r\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">/</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div\r\n\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100\"\r\n\t\t\t>\r\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden\">\r\n\t\t\t\t\t{#each filteredPrompts as prompt, promptIdx}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {promptIdx === selectedPromptIdx\r\n\t\t\t\t\t\t\t\t? '  bg-gray-50 dark:bg-gray-850 selected-command-option-button'\r\n\t\t\t\t\t\t\t\t: ''}\"\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tconfirmPrompt(prompt);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:mousemove={() => {\r\n\t\t\t\t\t\t\t\tselectedPromptIdx = promptIdx;\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:focus={() => {}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100\">\r\n\t\t\t\t\t\t\t\t{prompt.command}\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100\">\r\n\t\t\t\t\t\t\t\t{prompt.title}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t{/each}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div\r\n\t\t\t\t\tclass=\" px-2 pb-1 text-xs text-gray-600 dark:text-gray-100 bg-white dark:bg-gray-900 rounded-br-xl flex items-center space-x-1\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\tclass=\"w-3 h-3\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\t\t\td=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"line-clamp-1\">\r\n\t\t\t\t\t\t{$i18n.t(\r\n\t\t\t\t\t\t\t'Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.'\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n","<script lang=\"ts\">\r\n\timport { createEventDispatcher } from 'svelte';\r\n\r\n\timport { documents } from '$lib/stores';\r\n\timport { removeLastWordFromString, isValidHttpUrl } from '$lib/utils';\r\n\timport { tick, getContext } from 'svelte';\r\n\timport { toast } from 'svelte-sonner';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let prompt = '';\r\n\texport let command = '';\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\tlet selectedIdx = 0;\r\n\r\n\tlet filteredItems = [];\r\n\tlet filteredDocs = [];\r\n\r\n\tlet collections = [];\r\n\r\n\t$: collections = [\r\n\t\t...($documents.length > 0\r\n\t\t\t? [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: 'All Documents',\r\n\t\t\t\t\t\ttype: 'collection',\r\n\t\t\t\t\t\ttitle: $i18n.t('All Documents'),\r\n\t\t\t\t\t\tcollection_names: $documents.map((doc) => doc.collection_name)\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t: []),\r\n\t\t...$documents\r\n\t\t\t.reduce((a, e, i, arr) => {\r\n\t\t\t\treturn [...new Set([...a, ...(e?.content?.tags ?? []).map((tag) => tag.name)])];\r\n\t\t\t}, [])\r\n\t\t\t.map((tag) => ({\r\n\t\t\t\tname: tag,\r\n\t\t\t\ttype: 'collection',\r\n\t\t\t\tcollection_names: $documents\r\n\t\t\t\t\t.filter((doc) => (doc?.content?.tags ?? []).map((tag) => tag.name).includes(tag))\r\n\t\t\t\t\t.map((doc) => doc.collection_name)\r\n\t\t\t}))\r\n\t];\r\n\r\n\t$: filteredCollections = collections\r\n\t\t.filter((collection) => findByName(collection, command))\r\n\t\t.sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n\t$: filteredDocs = $documents\r\n\t\t.filter((doc) => findByName(doc, command))\r\n\t\t.sort((a, b) => a.title.localeCompare(b.title));\r\n\r\n\t$: filteredItems = [...filteredCollections, ...filteredDocs];\r\n\r\n\t$: if (command) {\r\n\t\tselectedIdx = 0;\r\n\r\n\t\tconsole.log(filteredCollections);\r\n\t}\r\n\r\n\ttype ObjectWithName = {\r\n\t\tname: string;\r\n\t};\r\n\r\n\tconst findByName = (obj: ObjectWithName, command: string) => {\r\n\t\tconst name = obj.name.toLowerCase();\r\n\t\treturn name.includes(command.toLowerCase().split(' ')?.at(0)?.substring(1) ?? '');\r\n\t};\r\n\r\n\texport const selectUp = () => {\r\n\t\tselectedIdx = Math.max(0, selectedIdx - 1);\r\n\t};\r\n\r\n\texport const selectDown = () => {\r\n\t\tselectedIdx = Math.min(selectedIdx + 1, filteredItems.length - 1);\r\n\t};\r\n\r\n\tconst confirmSelect = async (doc) => {\r\n\t\tdispatch('select', doc);\r\n\r\n\t\tprompt = removeLastWordFromString(prompt, command);\r\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\r\n\r\n\t\tawait tick();\r\n\t\tchatInputElement?.focus();\r\n\t\tawait tick();\r\n\t};\r\n\r\n\tconst confirmSelectWeb = async (url) => {\r\n\t\tdispatch('url', url);\r\n\r\n\t\tprompt = removeLastWordFromString(prompt, command);\r\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\r\n\r\n\t\tawait tick();\r\n\t\tchatInputElement?.focus();\r\n\t\tawait tick();\r\n\t};\r\n\r\n\tconst confirmSelectYoutube = async (url) => {\r\n\t\tdispatch('youtube', url);\r\n\r\n\t\tprompt = removeLastWordFromString(prompt, command);\r\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\r\n\r\n\t\tawait tick();\r\n\t\tchatInputElement?.focus();\r\n\t\tawait tick();\r\n\t};\r\n</script>\r\n\r\n{#if filteredItems.length > 0 || prompt.split(' ')?.at(0)?.substring(1).startsWith('http')}\r\n\t<div\r\n\t\tid=\"commands-container\"\r\n\t\tclass=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0 z-10\"\r\n\t>\r\n\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\r\n\t\t\t<div class=\" bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\r\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">#</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div\r\n\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-xl bg-white dark:bg-gray-900 dark:text-gray-100\"\r\n\t\t\t>\r\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5 scrollbar-hidden\">\r\n\t\t\t\t\t{#each filteredItems as doc, docIdx}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {docIdx === selectedIdx\r\n\t\t\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button'\r\n\t\t\t\t\t\t\t\t: ''}\"\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tconsole.log(doc);\r\n\r\n\t\t\t\t\t\t\t\tconfirmSelect(doc);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:mousemove={() => {\r\n\t\t\t\t\t\t\t\tselectedIdx = docIdx;\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:focus={() => {}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{#if doc.type === 'collection'}\r\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\r\n\t\t\t\t\t\t\t\t\t{doc?.title ?? `#${doc.name}`}\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100 line-clamp-1\">\r\n\t\t\t\t\t\t\t\t\t{$i18n.t('Collection')}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{:else}\r\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\r\n\t\t\t\t\t\t\t\t\t#{doc.name} ({doc.filename})\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100 line-clamp-1\">\r\n\t\t\t\t\t\t\t\t\t{doc.title}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t{/each}\r\n\r\n\t\t\t\t\t{#if prompt\r\n\t\t\t\t\t\t.split(' ')\r\n\t\t\t\t\t\t.some((s) => s.substring(1).startsWith('https://www.youtube.com') || s\r\n\t\t\t\t\t\t\t\t\t.substring(1)\r\n\t\t\t\t\t\t\t\t\t.startsWith('https://youtu.be'))}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button\"\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tconst url = prompt.split(' ')?.at(0)?.substring(1);\r\n\t\t\t\t\t\t\t\tif (isValidHttpUrl(url)) {\r\n\t\t\t\t\t\t\t\t\tconfirmSelectYoutube(url);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttoast.error(\r\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\r\n\t\t\t\t\t\t\t\t\t\t\t'Oops! Looks like the URL is invalid. Please double-check and try again.'\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\r\n\t\t\t\t\t\t\t\t{prompt.split(' ')?.at(0)?.substring(1)}\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">{$i18n.t('Youtube')}</div>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t{:else if prompt.split(' ')?.at(0)?.substring(1).startsWith('http')}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button\"\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tconst url = prompt.split(' ')?.at(0)?.substring(1);\r\n\t\t\t\t\t\t\t\tif (isValidHttpUrl(url)) {\r\n\t\t\t\t\t\t\t\t\tconfirmSelectWeb(url);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttoast.error(\r\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\r\n\t\t\t\t\t\t\t\t\t\t\t'Oops! Looks like the URL is invalid. Please double-check and try again.'\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\r\n\t\t\t\t\t\t\t\t{prompt.split(' ')?.at(0)?.substring(1)}\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">{$i18n.t('Web')}</div>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t{/if}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n","<script lang=\"ts\">\r\n\timport { createEventDispatcher, onMount } from 'svelte';\r\n\timport { tick, getContext } from 'svelte';\r\n\r\n\timport { models } from '$lib/stores';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\texport let command = '';\r\n\r\n\tlet selectedIdx = 0;\r\n\tlet filteredModels = [];\r\n\r\n\t$: filteredModels = $models\r\n\t\t.filter((p) =>\r\n\t\t\tp.name.toLowerCase().includes(command.toLowerCase().split(' ')?.at(0)?.substring(1) ?? '')\r\n\t\t)\r\n\t\t.sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n\t$: if (command) {\r\n\t\tselectedIdx = 0;\r\n\t}\r\n\r\n\texport const selectUp = () => {\r\n\t\tselectedIdx = Math.max(0, selectedIdx - 1);\r\n\t};\r\n\r\n\texport const selectDown = () => {\r\n\t\tselectedIdx = Math.min(selectedIdx + 1, filteredModels.length - 1);\r\n\t};\r\n\r\n\tconst confirmSelect = async (model) => {\r\n\t\tcommand = '';\r\n\t\tdispatch('select', model);\r\n\t};\r\n\r\n\tonMount(async () => {\r\n\t\tawait tick();\r\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\r\n\t\tawait tick();\r\n\t\tchatInputElement?.focus();\r\n\t\tawait tick();\r\n\t});\r\n</script>\r\n\r\n{#if filteredModels.length > 0}\r\n\t<div\r\n\t\tid=\"commands-container\"\r\n\t\tclass=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0 z-10\"\r\n\t>\r\n\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\r\n\t\t\t<div class=\" bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\r\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">@</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div\r\n\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100\"\r\n\t\t\t>\r\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden\">\r\n\t\t\t\t\t{#each filteredModels as model, modelIdx}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left {modelIdx === selectedIdx\r\n\t\t\t\t\t\t\t\t? 'bg-gray-50 dark:bg-gray-850 selected-command-option-button'\r\n\t\t\t\t\t\t\t\t: ''}\"\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tconfirmSelect(model);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:mousemove={() => {\r\n\t\t\t\t\t\t\t\tselectedIdx = modelIdx;\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:focus={() => {}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\"flex font-medium text-black dark:text-gray-100 line-clamp-1\">\r\n\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\tsrc={model?.info?.meta?.profile_image_url ?? '/static/favicon.png'}\r\n\t\t\t\t\t\t\t\t\talt={model?.name ?? model.id}\r\n\t\t\t\t\t\t\t\t\tclass=\"rounded-full size-6 items-center mr-2\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t{model.name}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t{/each}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n","<script>\r\n\timport { createEventDispatcher } from 'svelte';\r\n\timport { toast } from 'svelte-sonner';\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\timport Prompts from './Commands/Prompts.svelte';\r\n\timport Documents from './Commands/Documents.svelte';\r\n\timport Models from './Commands/Models.svelte';\r\n\r\n\timport { removeLastWordFromString } from '$lib/utils';\r\n\timport { uploadWebToVectorDB, uploadYoutubeTranscriptionToVectorDB } from '$lib/apis/rag';\r\n\r\n\texport let prompt = '';\r\n\texport let files = [];\r\n\r\n\tlet commandElement = null;\r\n\r\n\texport const selectUp = () => {\r\n\t\tcommandElement?.selectUp();\r\n\t};\r\n\r\n\texport const selectDown = () => {\r\n\t\tcommandElement?.selectDown();\r\n\t};\r\n\r\n\tlet command = '';\r\n\t$: command = (prompt?.trim() ?? '').split(' ')?.at(-1) ?? '';\r\n\r\n\tconst uploadWeb = async (url) => {\r\n\t\tconsole.log(url);\r\n\r\n\t\tconst doc = {\r\n\t\t\ttype: 'doc',\r\n\t\t\tname: url,\r\n\t\t\tcollection_name: '',\r\n\t\t\tstatus: false,\r\n\t\t\turl: url,\r\n\t\t\terror: ''\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\tfiles = [...files, doc];\r\n\t\t\tconst res = await uploadWebToVectorDB(localStorage.token, '', url);\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tdoc.status = 'processed';\r\n\t\t\t\tdoc.collection_name = res.collection_name;\r\n\t\t\t\tfiles = files;\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\t// Remove the failed doc from the files array\r\n\t\t\tfiles = files.filter((f) => f.name !== url);\r\n\t\t\ttoast.error(e);\r\n\t\t}\r\n\t};\r\n\r\n\tconst uploadYoutubeTranscription = async (url) => {\r\n\t\tconsole.log(url);\r\n\r\n\t\tconst doc = {\r\n\t\t\ttype: 'doc',\r\n\t\t\tname: url,\r\n\t\t\tcollection_name: '',\r\n\t\t\tstatus: false,\r\n\t\t\turl: url,\r\n\t\t\terror: ''\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\tfiles = [...files, doc];\r\n\t\t\tconst res = await uploadYoutubeTranscriptionToVectorDB(localStorage.token, url);\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tdoc.status = 'processed';\r\n\t\t\t\tdoc.collection_name = res.collection_name;\r\n\t\t\t\tfiles = files;\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\t// Remove the failed doc from the files array\r\n\t\t\tfiles = files.filter((f) => f.name !== url);\r\n\t\t\ttoast.error(e);\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n{#if ['/', '#', '@'].includes(command?.charAt(0))}\r\n\t{#if command?.charAt(0) === '/'}\r\n\t\t<Prompts bind:this={commandElement} bind:prompt bind:files {command} />\r\n\t{:else if command?.charAt(0) === '#'}\r\n\t\t<Documents\r\n\t\t\tbind:this={commandElement}\r\n\t\t\tbind:prompt\r\n\t\t\t{command}\r\n\t\t\ton:youtube={(e) => {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\tuploadYoutubeTranscription(e.detail);\r\n\t\t\t}}\r\n\t\t\ton:url={(e) => {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\tuploadWeb(e.detail);\r\n\t\t\t}}\r\n\t\t\ton:select={(e) => {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\tfiles = [\r\n\t\t\t\t\t...files,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: e?.detail?.type ?? 'file',\r\n\t\t\t\t\t\t...e.detail,\r\n\t\t\t\t\t\tstatus: 'processed'\r\n\t\t\t\t\t}\r\n\t\t\t\t];\r\n\r\n\t\t\t\tdispatch('select');\r\n\t\t\t}}\r\n\t\t/>\r\n\t{:else if command?.charAt(0) === '@'}\r\n\t\t<Models\r\n\t\t\tbind:this={commandElement}\r\n\t\t\t{command}\r\n\t\t\ton:select={(e) => {\r\n\t\t\t\tprompt = removeLastWordFromString(prompt, command);\r\n\r\n\t\t\t\tdispatch('select', {\r\n\t\t\t\t\ttype: 'model',\r\n\t\t\t\t\tdata: e.detail\r\n\t\t\t\t});\r\n\t\t\t}}\r\n\t\t/>\r\n\t{/if}\r\n{/if}\r\n","<script lang=\"ts\">\r\n\texport let className = 'size-3.5';\r\n\texport let strokeWidth = '2';\r\n</script>\r\n\r\n<svg\r\n\txmlns=\"http://www.w3.org/2000/svg\"\r\n\tfill=\"none\"\r\n\tviewBox=\"0 0 24 24\"\r\n\tstroke-width={strokeWidth}\r\n\tstroke=\"currentColor\"\r\n\tclass={className}\r\n>\r\n\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18 18 6M6 6l12 12\" />\r\n</svg>\r\n","<script lang=\"ts\">\r\n\timport { toast } from 'svelte-sonner';\r\n\timport { onMount, tick, getContext, createEventDispatcher } from 'svelte';\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\timport {\r\n\t\ttype Model,\r\n\t\tmobile,\r\n\t\tsettings,\r\n\t\tshowSidebar,\r\n\t\tmodels,\r\n\t\tconfig,\r\n\t\tshowCallOverlay,\r\n\t\ttools,\r\n\t\tuser as _user\r\n\t} from '$lib/stores';\r\n\timport { blobToFile, findWordIndices } from '$lib/utils';\r\n\r\n\timport { transcribeAudio } from '$lib/apis/audio';\r\n\timport { processDocToVectorDB } from '$lib/apis/rag';\r\n\timport { uploadFile } from '$lib/apis/files';\r\n\r\n\timport {\r\n\t\tSUPPORTED_FILE_TYPE,\r\n\t\tSUPPORTED_FILE_EXTENSIONS,\r\n\t\tWEBUI_BASE_URL,\r\n\t\tWEBUI_API_BASE_URL\r\n\t} from '$lib/constants';\r\n\r\n\timport Tooltip from '../common/Tooltip.svelte';\r\n\timport InputMenu from './MessageInput/InputMenu.svelte';\r\n\timport Headphone from '../icons/Headphone.svelte';\r\n\timport VoiceRecording from './MessageInput/VoiceRecording.svelte';\r\n\timport FileItem from '../common/FileItem.svelte';\r\n\timport FilesOverlay from './MessageInput/FilesOverlay.svelte';\r\n\timport Commands from './MessageInput/Commands.svelte';\r\n\timport XMark from '../icons/XMark.svelte';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let transparentBackground = false;\r\n\r\n\texport let submitPrompt: Function;\r\n\texport let stopResponse: Function;\r\n\r\n\texport let autoScroll = false;\r\n\r\n\texport let atSelectedModel: Model | undefined;\r\n\texport let selectedModels: [''];\r\n\r\n\tlet recording = false;\r\n\r\n\tlet chatTextAreaElement: HTMLTextAreaElement;\r\n\tlet filesInputElement;\r\n\r\n\tlet commandsElement;\r\n\r\n\tlet inputFiles;\r\n\tlet dragged = false;\r\n\r\n\tlet user = null;\r\n\tlet chatInputPlaceholder = '';\r\n\r\n\texport let files = [];\r\n\r\n\texport let availableToolIds = [];\r\n\texport let selectedToolIds = [];\r\n\texport let webSearchEnabled = false;\r\n\r\n\texport let prompt = '';\r\n\texport let messages = [];\r\n\r\n\tlet visionCapableModels = [];\r\n\t$: visionCapableModels = [...(atSelectedModel ? [atSelectedModel] : selectedModels)].filter(\r\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.vision ?? true\r\n\t);\r\n\r\n\t$: if (prompt) {\r\n\t\tif (chatTextAreaElement) {\r\n\t\t\tchatTextAreaElement.style.height = '';\r\n\t\t\tchatTextAreaElement.style.height = Math.min(chatTextAreaElement.scrollHeight, 200) + 'px';\r\n\t\t}\r\n\t}\r\n\r\n\tconst scrollToBottom = () => {\r\n\t\tconst element = document.getElementById('messages-container');\r\n\t\telement.scrollTo({\r\n\t\t\ttop: element.scrollHeight,\r\n\t\t\tbehavior: 'smooth'\r\n\t\t});\r\n\t};\r\n\r\n\tconst uploadFileHandler = async (file) => {\r\n\t\tconsole.log(file);\r\n\r\n\t\t// Check if the file is an audio file and transcribe/convert it to text file\r\n\t\tif (['audio/mpeg', 'audio/wav'].includes(file['type'])) {\r\n\t\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\r\n\t\t\t\ttoast.error(error);\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tconsole.log(res);\r\n\t\t\t\tconst blob = new Blob([res.text], { type: 'text/plain' });\r\n\t\t\t\tfile = blobToFile(blob, `${file.name}.txt`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst fileItem = {\r\n\t\t\ttype: 'file',\r\n\t\t\tfile: '',\r\n\t\t\tid: null,\r\n\t\t\turl: '',\r\n\t\t\tname: file.name,\r\n\t\t\tcollection_name: '',\r\n\t\t\tstatus: '',\r\n\t\t\tsize: file.size,\r\n\t\t\terror: ''\r\n\t\t};\r\n\t\tfiles = [...files, fileItem];\r\n\r\n\t\ttry {\r\n\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file);\r\n\r\n\t\t\tif (uploadedFile) {\r\n\t\t\t\tfileItem.status = 'uploaded';\r\n\t\t\t\tfileItem.file = uploadedFile;\r\n\t\t\t\tfileItem.id = uploadedFile.id;\r\n\t\t\t\tfileItem.url = `${WEBUI_API_BASE_URL}/files/${uploadedFile.id}`;\r\n\r\n\t\t\t\t// TODO: Check if tools & functions have files support to skip this step to delegate file processing\r\n\t\t\t\t// Default Upload to VectorDB\r\n\t\t\t\tif (\r\n\t\t\t\t\tSUPPORTED_FILE_TYPE.includes(file['type']) ||\r\n\t\t\t\t\tSUPPORTED_FILE_EXTENSIONS.includes(file.name.split('.').at(-1))\r\n\t\t\t\t) {\r\n\t\t\t\t\tprocessFileItem(fileItem);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoast.error(\r\n\t\t\t\t\t\t$i18n.t(`Unknown file type '{{file_type}}'. Proceeding with the file upload anyway.`, {\r\n\t\t\t\t\t\t\tfile_type: file['type']\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t);\r\n\t\t\t\t\tprocessFileItem(fileItem);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfiles = files.filter((item) => item.status !== null);\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\ttoast.error(e);\r\n\t\t\tfiles = files.filter((item) => item.status !== null);\r\n\t\t}\r\n\t};\r\n\r\n\tconst processFileItem = async (fileItem) => {\r\n\t\ttry {\r\n\t\t\tconst res = await processDocToVectorDB(localStorage.token, fileItem.id);\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tfileItem.status = 'processed';\r\n\t\t\t\tfileItem.collection_name = res.collection_name;\r\n\t\t\t\tfiles = files;\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\t// Remove the failed doc from the files array\r\n\t\t\t// files = files.filter((f) => f.id !== fileItem.id);\r\n\t\t\ttoast.error(e);\r\n\t\t\tfileItem.status = 'processed';\r\n\t\t\tfiles = files;\r\n\t\t}\r\n\t};\r\n\r\n\tconst inputFilesHandler = async (inputFiles) => {\r\n\t\tinputFiles.forEach((file) => {\r\n\t\t\tconsole.log(file, file.name.split('.').at(-1));\r\n\r\n\t\t\tif (\r\n\t\t\t\t($config?.file?.max_size ?? null) !== null &&\r\n\t\t\t\tfile.size > ($config?.file?.max_size ?? 0) * 1024 * 1024\r\n\t\t\t) {\r\n\t\t\t\ttoast.error(\r\n\t\t\t\t\t$i18n.t(`File size should not exceed {{maxSize}} MB.`, {\r\n\t\t\t\t\t\tmaxSize: $config?.file?.max_size\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (['image/gif', 'image/webp', 'image/jpeg', 'image/png'].includes(file['type'])) {\r\n\t\t\t\tif (visionCapableModels.length === 0) {\r\n\t\t\t\t\ttoast.error($i18n.t('Selected model(s) do not support image inputs'));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet reader = new FileReader();\r\n\t\t\t\treader.onload = (event) => {\r\n\t\t\t\t\tfiles = [\r\n\t\t\t\t\t\t...files,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t\turl: `${event.target.result}`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t];\r\n\t\t\t\t};\r\n\t\t\t\treader.readAsDataURL(file);\r\n\t\t\t} else {\r\n\t\t\t\tuploadFileHandler(file);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tonMount(() => {\r\n\t\twindow.setTimeout(() => chatTextAreaElement?.focus(), 0);\r\n\r\n\t\tconst dropZone = document.querySelector('body');\r\n\r\n\t\tconst handleKeyDown = (event: KeyboardEvent) => {\r\n\t\t\tif (event.key === 'Escape') {\r\n\t\t\t\tconsole.log('Escape');\r\n\t\t\t\tdragged = false;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst onDragOver = (e) => {\r\n\t\t\te.preventDefault();\r\n\t\t\tdragged = true;\r\n\t\t};\r\n\r\n\t\tconst onDragLeave = () => {\r\n\t\t\tdragged = false;\r\n\t\t};\r\n\r\n\t\tconst onDrop = async (e) => {\r\n\t\t\te.preventDefault();\r\n\t\t\tconsole.log(e);\r\n\r\n\t\t\tif (e.dataTransfer?.files) {\r\n\t\t\t\tconst inputFiles = Array.from(e.dataTransfer?.files);\r\n\t\t\t\tif (inputFiles && inputFiles.length > 0) {\r\n\t\t\t\t\tconsole.log(inputFiles);\r\n\t\t\t\t\tinputFilesHandler(inputFiles);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tdragged = false;\r\n\t\t};\r\n\r\n\t\twindow.addEventListener('keydown', handleKeyDown);\r\n\r\n\t\tdropZone?.addEventListener('dragover', onDragOver);\r\n\t\tdropZone?.addEventListener('drop', onDrop);\r\n\t\tdropZone?.addEventListener('dragleave', onDragLeave);\r\n\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('keydown', handleKeyDown);\r\n\r\n\t\t\tdropZone?.removeEventListener('dragover', onDragOver);\r\n\t\t\tdropZone?.removeEventListener('drop', onDrop);\r\n\t\t\tdropZone?.removeEventListener('dragleave', onDragLeave);\r\n\t\t};\r\n\t});\r\n</script>\r\n\r\n<FilesOverlay show={dragged} />\r\n\r\n<div class=\"w-full font-primary\">\r\n\t<div class=\" -mb-0.5 mx-auto inset-x-0 bg-transparent flex justify-center\">\r\n\t\t<div class=\"flex flex-col max-w-6xl px-2.5 md:px-6 w-full\">\r\n\t\t\t<div class=\"relative\">\r\n\t\t\t\t{#if autoScroll === false && messages.length > 0}\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclass=\" absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\" bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tautoScroll = true;\r\n\t\t\t\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\td=\"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z\"\r\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"w-full relative\">\r\n\t\t\t\t{#if atSelectedModel !== undefined}\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclass=\"px-3 py-2.5 text-left w-full flex justify-between items-center absolute bottom-0.5 left-0 right-0 bg-gradient-to-t from-50% from-white dark:from-gray-900 z-10\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div class=\"flex items-center gap-2 text-sm dark:text-gray-500\">\r\n\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\tcrossorigin=\"anonymous\"\r\n\t\t\t\t\t\t\t\talt=\"model profile\"\r\n\t\t\t\t\t\t\t\tclass=\"size-5 max-w-[28px] object-cover rounded-full\"\r\n\t\t\t\t\t\t\t\tsrc={$models.find((model) => model.id === atSelectedModel.id)?.info?.meta\r\n\t\t\t\t\t\t\t\t\t?.profile_image_url ??\r\n\t\t\t\t\t\t\t\t\t($i18n.language === 'dg-DG'\r\n\t\t\t\t\t\t\t\t\t\t? `/doge.png`\r\n\t\t\t\t\t\t\t\t\t\t: `${WEBUI_BASE_URL}/static/favicon.png`)}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\tTalking to <span class=\" font-medium\">{atSelectedModel.name}</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tclass=\"flex items-center\"\r\n\t\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<XMark />\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t{/if}\r\n\r\n\t\t\t\t<Commands\r\n\t\t\t\t\tbind:this={commandsElement}\r\n\t\t\t\t\tbind:prompt\r\n\t\t\t\t\tbind:files\r\n\t\t\t\t\ton:select={(e) => {\r\n\t\t\t\t\t\tconst data = e.detail;\r\n\r\n\t\t\t\t\t\tif (data?.type === 'model') {\r\n\t\t\t\t\t\t\tatSelectedModel = data.data;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tchatTextAreaElement?.focus();\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div class=\"{transparentBackground ? 'bg-transparent' : 'bg-white dark:bg-gray-900'} \">\r\n\t\t<div class=\"max-w-6xl px-2.5 md:px-6 mx-auto inset-x-0\">\r\n\t\t\t<div class=\" pb-2\">\r\n\t\t\t\t<input\r\n\t\t\t\t\tbind:this={filesInputElement}\r\n\t\t\t\t\tbind:files={inputFiles}\r\n\t\t\t\t\ttype=\"file\"\r\n\t\t\t\t\thidden\r\n\t\t\t\t\tmultiple\r\n\t\t\t\t\ton:change={async () => {\r\n\t\t\t\t\t\tif (inputFiles && inputFiles.length > 0) {\r\n\t\t\t\t\t\t\tconst _inputFiles = Array.from(inputFiles);\r\n\t\t\t\t\t\t\tinputFilesHandler(_inputFiles);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfilesInputElement.value = '';\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\r\n\t\t\t\t{#if recording}\r\n\t\t\t\t\t<VoiceRecording\r\n\t\t\t\t\t\tbind:recording\r\n\t\t\t\t\t\ton:cancel={async () => {\r\n\t\t\t\t\t\t\trecording = false;\r\n\r\n\t\t\t\t\t\t\tawait tick();\r\n\t\t\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\ton:confirm={async (e) => {\r\n\t\t\t\t\t\t\tconst response = e.detail;\r\n\t\t\t\t\t\t\tprompt = `${prompt}${response} `;\r\n\r\n\t\t\t\t\t\t\trecording = false;\r\n\r\n\t\t\t\t\t\t\tawait tick();\r\n\t\t\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\r\n\r\n\t\t\t\t\t\t\tif ($settings?.speechAutoSend ?? false) {\r\n\t\t\t\t\t\t\t\tsubmitPrompt(prompt);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t{:else}\r\n\t\t\t\t\t<form\r\n\t\t\t\t\t\tclass=\"w-full flex gap-1.5\"\r\n\t\t\t\t\t\ton:submit|preventDefault={() => {\r\n\t\t\t\t\t\t\t// check if selectedModels support image input\r\n\t\t\t\t\t\t\tsubmitPrompt(prompt);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclass=\"flex-1 flex flex-col relative w-full rounded-3xl px-1.5 bg-gray-50 dark:bg-gray-850 dark:text-gray-100\"\r\n\t\t\t\t\t\t\tdir={$settings?.chatDirection ?? 'LTR'}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{#if files.length > 0}\r\n\t\t\t\t\t\t\t\t<div class=\"mx-1 mt-2.5 mb-1 flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t\t\t{#each files as file, fileIdx}\r\n\t\t\t\t\t\t\t\t\t\t{#if file.type === 'image'}\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" relative group\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"relative\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={file.url}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"input\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" h-16 w-16 rounded-xl object-cover\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if atSelectedModel ? visionCapableModels.length === 0 : selectedModels.length !== visionCapableModels.length}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\" absolute top-1 left-1\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('{{ models }}', {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodels: [...(atSelectedModel ? [atSelectedModel] : selectedModels)]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter((id) => !visionCapableModels.includes(id))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join(', ')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4 fill-yellow-300\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" absolute -top-1 -right-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-gray-400 text-white border border-white rounded-full group-hover:visible invisible transition\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t{:else}\r\n\t\t\t\t\t\t\t\t\t\t\t<FileItem\r\n\t\t\t\t\t\t\t\t\t\t\t\tname={file.name}\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype={file.type}\r\n\t\t\t\t\t\t\t\t\t\t\t\tsize={file?.size}\r\n\t\t\t\t\t\t\t\t\t\t\t\tstatus={file.status}\r\n\t\t\t\t\t\t\t\t\t\t\t\tdismissible={true}\r\n\t\t\t\t\t\t\t\t\t\t\t\ton:dismiss={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t\t\t\t{/each}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{/if}\r\n\r\n\t\t\t\t\t\t\t<div class=\" flex\">\r\n\t\t\t\t\t\t\t\t<div class=\" ml-0.5 self-end mb-1.5 flex space-x-1\">\r\n\t\t\t\t\t\t\t\t\t<InputMenu\r\n\t\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\r\n\t\t\t\t\t\t\t\t\t\tbind:selectedToolIds\r\n\t\t\t\t\t\t\t\t\t\ttools={$tools.reduce((a, e, i, arr) => {\r\n\t\t\t\t\t\t\t\t\t\t\tif (availableToolIds.includes(e.id) || ($_user?.role ?? 'user') === 'admin') {\r\n\t\t\t\t\t\t\t\t\t\t\t\ta[e.id] = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: e.name,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: e.meta.description,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tenabled: false\r\n\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\treturn a;\r\n\t\t\t\t\t\t\t\t\t\t}, {})}\r\n\t\t\t\t\t\t\t\t\t\tuploadFilesHandler={() => {\r\n\t\t\t\t\t\t\t\t\t\t\tfilesInputElement.click();\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\tonClose={async () => {\r\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\r\n\t\t\t\t\t\t\t\t\t\t\tchatTextAreaElement?.focus();\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-gray-50 hover:bg-gray-100 text-gray-800 dark:bg-gray-850 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-2 outline-none focus:outline-none\"\r\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\t\taria-label=\"More\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t</InputMenu>\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<textarea\r\n\t\t\t\t\t\t\t\t\tid=\"chat-textarea\"\r\n\t\t\t\t\t\t\t\t\tbind:this={chatTextAreaElement}\r\n\t\t\t\t\t\t\t\t\tclass=\"scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-1 rounded-xl resize-none h-[48px]\"\r\n\t\t\t\t\t\t\t\t\tplaceholder={chatInputPlaceholder !== ''\r\n\t\t\t\t\t\t\t\t\t\t? chatInputPlaceholder\r\n\t\t\t\t\t\t\t\t\t\t: $i18n.t('Send a Message')}\r\n\t\t\t\t\t\t\t\t\tbind:value={prompt}\r\n\t\t\t\t\t\t\t\t\ton:keypress={(e) => {\r\n\t\t\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\t\t\t!$mobile ||\r\n\t\t\t\t\t\t\t\t\t\t\t!(\r\n\t\t\t\t\t\t\t\t\t\t\t\t'ontouchstart' in window ||\r\n\t\t\t\t\t\t\t\t\t\t\t\tnavigator.maxTouchPoints > 0 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\tnavigator.msMaxTouchPoints > 0\r\n\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\t\t\t// Prevent Enter key from creating a new line\r\n\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Enter' && !e.shiftKey) {\r\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Submit the prompt when Enter key is pressed\r\n\t\t\t\t\t\t\t\t\t\t\tif (prompt !== '' && e.key === 'Enter' && !e.shiftKey) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tsubmitPrompt(prompt);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\ton:keydown={async (e) => {\r\n\t\t\t\t\t\t\t\t\t\tconst isCtrlPressed = e.ctrlKey || e.metaKey; // metaKey is for Cmd key on Mac\r\n\t\t\t\t\t\t\t\t\t\tconst commandsContainerElement = document.getElementById('commands-container');\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Check if Ctrl + R is pressed\r\n\t\t\t\t\t\t\t\t\t\tif (prompt === '' && isCtrlPressed && e.key.toLowerCase() === 'r') {\r\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('regenerate');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tconst regenerateButton = [\r\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('regenerate-response-button')\r\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tregenerateButton?.click();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (prompt === '' && e.key == 'ArrowUp') {\r\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tconst userMessageElement = [\r\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('user-message')\r\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tconst editButton = [\r\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('edit-user-message-button')\r\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(userMessageElement);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tuserMessageElement.scrollIntoView({ block: 'center' });\r\n\t\t\t\t\t\t\t\t\t\t\teditButton?.click();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (commandsContainerElement && e.key === 'ArrowUp') {\r\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\t\tcommandsElement.selectUp();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\r\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\r\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton.scrollIntoView({ block: 'center' });\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (commandsContainerElement && e.key === 'ArrowDown') {\r\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\t\tcommandsElement.selectDown();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\r\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\r\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton.scrollIntoView({ block: 'center' });\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (commandsContainerElement && e.key === 'Enter') {\r\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\r\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\r\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (e.shiftKey) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = `${prompt}\\n`;\r\n\t\t\t\t\t\t\t\t\t\t\t} else if (commandOptionButton) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton?.click();\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById('send-message-button')?.click();\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (commandsContainerElement && e.key === 'Tab') {\r\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\r\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\r\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton?.click();\r\n\t\t\t\t\t\t\t\t\t\t} else if (e.key === 'Tab') {\r\n\t\t\t\t\t\t\t\t\t\t\tconst words = findWordIndices(prompt);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (words.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst word = words.at(0);\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst fullPrompt = prompt;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = prompt.substring(0, word?.endIndex + 1);\r\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\te.target.scrollTop = e.target.scrollHeight;\r\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = fullPrompt;\r\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\t\t\te.target.setSelectionRange(word?.startIndex, word.endIndex + 1);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\r\n\t\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('Escape');\r\n\t\t\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\trows=\"1\"\r\n\t\t\t\t\t\t\t\t\ton:input={async (e) => {\r\n\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\r\n\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\r\n\t\t\t\t\t\t\t\t\t\tuser = null;\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\ton:focus={async (e) => {\r\n\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\r\n\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\ton:paste={async (e) => {\r\n\t\t\t\t\t\t\t\t\t\tconst clipboardData = e.clipboardData || window.clipboardData;\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (clipboardData && clipboardData.items) {\r\n\t\t\t\t\t\t\t\t\t\t\tfor (const item of clipboardData.items) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (item.type.indexOf('image') !== -1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst blob = item.getAsFile();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst reader = new FileReader();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treader.onload = function (e) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = [\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...files,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: `${e.target.result}`\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treader.readAsDataURL(blob);\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t\t\t\t<div class=\"self-end mb-2 flex space-x-1 mr-1\">\r\n\t\t\t\t\t\t\t\t\t{#if messages.length == 0 || messages.at(-1).done == true}\r\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Record voice')}>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"voice-input-button\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-1.5 mr-0.5 self-center\"\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getUserMedia({ audio: true })\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(function (err) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`Permission denied when accessing microphone: {{error}}`,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: err\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trecording = true;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstream = null;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing microphone'));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Voice Input\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5 translate-y-[0.5px]\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"flex items-end w-10\">\r\n\t\t\t\t\t\t\t{#if messages.length == 0 || messages.at(-1).done == true}\r\n\t\t\t\t\t\t\t\t{#if prompt === ''}\r\n\t\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1\">\r\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Call')}>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-2 self-center\"\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (selectedModels.length > 1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Select only one model to call'));\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ($config.audio.stt.engine === 'web') {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Call feature is not supported when using Web STT engine')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// check if user has access to getUserMedia\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user grants the permission, proceed to show the call overlay\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstream = null;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowCallOverlay.set(true);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdispatch('call');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user denies the permission or an error occurs, show an error message\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing media devices'));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Call\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Headphone className=\"size-6\" />\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t{:else}\r\n\t\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1\">\r\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Send message')}>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"send-message-button\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{prompt !== ''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 '\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled'} transition rounded-full p-1.5 m-0.5 self-center\"\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={prompt === ''}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-6\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t\t{:else}\r\n\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1.5\">\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tclass=\"bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5\"\r\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\t\t\t\tstopResponse();\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"size-6\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t{/if}\r\n\r\n\t\t\t\t<div class=\"mt-1.5 text-xs text-gray-500 text-center line-clamp-1\">\r\n\t\t\t\t\t{$i18n.t('LLMs can make mistakes. Verify important information.')}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n\r\n<style>\r\n\t.scrollbar-hidden:active::-webkit-scrollbar-thumb,\r\n\t.scrollbar-hidden:focus::-webkit-scrollbar-thumb,\r\n\t.scrollbar-hidden:hover::-webkit-scrollbar-thumb {\r\n\t\tvisibility: visible;\r\n\t}\r\n\t.scrollbar-hidden::-webkit-scrollbar-thumb {\r\n\t\tvisibility: hidden;\r\n\t}\r\n</style>\r\n","<script lang=\"ts\">\r\n\timport { models, showSettings, settings, user, mobile, config } from '$lib/stores';\r\n\timport { onMount, tick, getContext } from 'svelte';\r\n\timport { toast } from 'svelte-sonner';\r\n\timport Selector from './ModelSelector/Selector.svelte';\r\n\timport Tooltip from '../common/Tooltip.svelte';\r\n\r\n\timport { setDefaultModels } from '$lib/apis/configs';\r\n\timport { updateUserSettings } from '$lib/apis/users';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let selectedModels = [''];\r\n\texport let disabled = false;\r\n\r\n\texport let showSetDefault = true;\r\n\r\n\tconst saveDefaultModel = async () => {\r\n\t\tconst hasEmptyModel = selectedModels.filter((it) => it === '');\r\n\t\tif (hasEmptyModel.length) {\r\n\t\t\ttoast.error($i18n.t('Choose a model before saving...'));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsettings.set({ ...$settings, models: selectedModels });\r\n\t\tawait updateUserSettings(localStorage.token, { ui: $settings });\r\n\r\n\t\ttoast.success($i18n.t('Default model updated'));\r\n\t};\r\n\r\n\t$: if (selectedModels.length > 0 && $models.length > 0) {\r\n\t\tselectedModels = selectedModels.map((model) =>\r\n\t\t\t$models.map((m) => m.id).includes(model) ? model : ''\r\n\t\t);\r\n\t}\r\n</script>\r\n\r\n<div class=\"flex flex-col w-full items-start\">\r\n\t{#each selectedModels as selectedModel, selectedModelIdx}\r\n\t\t<div class=\"flex w-full max-w-fit\">\r\n\t\t\t<div class=\"overflow-hidden w-full\">\r\n\t\t\t\t<div class=\"mr-1 max-w-full\">\r\n\t\t\t\t\t<Selector\r\n\t\t\t\t\t\tplaceholder={$i18n.t('Select a model')}\r\n\t\t\t\t\t\titems={$models.map((model) => ({\r\n\t\t\t\t\t\t\tvalue: model.id,\r\n\t\t\t\t\t\t\tlabel: model.name,\r\n\t\t\t\t\t\t\tmodel: model\r\n\t\t\t\t\t\t}))}\r\n\t\t\t\t\t\tshowTemporaryChatControl={$user.role === 'user'\r\n\t\t\t\t\t\t\t? ($config?.permissions?.chat?.temporary ?? true)\r\n\t\t\t\t\t\t\t: true}\r\n\t\t\t\t\t\tbind:value={selectedModel}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t{#if selectedModelIdx === 0}\r\n\t\t\t\t<div\r\n\t\t\t\t\tclass=\"  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<Tooltip content={$i18n.t('Add Model')}>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\" \"\r\n\t\t\t\t\t\t\t{disabled}\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tselectedModels = [...selectedModels, ''];\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\taria-label=\"Add Model\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\r\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\t\tclass=\"size-3.5\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 6v12m6-6H6\" />\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</Tooltip>\r\n\t\t\t\t</div>\r\n\t\t\t{:else}\r\n\t\t\t\t<div\r\n\t\t\t\t\tclass=\"  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<Tooltip content={$i18n.t('Remove Model')}>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t{disabled}\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tselectedModels.splice(selectedModelIdx, 1);\r\n\t\t\t\t\t\t\t\tselectedModels = selectedModels;\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\taria-label=\"Remove Model\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\r\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\t\tclass=\"size-3\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 12h-15\" />\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</Tooltip>\r\n\t\t\t\t</div>\r\n\t\t\t{/if}\r\n\t\t</div>\r\n\t{/each}\r\n</div>\r\n\r\n{#if showSetDefault}\r\n\t<div class=\" absolute text-left mt-[1px] ml-1 text-[0.7rem] text-gray-500 font-primary\">\r\n\t\t<button on:click={saveDefaultModel}> {$i18n.t('Set as default')}</button>\r\n\t</div>\r\n{/if}\r\n","<script lang=\"ts\">\r\n\timport { DropdownMenu } from 'bits-ui';\r\n\timport { getContext } from 'svelte';\r\n\r\n\timport fileSaver from 'file-saver';\r\n\tconst { saveAs } = fileSaver;\r\n\r\n\timport { showSettings } from '$lib/stores';\r\n\timport { flyAndScale } from '$lib/utils/transitions';\r\n\r\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\r\n\timport Tags from '$lib/components/chat/Tags.svelte';\r\n\r\n\timport { downloadChatAsPDF } from '$lib/apis/utils';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let shareEnabled: boolean = false;\r\n\texport let shareHandler: Function;\r\n\texport let downloadHandler: Function;\r\n\r\n\t// export let tagHandler: Function;\r\n\r\n\texport let chat;\r\n\texport let onClose: Function = () => {};\r\n\r\n\tconst downloadTxt = async () => {\r\n\t\tconst _chat = chat.chat;\r\n\t\tconsole.log('download', chat);\r\n\r\n\t\tconst chatText = _chat.messages.reduce((a, message, i, arr) => {\r\n\t\t\treturn `${a}### ${message.role.toUpperCase()}\\n${message.content}\\n\\n`;\r\n\t\t}, '');\r\n\r\n\t\tlet blob = new Blob([chatText], {\r\n\t\t\ttype: 'text/plain'\r\n\t\t});\r\n\r\n\t\tsaveAs(blob, `chat-${_chat.title}.txt`);\r\n\t};\r\n\r\n\tconst downloadPdf = async () => {\r\n\t\tconst _chat = chat.chat;\r\n\t\tconsole.log('download', chat);\r\n\r\n\t\tconst blob = await downloadChatAsPDF(_chat);\r\n\r\n\t\t// Create a URL for the blob\r\n\t\tconst url = window.URL.createObjectURL(blob);\r\n\r\n\t\t// Create a link element to trigger the download\r\n\t\tconst a = document.createElement('a');\r\n\t\ta.href = url;\r\n\t\ta.download = `chat-${_chat.title}.pdf`;\r\n\r\n\t\t// Append the link to the body and click it programmatically\r\n\t\tdocument.body.appendChild(a);\r\n\t\ta.click();\r\n\r\n\t\t// Remove the link from the body\r\n\t\tdocument.body.removeChild(a);\r\n\r\n\t\t// Revoke the URL to release memory\r\n\t\twindow.URL.revokeObjectURL(url);\r\n\t};\r\n\r\n\tconst downloadJSONExport = async () => {\r\n\t\tlet blob = new Blob([JSON.stringify([chat])], {\r\n\t\t\ttype: 'application/json'\r\n\t\t});\r\n\t\tsaveAs(blob, `chat-export-${Date.now()}.json`);\r\n\t};\r\n</script>\r\n\r\n<Dropdown\r\n\ton:change={(e) => {\r\n\t\tif (e.detail === false) {\r\n\t\t\tonClose();\r\n\t\t}\r\n\t}}\r\n>\r\n\t<slot />\r\n\r\n\t<div slot=\"content\">\r\n\t\t<DropdownMenu.Content\r\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\r\n\t\t\tsideOffset={8}\r\n\t\t\tside=\"bottom\"\r\n\t\t\talign=\"end\"\r\n\t\t\ttransition={flyAndScale}\r\n\t\t>\r\n\t\t\t<!-- <DropdownMenu.Item\r\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\ton:click={async () => {\r\n\t\t\t\t\tawait showSettings.set(!$showSettings);\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<svg\r\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\tclass=\"size-4\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<path\r\n\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\td=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<path\r\n\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\td=\"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</svg>\r\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Settings')}</div>\r\n\t\t\t</DropdownMenu.Item> -->\r\n\r\n\t\t\t<DropdownMenu.Item\r\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\tid=\"chat-share-button\"\r\n\t\t\t\ton:click={() => {\r\n\t\t\t\t\tshareHandler();\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<svg\r\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\tclass=\"size-4\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<path\r\n\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\td=\"M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z\"\r\n\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</svg>\r\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Share')}</div>\r\n\t\t\t</DropdownMenu.Item>\r\n\t\t\t<!-- <DropdownMenu.Item\r\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer\"\r\n\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\tdownloadHandler();\r\n\t\t\t\t\t}}\r\n\t\t\t\t/> -->\r\n\t\t\t<DropdownMenu.Sub>\r\n\t\t\t\t<DropdownMenu.SubTrigger\r\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<svg\r\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\tclass=\"size-4\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\t\td=\"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</svg>\r\n\r\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Download')}</div>\r\n\t\t\t\t</DropdownMenu.SubTrigger>\r\n\t\t\t\t<DropdownMenu.SubContent\r\n\t\t\t\t\tclass=\"w-full rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\r\n\t\t\t\t\ttransition={flyAndScale}\r\n\t\t\t\t\tsideOffset={8}\r\n\t\t\t\t>\r\n\t\t\t\t\t<DropdownMenu.Item\r\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\tdownloadJSONExport();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Export chat (.json)')}</div>\r\n\t\t\t\t\t</DropdownMenu.Item>\r\n\t\t\t\t\t<DropdownMenu.Item\r\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\tdownloadTxt();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Plain text (.txt)')}</div>\r\n\t\t\t\t\t</DropdownMenu.Item>\r\n\r\n\t\t\t\t\t<DropdownMenu.Item\r\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\tdownloadPdf();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('PDF document (.pdf)')}</div>\r\n\t\t\t\t\t</DropdownMenu.Item>\r\n\t\t\t\t</DropdownMenu.SubContent>\r\n\t\t\t</DropdownMenu.Sub>\r\n\r\n\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 mt-2.5 mb-1.5\" />\r\n\r\n\t\t\t<div class=\"flex p-1\">\r\n\t\t\t\t<Tags chatId={chat.id} />\r\n\t\t\t</div>\r\n\t\t</DropdownMenu.Content>\r\n\t</div>\r\n</Dropdown>\r\n","<script lang=\"ts\">\r\n\texport let className = 'w-4 h-4';\r\n\texport let strokeWidth = '1.5';\r\n</script>\r\n\r\n<svg\r\n\txmlns=\"http://www.w3.org/2000/svg\"\r\n\tviewBox=\"0 0 24 24\"\r\n\tstroke=\"currentColor\"\r\n\tfill=\"currentColor\"\r\n\tclass={className}\r\n\tstroke-width={strokeWidth}\r\n>\r\n\t<path\r\n\t\td=\"M18.75 12.75h1.5a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM12 6a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 6ZM12 18a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 18ZM3.75 6.75h1.5a.75.75 0 1 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM5.25 18.75h-1.5a.75.75 0 0 1 0-1.5h1.5a.75.75 0 0 1 0 1.5ZM3 12a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 3 12ZM9 3.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5ZM12.75 12a2.25 2.25 0 1 1 4.5 0 2.25 2.25 0 0 1-4.5 0ZM9 15.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z\"\r\n\t/>\r\n</svg>\r\n","<script lang=\"ts\">\r\n\timport { getContext } from 'svelte';\r\n\timport { toast } from 'svelte-sonner';\r\n\r\n\timport {\r\n\t\tWEBUI_NAME,\r\n\t\tchatId,\r\n\t\tmobile,\r\n\t\tsettings,\r\n\t\tshowArchivedChats,\r\n\t\tshowSettings,\r\n\t\tshowSidebar,\r\n\t\tuser\r\n\t} from '$lib/stores';\r\n\r\n\timport { slide } from 'svelte/transition';\r\n\timport ShareChatModal from '../chat/ShareChatModal.svelte';\r\n\timport ModelSelector from '../chat/ModelSelector.svelte';\r\n\timport Tooltip from '../common/Tooltip.svelte';\r\n\timport Menu from './Navbar/Menu.svelte';\r\n\timport { page } from '$app/stores';\r\n\timport UserMenu from './Sidebar/UserMenu.svelte';\r\n\timport MenuLines from '../icons/MenuLines.svelte';\r\n\timport AdjustmentsHorizontal from '../icons/AdjustmentsHorizontal.svelte';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let initNewChat: Function;\r\n\texport let title: string = $WEBUI_NAME;\r\n\texport let shareEnabled: boolean = false;\r\n\r\n\texport let chat;\r\n\texport let selectedModels;\r\n\r\n\texport let showModelSelector = true;\r\n\texport let showControls = false;\r\n\r\n\tlet showShareChatModal = false;\r\n\tlet showDownloadChatModal = false;\r\n</script>\r\n\r\n<ShareChatModal bind:show={showShareChatModal} chatId={$chatId} />\r\n<nav id=\"nav\" class=\" sticky py-2.5 top-0 flex flex-row justify-center z-10\">\r\n\t<div class=\" flex max-w-full w-full mx-auto px-5 pt-0.5 md:px-[1rem]\">\r\n\t\t<div class=\"flex items-center w-full max-w-full\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\"{$showSidebar\r\n\t\t\t\t\t? 'md:hidden'\r\n\t\t\t\t\t: ''} mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400\"\r\n\t\t\t>\r\n\t\t\t\t<button\r\n\t\t\t\t\tid=\"sidebar-toggle-button\"\r\n\t\t\t\t\tclass=\"cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\r\n\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\tshowSidebar.set(!$showSidebar);\r\n\t\t\t\t\t}}\r\n\t\t\t\t\taria-label=\"Toggle Sidebar\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div class=\" m-auto self-center\">\r\n\t\t\t\t\t\t<MenuLines />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"flex-1 overflow-hidden max-w-full\">\r\n\t\t\t\t{#if showModelSelector}\r\n\t\t\t\t\t<ModelSelector bind:selectedModels showSetDefault={!shareEnabled} />\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"self-start flex flex-none items-center text-gray-600 dark:text-gray-400\">\r\n\t\t\t\t<!-- <div class=\"md:hidden flex self-center w-[1px] h-5 mx-2 bg-gray-300 dark:bg-stone-700\" /> -->\r\n\r\n\t\t\t\t{#if shareEnabled && chat && chat.id}\r\n\t\t\t\t\t<Menu\r\n\t\t\t\t\t\t{chat}\r\n\t\t\t\t\t\t{shareEnabled}\r\n\t\t\t\t\t\tshareHandler={() => {\r\n\t\t\t\t\t\t\tshowShareChatModal = !showShareChatModal;\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tdownloadHandler={() => {\r\n\t\t\t\t\t\t\tshowDownloadChatModal = !showDownloadChatModal;\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\"hidden md:flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\r\n\t\t\t\t\t\t\tid=\"chat-context-menu-button\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\r\n\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\tclass=\"size-5\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\t\t\t\t\td=\"M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z\"\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</Menu>\r\n\t\t\t\t{/if}\r\n\r\n\t\t\t\t<Tooltip content={$i18n.t('Controls')}>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tclass=\" flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\r\n\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\tshowControls = !showControls;\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\taria-label=\"Controls\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div class=\" m-auto self-center\">\r\n\t\t\t\t\t\t\t<AdjustmentsHorizontal className=\" size-5\" strokeWidth=\"0.5\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</Tooltip>\r\n\r\n\t\t\t\t<Tooltip content={$i18n.t('New Chat')}>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tid=\"new-chat-button\"\r\n\t\t\t\t\t\tclass=\" flex {$showSidebar\r\n\t\t\t\t\t\t\t? 'md:hidden'\r\n\t\t\t\t\t\t\t: ''} cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\r\n\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\tinitNewChat();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\taria-label=\"New Chat\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div class=\" m-auto self-center\">\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\td=\"M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\td=\"M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</Tooltip>\r\n\r\n\t\t\t\t{#if $user !== undefined}\r\n\t\t\t\t\t<UserMenu\r\n\t\t\t\t\t\tclassName=\"max-w-[200px]\"\r\n\t\t\t\t\t\trole={$user.role}\r\n\t\t\t\t\t\ton:show={(e) => {\r\n\t\t\t\t\t\t\tif (e.detail === 'archived-chat') {\r\n\t\t\t\t\t\t\t\tshowArchivedChats.set(true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\"select-none flex rounded-xl p-1.5 w-full hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\r\n\t\t\t\t\t\t\taria-label=\"User Menu\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\" self-center\">\r\n\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\tsrc={$user.profile_image_url}\r\n\t\t\t\t\t\t\t\t\tclass=\"size-6 object-cover rounded-full\"\r\n\t\t\t\t\t\t\t\t\talt=\"User profile\"\r\n\t\t\t\t\t\t\t\t\tdraggable=\"false\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</UserMenu>\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</nav>\r\n","<script lang=\"ts\">\r\n\timport { toast } from 'svelte-sonner';\r\n\r\n\timport { config, functions, models, settings, tools, user } from '$lib/stores';\r\n\timport { createEventDispatcher, onMount, getContext, tick } from 'svelte';\r\n\r\n\timport {\r\n\t\tgetUserValvesSpecById as getToolUserValvesSpecById,\r\n\t\tgetUserValvesById as getToolUserValvesById,\r\n\t\tupdateUserValvesById as updateToolUserValvesById\r\n\t} from '$lib/apis/tools';\r\n\timport {\r\n\t\tgetUserValvesSpecById as getFunctionUserValvesSpecById,\r\n\t\tgetUserValvesById as getFunctionUserValvesById,\r\n\t\tupdateUserValvesById as updateFunctionUserValvesById\r\n\t} from '$lib/apis/functions';\r\n\r\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\r\n\timport Spinner from '$lib/components/common/Spinner.svelte';\r\n\timport Valves from '$lib/components/common/Valves.svelte';\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\tlet tab = 'tools';\r\n\tlet selectedId = '';\r\n\r\n\tlet loading = false;\r\n\r\n\tlet valvesSpec = null;\r\n\tlet valves = {};\r\n\r\n\tlet debounceTimer;\r\n\r\n\tconst debounceSubmitHandler = async () => {\r\n\t\tif (debounceTimer) {\r\n\t\t\tclearTimeout(debounceTimer);\r\n\t\t}\r\n\r\n\t\t// Set a new timer\r\n\t\tdebounceTimer = setTimeout(() => {\r\n\t\t\tsubmitHandler();\r\n\t\t}, 500); // 0.5 second debounce\r\n\t};\r\n\r\n\tconst getUserValves = async () => {\r\n\t\tloading = true;\r\n\t\tif (tab === 'tools') {\r\n\t\t\tvalves = await getToolUserValvesById(localStorage.token, selectedId);\r\n\t\t\tvalvesSpec = await getToolUserValvesSpecById(localStorage.token, selectedId);\r\n\t\t} else if (tab === 'functions') {\r\n\t\t\tvalves = await getFunctionUserValvesById(localStorage.token, selectedId);\r\n\t\t\tvalvesSpec = await getFunctionUserValvesSpecById(localStorage.token, selectedId);\r\n\t\t}\r\n\r\n\t\tif (valvesSpec) {\r\n\t\t\t// Convert array to string\r\n\t\t\tfor (const property in valvesSpec.properties) {\r\n\t\t\t\tif (valvesSpec.properties[property]?.type === 'array') {\r\n\t\t\t\t\tvalves[property] = (valves[property] ?? []).join(',');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tloading = false;\r\n\t};\r\n\r\n\tconst submitHandler = async () => {\r\n\t\tif (valvesSpec) {\r\n\t\t\t// Convert string to array\r\n\t\t\tfor (const property in valvesSpec.properties) {\r\n\t\t\t\tif (valvesSpec.properties[property]?.type === 'array') {\r\n\t\t\t\t\tvalves[property] = (valves[property] ?? '').split(',').map((v) => v.trim());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (tab === 'tools') {\r\n\t\t\t\tconst res = await updateToolUserValvesById(localStorage.token, selectedId, valves).catch(\r\n\t\t\t\t\t(error) => {\r\n\t\t\t\t\t\ttoast.error(error);\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (res) {\r\n\t\t\t\t\ttoast.success($i18n.t('Valves updated'));\r\n\t\t\t\t\tvalves = res;\r\n\t\t\t\t}\r\n\t\t\t} else if (tab === 'functions') {\r\n\t\t\t\tconst res = await updateFunctionUserValvesById(\r\n\t\t\t\t\tlocalStorage.token,\r\n\t\t\t\t\tselectedId,\r\n\t\t\t\t\tvalves\r\n\t\t\t\t).catch((error) => {\r\n\t\t\t\t\ttoast.error(error);\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (res) {\r\n\t\t\t\t\ttoast.success($i18n.t('Valves updated'));\r\n\t\t\t\t\tvalves = res;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t$: if (tab) {\r\n\t\tselectedId = '';\r\n\t}\r\n\r\n\t$: if (selectedId) {\r\n\t\tgetUserValves();\r\n\t}\r\n</script>\r\n\r\n<form\r\n\tclass=\"flex flex-col h-full justify-between space-y-3 text-sm\"\r\n\ton:submit|preventDefault={() => {\r\n\t\tsubmitHandler();\r\n\t\tdispatch('save');\r\n\t}}\r\n>\r\n\t<div class=\"flex flex-col\">\r\n\t\t<div class=\"space-y-1\">\r\n\t\t\t<div class=\"flex gap-2\">\r\n\t\t\t\t<div class=\"flex-1\">\r\n\t\t\t\t\t<select\r\n\t\t\t\t\t\tclass=\"  w-full rounded text-xs py-2 px-1 bg-transparent outline-none\"\r\n\t\t\t\t\t\tbind:value={tab}\r\n\t\t\t\t\t\tplaceholder=\"Select\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<option value=\"tools\" class=\"bg-gray-100 dark:bg-gray-800\">{$i18n.t('Tools')}</option>\r\n\t\t\t\t\t\t<option value=\"functions\" class=\"bg-gray-100 dark:bg-gray-800\"\r\n\t\t\t\t\t\t\t>{$i18n.t('Functions')}</option\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"flex-1\">\r\n\t\t\t\t\t<select\r\n\t\t\t\t\t\tclass=\"w-full rounded py-2 px-1 text-xs bg-transparent outline-none\"\r\n\t\t\t\t\t\tbind:value={selectedId}\r\n\t\t\t\t\t\ton:change={async () => {\r\n\t\t\t\t\t\t\tawait tick();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{#if tab === 'tools'}\r\n\t\t\t\t\t\t\t<option value=\"\" selected disabled class=\"bg-gray-100 dark:bg-gray-800\"\r\n\t\t\t\t\t\t\t\t>{$i18n.t('Select a tool')}</option\r\n\t\t\t\t\t\t\t>\r\n\r\n\t\t\t\t\t\t\t{#each $tools as tool, toolIdx}\r\n\t\t\t\t\t\t\t\t<option value={tool.id} class=\"bg-gray-100 dark:bg-gray-800\">{tool.name}</option>\r\n\t\t\t\t\t\t\t{/each}\r\n\t\t\t\t\t\t{:else if tab === 'functions'}\r\n\t\t\t\t\t\t\t<option value=\"\" selected disabled class=\"bg-gray-100 dark:bg-gray-800\"\r\n\t\t\t\t\t\t\t\t>{$i18n.t('Select a function')}</option\r\n\t\t\t\t\t\t\t>\r\n\r\n\t\t\t\t\t\t\t{#each $functions as func, funcIdx}\r\n\t\t\t\t\t\t\t\t<option value={func.id} class=\"bg-gray-100 dark:bg-gray-800\">{func.name}</option>\r\n\t\t\t\t\t\t\t{/each}\r\n\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t{#if selectedId}\r\n\t\t\t<hr class=\"dark:border-gray-800 my-1 w-full\" />\r\n\r\n\t\t\t<div class=\"my-2 text-xs\">\r\n\t\t\t\t{#if !loading}\r\n\t\t\t\t\t<Valves\r\n\t\t\t\t\t\t{valvesSpec}\r\n\t\t\t\t\t\tbind:valves\r\n\t\t\t\t\t\ton:change={() => {\r\n\t\t\t\t\t\t\tdebounceSubmitHandler();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t{:else}\r\n\t\t\t\t\t<Spinner className=\"size-5\" />\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\t\t{/if}\r\n\t</div>\r\n</form>\r\n","<script lang=\"ts\">\r\n\timport { createEventDispatcher, getContext } from 'svelte';\r\n\tconst dispatch = createEventDispatcher();\r\n\tconst i18n = getContext('i18n');\r\n\r\n\timport XMark from '$lib/components/icons/XMark.svelte';\r\n\timport AdvancedParams from '../Settings/Advanced/AdvancedParams.svelte';\r\n\timport Valves from '$lib/components/chat/Controls/Valves.svelte';\r\n\timport FileItem from '$lib/components/common/FileItem.svelte';\r\n\timport Collapsible from '$lib/components/common/Collapsible.svelte';\r\n\r\n\timport { user } from '$lib/stores';\r\n\texport let models = [];\r\n\texport let chatFiles = [];\r\n\texport let params = {};\r\n</script>\r\n\r\n<div class=\" dark:text-white\">\r\n\t<div class=\" flex justify-between dark:text-gray-100 mb-2\">\r\n\t\t<div class=\" text-lg font-medium self-center font-primary\">{$i18n.t('Chat Controls')}</div>\r\n\t\t<button\r\n\t\t\tclass=\"self-center\"\r\n\t\t\ton:click={() => {\r\n\t\t\t\tdispatch('close');\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<XMark className=\"size-4\" />\r\n\t\t</button>\r\n\t</div>\r\n\r\n\t<div class=\" dark:text-gray-200 text-sm font-primary py-0.5\">\r\n\t\t{#if chatFiles.length > 0}\r\n\t\t\t<Collapsible title={$i18n.t('Files')} open={true}>\r\n\t\t\t\t<div class=\"flex flex-col gap-1 mt-1.5\" slot=\"content\">\r\n\t\t\t\t\t{#each chatFiles as file, fileIdx}\r\n\t\t\t\t\t\t<FileItem\r\n\t\t\t\t\t\t\tclassName=\"w-full\"\r\n\t\t\t\t\t\t\turl={`${file?.url}`}\r\n\t\t\t\t\t\t\tname={file.name}\r\n\t\t\t\t\t\t\ttype={file.type}\r\n\t\t\t\t\t\t\tsize={file?.size}\r\n\t\t\t\t\t\t\tdismissible={true}\r\n\t\t\t\t\t\t\ton:dismiss={() => {\r\n\t\t\t\t\t\t\t\t// Remove the file from the chatFiles array\r\n\r\n\t\t\t\t\t\t\t\tchatFiles.splice(fileIdx, 1);\r\n\t\t\t\t\t\t\t\tchatFiles = chatFiles;\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t{/each}\r\n\t\t\t\t</div>\r\n\t\t\t</Collapsible>\r\n\r\n\t\t\t<hr class=\"my-2 border-gray-100 dark:border-gray-800\" />\r\n\t\t{/if}\r\n\r\n\t\t<Collapsible title={$i18n.t('Valves')}>\r\n\t\t\t<div class=\"text-sm mt-1.5\" slot=\"content\">\r\n\t\t\t\t<Valves />\r\n\t\t\t</div>\r\n\t\t</Collapsible>\r\n\r\n\t\t<hr class=\"my-2 border-gray-100 dark:border-gray-800\" />\r\n\r\n\t\t<Collapsible title={$i18n.t('System Prompt')} open={true}>\r\n\t\t\t<div class=\" mt-1.5\" slot=\"content\">\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tbind:value={params.system}\r\n\t\t\t\t\tclass=\"w-full rounded-lg px-3.5 py-2.5 text-sm dark:text-gray-300 dark:bg-gray-850 border border-gray-100 dark:border-gray-800 outline-none resize-none\"\r\n\t\t\t\t\trows=\"4\"\r\n\t\t\t\t\tplaceholder={$i18n.t('Enter system prompt')}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</Collapsible>\r\n\r\n\t\t<hr class=\"my-2 border-gray-100 dark:border-gray-800\" />\r\n\r\n\t\t<Collapsible title={$i18n.t('Advanced Params')} open={true}>\r\n\t\t\t<div class=\"text-sm mt-1.5\" slot=\"content\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<AdvancedParams admin={$user?.role === 'admin'} bind:params />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</Collapsible>\r\n\t</div>\r\n</div>\r\n","<script lang=\"ts\">\r\n\timport { DropdownMenu } from 'bits-ui';\r\n\timport { flyAndScale } from '$lib/utils/transitions';\r\n\timport { getContext, createEventDispatcher } from 'svelte';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\r\n\r\n\texport let onClose: Function = () => {};\r\n\texport let devices: any;\r\n\r\n\tlet show = false;\r\n</script>\r\n\r\n<Dropdown\r\n\tbind:show\r\n\ton:change={(e) => {\r\n\t\tif (e.detail === false) {\r\n\t\t\tonClose();\r\n\t\t}\r\n\t}}\r\n>\r\n\t<slot />\r\n\r\n\t<div slot=\"content\">\r\n\t\t<DropdownMenu.Content\r\n\t\t\tclass=\"w-full max-w-[180px] rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-[9999] bg-white dark:bg-gray-900 dark:text-white shadow-sm\"\r\n\t\t\tsideOffset={6}\r\n\t\t\tside=\"top\"\r\n\t\t\talign=\"start\"\r\n\t\t\ttransition={flyAndScale}\r\n\t\t>\r\n\t\t\t{#each devices as device}\r\n\t\t\t\t<DropdownMenu.Item\r\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\tdispatch('change', device.deviceId);\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div class=\"flex items-center\">\r\n\t\t\t\t\t\t<div class=\" line-clamp-1\">\r\n\t\t\t\t\t\t\t{device?.label ?? 'Camera'}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</DropdownMenu.Item>\r\n\t\t\t{/each}\r\n\t\t</DropdownMenu.Content>\r\n\t</div>\r\n</Dropdown>\r\n","<script lang=\"ts\">\r\n\timport { config, models, settings, showCallOverlay } from '$lib/stores';\r\n\timport { onMount, tick, getContext, onDestroy, createEventDispatcher } from 'svelte';\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\timport {\r\n\t\tblobToFile,\r\n\t\tcalculateSHA256,\r\n\t\textractSentencesForAudio,\r\n\t\tfindWordIndices\r\n\t} from '$lib/utils';\r\n\timport { generateEmoji } from '$lib/apis';\r\n\timport { synthesizeOpenAISpeech, transcribeAudio } from '$lib/apis/audio';\r\n\r\n\timport { toast } from 'svelte-sonner';\r\n\r\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\r\n\timport VideoInputMenu from './CallOverlay/VideoInputMenu.svelte';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let eventTarget: EventTarget;\r\n\texport let submitPrompt: Function;\r\n\texport let stopResponse: Function;\r\n\texport let files;\r\n\texport let chatId;\r\n\texport let modelId;\r\n\r\n\tlet wakeLock = null;\r\n\r\n\tlet model = null;\r\n\r\n\tlet loading = false;\r\n\tlet confirmed = false;\r\n\tlet interrupted = false;\r\n\tlet assistantSpeaking = false;\r\n\r\n\tlet emoji = null;\r\n\r\n\tlet camera = false;\r\n\tlet cameraStream = null;\r\n\r\n\tlet chatStreaming = false;\r\n\r\n\tlet rmsLevel = 0;\r\n\tlet hasStartedSpeaking = false;\r\n\tlet mediaRecorder;\r\n\tlet audioStream = null;\r\n\tlet audioChunks = [];\r\n\r\n\tlet videoInputDevices = [];\r\n\tlet selectedVideoInputDeviceId = null;\r\n\r\n\tconst getVideoInputDevices = async () => {\r\n\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\r\n\t\tvideoInputDevices = devices.filter((device) => device.kind === 'videoinput');\r\n\r\n\t\tif (!!navigator.mediaDevices.getDisplayMedia) {\r\n\t\t\tvideoInputDevices = [\r\n\t\t\t\t...videoInputDevices,\r\n\t\t\t\t{\r\n\t\t\t\t\tdeviceId: 'screen',\r\n\t\t\t\t\tlabel: 'Screen Share'\r\n\t\t\t\t}\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\tconsole.log(videoInputDevices);\r\n\t\tif (selectedVideoInputDeviceId === null && videoInputDevices.length > 0) {\r\n\t\t\tselectedVideoInputDeviceId = videoInputDevices[0].deviceId;\r\n\t\t}\r\n\t};\r\n\r\n\tconst startCamera = async () => {\r\n\t\tawait getVideoInputDevices();\r\n\r\n\t\tif (cameraStream === null) {\r\n\t\t\tcamera = true;\r\n\t\t\tawait tick();\r\n\t\t\ttry {\r\n\t\t\t\tawait startVideoStream();\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error('Error accessing webcam: ', err);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst startVideoStream = async () => {\r\n\t\tconst video = document.getElementById('camera-feed');\r\n\t\tif (video) {\r\n\t\t\tif (selectedVideoInputDeviceId === 'screen') {\r\n\t\t\t\tcameraStream = await navigator.mediaDevices.getDisplayMedia({\r\n\t\t\t\t\tvideo: {\r\n\t\t\t\t\t\tcursor: 'always'\r\n\t\t\t\t\t},\r\n\t\t\t\t\taudio: false\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tcameraStream = await navigator.mediaDevices.getUserMedia({\r\n\t\t\t\t\tvideo: {\r\n\t\t\t\t\t\tdeviceId: selectedVideoInputDeviceId ? { exact: selectedVideoInputDeviceId } : undefined\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (cameraStream) {\r\n\t\t\t\tawait getVideoInputDevices();\r\n\t\t\t\tvideo.srcObject = cameraStream;\r\n\t\t\t\tawait video.play();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst stopVideoStream = async () => {\r\n\t\tif (cameraStream) {\r\n\t\t\tconst tracks = cameraStream.getTracks();\r\n\t\t\ttracks.forEach((track) => track.stop());\r\n\t\t}\r\n\r\n\t\tcameraStream = null;\r\n\t};\r\n\r\n\tconst takeScreenshot = () => {\r\n\t\tconst video = document.getElementById('camera-feed');\r\n\t\tconst canvas = document.getElementById('camera-canvas');\r\n\r\n\t\tif (!canvas) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst context = canvas.getContext('2d');\r\n\r\n\t\t// Make the canvas match the video dimensions\r\n\t\tcanvas.width = video.videoWidth;\r\n\t\tcanvas.height = video.videoHeight;\r\n\r\n\t\t// Draw the image from the video onto the canvas\r\n\t\tcontext.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);\r\n\r\n\t\t// Convert the canvas to a data base64 URL and console log it\r\n\t\tconst dataURL = canvas.toDataURL('image/png');\r\n\t\tconsole.log(dataURL);\r\n\r\n\t\treturn dataURL;\r\n\t};\r\n\r\n\tconst stopCamera = async () => {\r\n\t\tawait stopVideoStream();\r\n\t\tcamera = false;\r\n\t};\r\n\r\n\tconst MIN_DECIBELS = -55;\r\n\tconst VISUALIZER_BUFFER_LENGTH = 300;\r\n\r\n\tconst transcribeHandler = async (audioBlob) => {\r\n\t\t// Create a blob from the audio chunks\r\n\r\n\t\tawait tick();\r\n\t\tconst file = blobToFile(audioBlob, 'recording.wav');\r\n\r\n\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\r\n\t\t\ttoast.error(error);\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (res) {\r\n\t\t\tconsole.log(res.text);\r\n\r\n\t\t\tif (res.text !== '') {\r\n\t\t\t\tconst _responses = await submitPrompt(res.text, { _raw: true });\r\n\t\t\t\tconsole.log(_responses);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst stopRecordingCallback = async (_continue = true) => {\r\n\t\tif ($showCallOverlay) {\r\n\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' stopRecordingCallback ');\r\n\r\n\t\t\t// deep copy the audioChunks array\r\n\t\t\tconst _audioChunks = audioChunks.slice(0);\r\n\r\n\t\t\taudioChunks = [];\r\n\t\t\tmediaRecorder = false;\r\n\r\n\t\t\tif (_continue) {\r\n\t\t\t\tstartRecording();\r\n\t\t\t}\r\n\r\n\t\t\tif (confirmed) {\r\n\t\t\t\tloading = true;\r\n\t\t\t\temoji = null;\r\n\r\n\t\t\t\tif (cameraStream) {\r\n\t\t\t\t\tconst imageUrl = takeScreenshot();\r\n\r\n\t\t\t\t\tfiles = [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t\turl: imageUrl\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst audioBlob = new Blob(_audioChunks, { type: 'audio/wav' });\r\n\t\t\t\tawait transcribeHandler(audioBlob);\r\n\r\n\t\t\t\tconfirmed = false;\r\n\t\t\t\tloading = false;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\taudioChunks = [];\r\n\t\t\tmediaRecorder = false;\r\n\r\n\t\t\tif (audioStream) {\r\n\t\t\t\tconst tracks = audioStream.getTracks();\r\n\t\t\t\ttracks.forEach((track) => track.stop());\r\n\t\t\t}\r\n\t\t\taudioStream = null;\r\n\t\t}\r\n\t};\r\n\r\n\tconst startRecording = async () => {\r\n\t\taudioStream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n\t\tmediaRecorder = new MediaRecorder(audioStream);\r\n\r\n\t\tmediaRecorder.onstart = () => {\r\n\t\t\tconsole.log('Recording started');\r\n\t\t\taudioChunks = [];\r\n\t\t\tanalyseAudio(audioStream);\r\n\t\t};\r\n\r\n\t\tmediaRecorder.ondataavailable = (event) => {\r\n\t\t\tif (hasStartedSpeaking) {\r\n\t\t\t\taudioChunks.push(event.data);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tmediaRecorder.onstop = (e) => {\r\n\t\t\tconsole.log('Recording stopped', e);\r\n\t\t\tstopRecordingCallback();\r\n\t\t};\r\n\r\n\t\tmediaRecorder.start();\r\n\t};\r\n\r\n\tconst stopAudioStream = async () => {\r\n\t\tif (audioStream) {\r\n\t\t\tconst tracks = audioStream.getTracks();\r\n\t\t\ttracks.forEach((track) => track.stop());\r\n\t\t}\r\n\r\n\t\taudioStream = null;\r\n\t};\r\n\r\n\t// Function to calculate the RMS level from time domain data\r\n\tconst calculateRMS = (data: Uint8Array) => {\r\n\t\tlet sumSquares = 0;\r\n\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\r\n\t\t\tsumSquares += normalizedValue * normalizedValue;\r\n\t\t}\r\n\t\treturn Math.sqrt(sumSquares / data.length);\r\n\t};\r\n\r\n\tconst analyseAudio = (stream) => {\r\n\t\tconst audioContext = new AudioContext();\r\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\r\n\r\n\t\tconst analyser = audioContext.createAnalyser();\r\n\t\tanalyser.minDecibels = MIN_DECIBELS;\r\n\t\taudioStreamSource.connect(analyser);\r\n\r\n\t\tconst bufferLength = analyser.frequencyBinCount;\r\n\r\n\t\tconst domainData = new Uint8Array(bufferLength);\r\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\r\n\r\n\t\tlet lastSoundTime = Date.now();\r\n\t\thasStartedSpeaking = false;\r\n\r\n\t\tconsole.log(' Sound detection started', lastSoundTime, hasStartedSpeaking);\r\n\r\n\t\tconst detectSound = () => {\r\n\t\t\tconst processFrame = () => {\r\n\t\t\t\tif (!mediaRecorder || !$showCallOverlay) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (assistantSpeaking && !($settings?.voiceInterruption ?? false)) {\r\n\t\t\t\t\t// Mute the audio if the assistant is speaking\r\n\t\t\t\t\tanalyser.maxDecibels = 0;\r\n\t\t\t\t\tanalyser.minDecibels = -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tanalyser.minDecibels = MIN_DECIBELS;\r\n\t\t\t\t\tanalyser.maxDecibels = -30;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\r\n\t\t\t\tanalyser.getByteFrequencyData(domainData);\r\n\r\n\t\t\t\t// Calculate RMS level from time domain data\r\n\t\t\t\trmsLevel = calculateRMS(timeDomainData);\r\n\r\n\t\t\t\t// Check if initial speech/noise has started\r\n\t\t\t\tconst hasSound = domainData.some((value) => value > 0);\r\n\t\t\t\tif (hasSound) {\r\n\t\t\t\t\t// BIG RED TEXT\r\n\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Sound detected');\r\n\r\n\t\t\t\t\tif (!hasStartedSpeaking) {\r\n\t\t\t\t\t\thasStartedSpeaking = true;\r\n\t\t\t\t\t\tstopAllAudio();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlastSoundTime = Date.now();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Start silence detection only after initial speech/noise has been detected\r\n\t\t\t\tif (hasStartedSpeaking) {\r\n\t\t\t\t\tif (Date.now() - lastSoundTime > 2000) {\r\n\t\t\t\t\t\tconfirmed = true;\r\n\r\n\t\t\t\t\t\tif (mediaRecorder) {\r\n\t\t\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Silence detected');\r\n\t\t\t\t\t\t\tmediaRecorder.stop();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\twindow.requestAnimationFrame(processFrame);\r\n\t\t\t};\r\n\r\n\t\t\twindow.requestAnimationFrame(processFrame);\r\n\t\t};\r\n\r\n\t\tdetectSound();\r\n\t};\r\n\r\n\tlet finishedMessages = {};\r\n\tlet currentMessageId = null;\r\n\tlet currentUtterance = null;\r\n\r\n\tconst speakSpeechSynthesisHandler = (content) => {\r\n\t\tif ($showCallOverlay) {\r\n\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\tlet voices = [];\r\n\t\t\t\tconst getVoicesLoop = setInterval(async () => {\r\n\t\t\t\t\tvoices = await speechSynthesis.getVoices();\r\n\t\t\t\t\tif (voices.length > 0) {\r\n\t\t\t\t\t\tclearInterval(getVoicesLoop);\r\n\r\n\t\t\t\t\t\tconst voice =\r\n\t\t\t\t\t\t\tvoices\r\n\t\t\t\t\t\t\t\t?.filter(\r\n\t\t\t\t\t\t\t\t\t(v) => v.voiceURI === ($settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice)\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t?.at(0) ?? undefined;\r\n\r\n\t\t\t\t\t\tcurrentUtterance = new SpeechSynthesisUtterance(content);\r\n\r\n\t\t\t\t\t\tif (voice) {\r\n\t\t\t\t\t\t\tcurrentUtterance.voice = voice;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tspeechSynthesis.speak(currentUtterance);\r\n\t\t\t\t\t\tcurrentUtterance.onend = async (e) => {\r\n\t\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 200));\r\n\t\t\t\t\t\t\tresolve(e);\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 100);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t};\r\n\r\n\tconst playAudio = (audio) => {\r\n\t\tif ($showCallOverlay) {\r\n\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\tconst audioElement = document.getElementById('audioElement');\r\n\r\n\t\t\t\tif (audioElement) {\r\n\t\t\t\t\taudioElement.src = audio.src;\r\n\t\t\t\t\taudioElement.muted = true;\r\n\r\n\t\t\t\t\taudioElement\r\n\t\t\t\t\t\t.play()\r\n\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\taudioElement.muted = false;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch((error) => {\r\n\t\t\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\taudioElement.onended = async (e) => {\r\n\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 100));\r\n\t\t\t\t\t\tresolve(e);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t};\r\n\r\n\tconst stopAllAudio = async () => {\r\n\t\tassistantSpeaking = false;\r\n\t\tinterrupted = true;\r\n\r\n\t\tif (chatStreaming) {\r\n\t\t\tstopResponse();\r\n\t\t}\r\n\r\n\t\tif (currentUtterance) {\r\n\t\t\tspeechSynthesis.cancel();\r\n\t\t\tcurrentUtterance = null;\r\n\t\t}\r\n\r\n\t\tconst audioElement = document.getElementById('audioElement');\r\n\t\tif (audioElement) {\r\n\t\t\taudioElement.muted = true;\r\n\t\t\taudioElement.pause();\r\n\t\t\taudioElement.currentTime = 0;\r\n\t\t}\r\n\t};\r\n\r\n\tlet audioAbortController = new AbortController();\r\n\r\n\t// Audio cache map where key is the content and value is the Audio object.\r\n\tconst audioCache = new Map();\r\n\tconst emojiCache = new Map();\r\n\r\n\tconst fetchAudio = async (content) => {\r\n\t\tif (!audioCache.has(content)) {\r\n\t\t\ttry {\r\n\t\t\t\t// Set the emoji for the content if needed\r\n\t\t\t\tif ($settings?.showEmojiInCall ?? false) {\r\n\t\t\t\t\tconst emoji = await generateEmoji(localStorage.token, modelId, content, chatId);\r\n\t\t\t\t\tif (emoji) {\r\n\t\t\t\t\t\temojiCache.set(content, emoji);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($config.audio.tts.engine !== '') {\r\n\t\t\t\t\tconst res = await synthesizeOpenAISpeech(\r\n\t\t\t\t\t\tlocalStorage.token,\r\n\t\t\t\t\t\t$settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice,\r\n\t\t\t\t\t\tcontent\r\n\t\t\t\t\t).catch((error) => {\r\n\t\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (res) {\r\n\t\t\t\t\t\tconst blob = await res.blob();\r\n\t\t\t\t\t\tconst blobUrl = URL.createObjectURL(blob);\r\n\t\t\t\t\t\taudioCache.set(content, new Audio(blobUrl));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\taudioCache.set(content, true);\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('Error synthesizing speech:', error);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn audioCache.get(content);\r\n\t};\r\n\r\n\tlet messages = {};\r\n\r\n\tconst monitorAndPlayAudio = async (id, signal) => {\r\n\t\twhile (!signal.aborted) {\r\n\t\t\tif (messages[id] && messages[id].length > 0) {\r\n\t\t\t\t// Retrieve the next content string from the queue\r\n\t\t\t\tconst content = messages[id].shift(); // Dequeues the content for playing\r\n\r\n\t\t\t\tif (audioCache.has(content)) {\r\n\t\t\t\t\t// If content is available in the cache, play it\r\n\r\n\t\t\t\t\t// Set the emoji for the content if available\r\n\t\t\t\t\tif (($settings?.showEmojiInCall ?? false) && emojiCache.has(content)) {\r\n\t\t\t\t\t\temoji = emojiCache.get(content);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\temoji = null;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ($config.audio.tts.engine !== '') {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t\t\t'%c%s',\r\n\t\t\t\t\t\t\t\t'color: red; font-size: 20px;',\r\n\t\t\t\t\t\t\t\t`Playing audio for content: ${content}`\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tconst audio = audioCache.get(content);\r\n\t\t\t\t\t\t\tawait playAudio(audio); // Here ensure that playAudio is indeed correct method to execute\r\n\t\t\t\t\t\t\tconsole.log(`Played audio for content: ${content}`);\r\n\t\t\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\r\n\t\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\t\tconsole.error('Error playing audio:', error);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tawait speakSpeechSynthesisHandler(content);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// If not available in the cache, push it back to the queue and delay\r\n\t\t\t\t\tmessages[id].unshift(content); // Re-queue the content at the start\r\n\t\t\t\t\tconsole.log(`Audio for \"${content}\" not yet available in the cache, re-queued...`);\r\n\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\r\n\t\t\t\t}\r\n\t\t\t} else if (finishedMessages[id] && messages[id] && messages[id].length === 0) {\r\n\t\t\t\t// If the message is finished and there are no more messages to process, break the loop\r\n\t\t\t\tassistantSpeaking = false;\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\t// No messages to process, sleep for a bit\r\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200));\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.log(`Audio monitoring and playing stopped for message ID ${id}`);\r\n\t};\r\n\r\n\tonMount(async () => {\r\n\t\tconst setWakeLock = async () => {\r\n\t\t\ttry {\r\n\t\t\t\twakeLock = await navigator.wakeLock.request('screen');\r\n\t\t\t} catch (err) {\r\n\t\t\t\t// The Wake Lock request has failed - usually system related, such as battery.\r\n\t\t\t\tconsole.log(err);\r\n\t\t\t}\r\n\r\n\t\t\tif (wakeLock) {\r\n\t\t\t\t// Add a listener to release the wake lock when the page is unloaded\r\n\t\t\t\twakeLock.addEventListener('release', () => {\r\n\t\t\t\t\t// the wake lock has been released\r\n\t\t\t\t\tconsole.log('Wake Lock released');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif ('wakeLock' in navigator) {\r\n\t\t\tawait setWakeLock();\r\n\r\n\t\t\tdocument.addEventListener('visibilitychange', async () => {\r\n\t\t\t\t// Re-request the wake lock if the document becomes visible\r\n\t\t\t\tif (wakeLock !== null && document.visibilityState === 'visible') {\r\n\t\t\t\t\tawait setWakeLock();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tmodel = $models.find((m) => m.id === modelId);\r\n\r\n\t\tstartRecording();\r\n\r\n\t\tconst chatStartHandler = async (e) => {\r\n\t\t\tconst { id } = e.detail;\r\n\r\n\t\t\tchatStreaming = true;\r\n\r\n\t\t\tif (currentMessageId !== id) {\r\n\t\t\t\tconsole.log(`Received chat start event for message ID ${id}`);\r\n\r\n\t\t\t\tcurrentMessageId = id;\r\n\t\t\t\tif (audioAbortController) {\r\n\t\t\t\t\taudioAbortController.abort();\r\n\t\t\t\t}\r\n\t\t\t\taudioAbortController = new AbortController();\r\n\r\n\t\t\t\tassistantSpeaking = true;\r\n\t\t\t\t// Start monitoring and playing audio for the message ID\r\n\t\t\t\tmonitorAndPlayAudio(id, audioAbortController.signal);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst chatEventHandler = async (e) => {\r\n\t\t\tconst { id, content } = e.detail;\r\n\t\t\t// \"id\" here is message id\r\n\t\t\t// if \"id\" is not the same as \"currentMessageId\" then do not process\r\n\t\t\t// \"content\" here is a sentence from the assistant,\r\n\t\t\t// there will be many sentences for the same \"id\"\r\n\r\n\t\t\tif (currentMessageId === id) {\r\n\t\t\t\tconsole.log(`Received chat event for message ID ${id}: ${content}`);\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (messages[id] === undefined) {\r\n\t\t\t\t\t\tmessages[id] = [content];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmessages[id].push(content);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconsole.log(content);\r\n\r\n\t\t\t\t\tfetchAudio(content);\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('Failed to fetch or play audio:', error);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst chatFinishHandler = async (e) => {\r\n\t\t\tconst { id, content } = e.detail;\r\n\t\t\t// \"content\" here is the entire message from the assistant\r\n\t\t\tfinishedMessages[id] = true;\r\n\r\n\t\t\tchatStreaming = false;\r\n\t\t};\r\n\r\n\t\teventTarget.addEventListener('chat:start', chatStartHandler);\r\n\t\teventTarget.addEventListener('chat', chatEventHandler);\r\n\t\teventTarget.addEventListener('chat:finish', chatFinishHandler);\r\n\r\n\t\treturn async () => {\r\n\t\t\teventTarget.removeEventListener('chat:start', chatStartHandler);\r\n\t\t\teventTarget.removeEventListener('chat', chatEventHandler);\r\n\t\t\teventTarget.removeEventListener('chat:finish', chatFinishHandler);\r\n\r\n\t\t\taudioAbortController.abort();\r\n\t\t\tawait tick();\r\n\r\n\t\t\tawait stopAllAudio();\r\n\r\n\t\t\tawait stopRecordingCallback(false);\r\n\t\t\tawait stopCamera();\r\n\t\t};\r\n\t});\r\n\r\n\tonDestroy(async () => {\r\n\t\tawait stopAllAudio();\r\n\t\tawait stopRecordingCallback(false);\r\n\t\tawait stopCamera();\r\n\t});\r\n</script>\r\n\r\n{#if $showCallOverlay}\r\n\t<div class=\"max-w-lg w-full h-full max-h-[100dvh] flex flex-col justify-between p-3 md:p-6\">\r\n\t\t{#if camera}\r\n\t\t\t<button\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tclass=\"flex justify-center items-center w-full h-20 min-h-20\"\r\n\t\t\t\ton:click={() => {\r\n\t\t\t\t\tif (assistantSpeaking) {\r\n\t\t\t\t\t\tstopAllAudio();\r\n\t\t\t\t\t}\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t{#if emoji}\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\r\n\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\r\n\t\t\t\t\t\t\t? '4.5'\r\n\t\t\t\t\t\t\t: rmsLevel * 100 > 2\r\n\t\t\t\t\t\t\t\t? '4.25'\r\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\r\n\t\t\t\t\t\t\t\t\t? '3.75'\r\n\t\t\t\t\t\t\t\t\t: '3.5'}rem;width: 100%; text-align:center;\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{emoji}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t{:else if loading || assistantSpeaking}\r\n\t\t\t\t\t<svg\r\n\t\t\t\t\t\tclass=\"size-12 text-gray-900 dark:text-gray-400\"\r\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t><style>\r\n\t\t\t\t\t\t\t.spinner_qM83 {\r\n\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t.spinner_oXPr {\r\n\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t.spinner_ZTLf {\r\n\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t@keyframes spinner_8HQG {\r\n\t\t\t\t\t\t\t\t0%,\r\n\t\t\t\t\t\t\t\t57.14% {\r\n\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\r\n\t\t\t\t\t\t\t\t\ttransform: translate(0);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t28.57% {\r\n\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\r\n\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t100% {\r\n\t\t\t\t\t\t\t\t\ttransform: translate(0);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\r\n\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\r\n\t\t\t\t\t\t\tcx=\"12\"\r\n\t\t\t\t\t\t\tcy=\"12\"\r\n\t\t\t\t\t\t\tr=\"3\"\r\n\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\r\n\t\t\t\t\t>\r\n\t\t\t\t{:else}\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\r\n\t\t\t\t\t\t\t? ' size-[4.5rem]'\r\n\t\t\t\t\t\t\t: rmsLevel * 100 > 2\r\n\t\t\t\t\t\t\t\t? ' size-16'\r\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\r\n\t\t\t\t\t\t\t\t\t? 'size-14'\r\n\t\t\t\t\t\t\t\t\t: 'size-12'}  transition-all rounded-full {(model?.info?.meta\r\n\t\t\t\t\t\t\t?.profile_image_url ?? '/static/favicon.png') !== '/static/favicon.png'\r\n\t\t\t\t\t\t\t? ' bg-cover bg-center bg-no-repeat'\r\n\t\t\t\t\t\t\t: 'bg-black dark:bg-white'}  bg-black dark:bg-white\"\r\n\t\t\t\t\t\tstyle={(model?.info?.meta?.profile_image_url ?? '/static/favicon.png') !==\r\n\t\t\t\t\t\t'/static/favicon.png'\r\n\t\t\t\t\t\t\t? `background-image: url('${model?.info?.meta?.profile_image_url}');`\r\n\t\t\t\t\t\t\t: ''}\r\n\t\t\t\t\t/>\r\n\t\t\t\t{/if}\r\n\t\t\t\t<!-- navbar -->\r\n\t\t\t</button>\r\n\t\t{/if}\r\n\r\n\t\t<div class=\"flex justify-center items-center flex-1 h-full w-full max-h-full\">\r\n\t\t\t{#if !camera}\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\tif (assistantSpeaking) {\r\n\t\t\t\t\t\t\tstopAllAudio();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t{#if emoji}\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\r\n\t\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\r\n\t\t\t\t\t\t\t\t? '13'\r\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\r\n\t\t\t\t\t\t\t\t\t? '12'\r\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\r\n\t\t\t\t\t\t\t\t\t\t? '11.5'\r\n\t\t\t\t\t\t\t\t\t\t: '11'}rem;width:100%;text-align:center;\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{emoji}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t{:else if loading || assistantSpeaking}\r\n\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\tclass=\"size-44 text-gray-900 dark:text-gray-400\"\r\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t><style>\r\n\t\t\t\t\t\t\t\t.spinner_qM83 {\r\n\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t.spinner_oXPr {\r\n\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t.spinner_ZTLf {\r\n\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\r\n\t\t\t\t\t\t\t\t\t0%,\r\n\t\t\t\t\t\t\t\t\t57.14% {\r\n\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\r\n\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t28.57% {\r\n\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\r\n\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t100% {\r\n\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\r\n\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\r\n\t\t\t\t\t\t\t\tcx=\"12\"\r\n\t\t\t\t\t\t\t\tcy=\"12\"\r\n\t\t\t\t\t\t\t\tr=\"3\"\r\n\t\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t{:else}\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\r\n\t\t\t\t\t\t\t\t? ' size-52'\r\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\r\n\t\t\t\t\t\t\t\t\t? 'size-48'\r\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\r\n\t\t\t\t\t\t\t\t\t\t? 'size-44'\r\n\t\t\t\t\t\t\t\t\t\t: 'size-40'}  transition-all rounded-full {(model?.info?.meta\r\n\t\t\t\t\t\t\t\t?.profile_image_url ?? '/static/favicon.png') !== '/static/favicon.png'\r\n\t\t\t\t\t\t\t\t? ' bg-cover bg-center bg-no-repeat'\r\n\t\t\t\t\t\t\t\t: 'bg-black dark:bg-white'} \"\r\n\t\t\t\t\t\t\tstyle={(model?.info?.meta?.profile_image_url ?? '/static/favicon.png') !==\r\n\t\t\t\t\t\t\t'/static/favicon.png'\r\n\t\t\t\t\t\t\t\t? `background-image: url('${model?.info?.meta?.profile_image_url}');`\r\n\t\t\t\t\t\t\t\t: ''}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t{/if}\r\n\t\t\t\t</button>\r\n\t\t\t{:else}\r\n\t\t\t\t<div class=\"relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full\">\r\n\t\t\t\t\t<video\r\n\t\t\t\t\t\tid=\"camera-feed\"\r\n\t\t\t\t\t\tautoplay\r\n\t\t\t\t\t\tclass=\"rounded-2xl h-full min-w-full object-cover object-center\"\r\n\t\t\t\t\t\tplaysinline\r\n\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t<canvas id=\"camera-canvas\" style=\"display:none;\" />\r\n\r\n\t\t\t\t\t<div class=\" absolute top-4 md:top-8 left-4\">\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\tclass=\"p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tstopCamera();\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\r\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\tclass=\"size-6\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\td=\"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t{/if}\r\n\t\t</div>\r\n\r\n\t\t<div class=\"flex justify-between items-center pb-2 w-full\">\r\n\t\t\t<div>\r\n\t\t\t\t{#if camera}\r\n\t\t\t\t\t<VideoInputMenu\r\n\t\t\t\t\t\tdevices={videoInputDevices}\r\n\t\t\t\t\t\ton:change={async (e) => {\r\n\t\t\t\t\t\t\tconsole.log(e.detail);\r\n\t\t\t\t\t\t\tselectedVideoInputDeviceId = e.detail;\r\n\t\t\t\t\t\t\tawait stopVideoStream();\r\n\t\t\t\t\t\t\tawait startVideoStream();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<button class=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\" type=\"button\">\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\tclass=\"size-5\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\td=\"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z\"\r\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</VideoInputMenu>\r\n\t\t\t\t{:else}\r\n\t\t\t\t\t<Tooltip content={$i18n.t('Camera')}>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\ton:click={async () => {\r\n\t\t\t\t\t\t\t\tawait navigator.mediaDevices.getUserMedia({ video: true });\r\n\t\t\t\t\t\t\t\tstartCamera();\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\t\tclass=\"size-5\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\t\t\t\td=\"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\t\t\t\td=\"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</Tooltip>\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div>\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\tif (assistantSpeaking) {\r\n\t\t\t\t\t\t\tstopAllAudio();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div class=\" line-clamp-1 text-sm font-medium\">\r\n\t\t\t\t\t\t{#if loading}\r\n\t\t\t\t\t\t\t{$i18n.t('Thinking...')}\r\n\t\t\t\t\t\t{:else if assistantSpeaking}\r\n\t\t\t\t\t\t\t{$i18n.t('Tap to interrupt')}\r\n\t\t\t\t\t\t{:else}\r\n\t\t\t\t\t\t\t{$i18n.t('Listening...')}\r\n\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div>\r\n\t\t\t\t<button\r\n\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\r\n\t\t\t\t\ton:click={async () => {\r\n\t\t\t\t\t\tstopAudioStream();\r\n\t\t\t\t\t\tstopVideoStream();\r\n\t\t\t\t\t\tshowCallOverlay.set(false);\r\n\t\t\t\t\t\tdispatch('close');\r\n\t\t\t\t\t}}\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<svg\r\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\tclass=\"size-5\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n","<script lang=\"ts\">\r\n\timport { onDestroy, onMount, createEventDispatcher } from 'svelte';\r\n\timport { flyAndScale } from '$lib/utils/transitions';\r\n\timport { fade, fly, slide } from 'svelte/transition';\r\n\r\n\texport let show = false;\r\n\texport let size = 'md';\r\n\r\n\tlet modalElement = null;\r\n\tlet mounted = false;\r\n\r\n\tconst sizeToWidth = (size) => {\r\n\t\tif (size === 'xs') {\r\n\t\t\treturn 'w-[16rem]';\r\n\t\t} else if (size === 'sm') {\r\n\t\t\treturn 'w-[30rem]';\r\n\t\t} else if (size === 'md') {\r\n\t\t\treturn 'w-[48rem]';\r\n\t\t} else {\r\n\t\t\treturn 'w-[56rem]';\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleKeyDown = (event: KeyboardEvent) => {\r\n\t\tif (event.key === 'Escape' && isTopModal()) {\r\n\t\t\tconsole.log('Escape');\r\n\t\t\tshow = false;\r\n\t\t}\r\n\t};\r\n\r\n\tconst isTopModal = () => {\r\n\t\tconst modals = document.getElementsByClassName('modal');\r\n\t\treturn modals.length && modals[modals.length - 1] === modalElement;\r\n\t};\r\n\r\n\tonMount(() => {\r\n\t\tmounted = true;\r\n\t});\r\n\r\n\t$: if (show && modalElement) {\r\n\t\tdocument.body.appendChild(modalElement);\r\n\t\twindow.addEventListener('keydown', handleKeyDown);\r\n\t\tdocument.body.style.overflow = 'hidden';\r\n\t} else if (modalElement) {\r\n\t\twindow.removeEventListener('keydown', handleKeyDown);\r\n\t\tdocument.body.removeChild(modalElement);\r\n\t\tdocument.body.style.overflow = 'unset';\r\n\t}\r\n\r\n\tonDestroy(() => {\r\n\t\tshow = false;\r\n\t\tif (modalElement) {\r\n\t\t\tdocument.body.removeChild(modalElement);\r\n\t\t}\r\n\t});\r\n</script>\r\n\r\n<!-- svelte-ignore a11y-click-events-have-key-events -->\r\n<!-- svelte-ignore a11y-no-static-element-interactions -->\r\n\r\n<div\r\n\tbind:this={modalElement}\r\n\tclass=\"modal fixed right-0 left-0 bottom-0 bg-black/60 w-full h-screen max-h-[100dvh] flex justify-center z-[9999] overflow-hidden overscroll-contain\"\r\n\tin:fly={{ y: 100, duration: 100 }}\r\n\ton:mousedown={() => {\r\n\t\tshow = false;\r\n\t}}\r\n>\r\n\t<div\r\n\t\tclass=\" mt-auto max-w-full w-full bg-gray-50 dark:bg-gray-900 max-h-[100dvh] overflow-y-auto scrollbar-hidden\"\r\n\t\ton:mousedown={(e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t}}\r\n\t>\r\n\t\t<slot />\r\n\t</div>\r\n</div>\r\n\r\n<style>\r\n\t.modal-content {\r\n\t\tanimation: scaleUp 0.1s ease-out forwards;\r\n\t}\r\n\r\n\t@keyframes scaleUp {\r\n\t\tfrom {\r\n\t\t\ttransform: scale(0.985);\r\n\t\t\topacity: 0;\r\n\t\t}\r\n\t\tto {\r\n\t\t\ttransform: scale(1);\r\n\t\t\topacity: 1;\r\n\t\t}\r\n\t}\r\n</style>\r\n","<script lang=\"ts\">\r\n\timport { slide } from 'svelte/transition';\r\n\timport Modal from '../common/Modal.svelte';\r\n\timport Controls from './Controls/Controls.svelte';\r\n\timport { onMount } from 'svelte';\r\n\timport { mobile, showCallOverlay } from '$lib/stores';\r\n\timport CallOverlay from './MessageInput/CallOverlay.svelte';\r\n\timport Drawer from '../common/Drawer.svelte';\r\n\r\n\texport let show = false;\r\n\r\n\texport let models = [];\r\n\r\n\texport let chatId = null;\r\n\texport let chatFiles = [];\r\n\texport let params = {};\r\n\r\n\texport let eventTarget: EventTarget;\r\n\texport let submitPrompt: Function;\r\n\texport let stopResponse: Function;\r\n\texport let files;\r\n\texport let modelId;\r\n\r\n\tlet largeScreen = false;\r\n\tonMount(() => {\r\n\t\t// listen to resize 1024px\r\n\t\tconst mediaQuery = window.matchMedia('(min-width: 1024px)');\r\n\r\n\t\tconst handleMediaQuery = (e) => {\r\n\t\t\tif (e.matches) {\r\n\t\t\t\tlargeScreen = true;\r\n\t\t\t} else {\r\n\t\t\t\tlargeScreen = false;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tmediaQuery.addEventListener('change', handleMediaQuery);\r\n\r\n\t\thandleMediaQuery(mediaQuery);\r\n\r\n\t\treturn () => {\r\n\t\t\tmediaQuery.removeEventListener('change', handleMediaQuery);\r\n\t\t};\r\n\t});\r\n</script>\r\n\r\n{#if !largeScreen}\r\n\t{#if $showCallOverlay}\r\n\t\t<div class=\" absolute w-full h-screen max-h-[100dvh] flex z-[999] overflow-hidden\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\"absolute w-full h-screen max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center\"\r\n\t\t\t>\r\n\t\t\t\t<CallOverlay\r\n\t\t\t\t\tbind:files\r\n\t\t\t\t\t{submitPrompt}\r\n\t\t\t\t\t{stopResponse}\r\n\t\t\t\t\t{modelId}\r\n\t\t\t\t\t{chatId}\r\n\t\t\t\t\t{eventTarget}\r\n\t\t\t\t\ton:close={() => {\r\n\t\t\t\t\t\tshow = false;\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t{:else if show}\r\n\t\t<Drawer bind:show>\r\n\t\t\t<div class=\"  px-6 py-4 h-full\">\r\n\t\t\t\t<Controls\r\n\t\t\t\t\ton:close={() => {\r\n\t\t\t\t\t\tshow = false;\r\n\t\t\t\t\t}}\r\n\t\t\t\t\t{models}\r\n\t\t\t\t\tbind:chatFiles\r\n\t\t\t\t\tbind:params\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</Drawer>\r\n\t{/if}\r\n{:else if show}\r\n\t<div class=\" absolute bottom-0 right-0 z-20 h-full pointer-events-none\">\r\n\t\t<div class=\"pr-4 pt-14 pb-8 w-[24rem] h-full\" in:slide={{ duration: 200, axis: 'x' }}>\r\n\t\t\t<div\r\n\t\t\t\tclass=\"w-full h-full px-5 py-4 bg-white dark:shadow-lg dark:bg-gray-850 border border-gray-50 dark:border-gray-800 rounded-xl z-50 pointer-events-auto overflow-y-auto scrollbar-hidden\"\r\n\t\t\t>\r\n\t\t\t\t{#if $showCallOverlay}\r\n\t\t\t\t\t<CallOverlay bind:files {submitPrompt} {stopResponse} {modelId} {chatId} {eventTarget} />\r\n\t\t\t\t{:else}\r\n\t\t\t\t\t<Controls\r\n\t\t\t\t\t\ton:close={() => {\r\n\t\t\t\t\t\t\tshow = false;\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t{models}\r\n\t\t\t\t\t\tbind:chatFiles\r\n\t\t\t\t\t\tbind:params\r\n\t\t\t\t\t/>\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n","<script lang=\"ts\">\r\n\timport { v4 as uuidv4 } from 'uuid';\r\n\timport { toast } from 'svelte-sonner';\r\n\timport mermaid from 'mermaid';\r\n\r\n\timport { getContext, onDestroy, onMount, tick } from 'svelte';\r\n\timport { goto } from '$app/navigation';\r\n\timport { page } from '$app/stores';\r\n\r\n\timport type { Unsubscriber, Writable } from 'svelte/store';\r\n\timport type { i18n as i18nType } from 'i18next';\r\n\timport { WEBUI_BASE_URL } from '$lib/constants';\r\n\r\n\timport {\r\n\t\tchatId,\r\n\t\tchats,\r\n\t\tconfig,\r\n\t\ttype Model,\r\n\t\tmodels,\r\n\t\tsettings,\r\n\t\tshowSidebar,\r\n\t\tWEBUI_NAME,\r\n\t\tbanners,\r\n\t\tuser,\r\n\t\tsocket,\r\n\t\tshowCallOverlay,\r\n\t\tcurrentChatPage,\r\n\t\ttemporaryChatEnabled\r\n\t} from '$lib/stores';\r\n\timport {\r\n\t\tconvertMessagesToHistory,\r\n\t\tcopyToClipboard,\r\n\t\tgetMessageContentParts,\r\n\t\textractSentencesForAudio,\r\n\t\tpromptTemplate,\r\n\t\tsplitStream\r\n\t} from '$lib/utils';\r\n\r\n\timport { generateChatCompletion } from '$lib/apis/ollama';\r\n\timport {\r\n\t\tcreateNewChat,\r\n\t\tgetChatById,\r\n\t\tgetChatList,\r\n\t\tgetTagsById,\r\n\t\tupdateChatById\r\n\t} from '$lib/apis/chats';\r\n\timport { generateOpenAIChatCompletion } from '$lib/apis/openai';\r\n\timport { runWebSearch } from '$lib/apis/rag';\r\n\timport { createOpenAITextStream } from '$lib/apis/streaming';\r\n\timport { queryMemory } from '$lib/apis/memories';\r\n\timport { getAndUpdateUserLocation, getUserSettings } from '$lib/apis/users';\r\n\timport {\r\n\t\tchatCompleted,\r\n\t\tgenerateTitle,\r\n\t\tgenerateSearchQuery,\r\n\t\tchatAction,\r\n\t\tgenerateMoACompletion\r\n\t} from '$lib/apis';\r\n\r\n\timport Banner from '../common/Banner.svelte';\r\n\timport MessageInput from '$lib/components/chat/MessageInput.svelte';\r\n\timport Messages from '$lib/components/chat/Messages.svelte';\r\n\timport Navbar from '$lib/components/layout/Navbar.svelte';\r\n\timport ChatControls from './ChatControls.svelte';\r\n\timport EventConfirmDialog from '../common/ConfirmDialog.svelte';\r\n\r\n\tconst i18n: Writable<i18nType> = getContext('i18n');\r\n\r\n\texport let chatIdProp = '';\r\n\tlet loaded = false;\r\n\tconst eventTarget = new EventTarget();\r\n\r\n\tlet showControls = false;\r\n\tlet stopResponseFlag = false;\r\n\tlet autoScroll = true;\r\n\tlet processing = '';\r\n\tlet messagesContainerElement: HTMLDivElement;\r\n\r\n\tlet showEventConfirmation = false;\r\n\tlet eventConfirmationTitle = '';\r\n\tlet eventConfirmationMessage = '';\r\n\tlet eventConfirmationInput = false;\r\n\tlet eventConfirmationInputPlaceholder = '';\r\n\tlet eventConfirmationInputValue = '';\r\n\tlet eventCallback = null;\r\n\r\n\tlet showModelSelector = true;\r\n\r\n\tlet selectedModels = [''];\r\n\tlet atSelectedModel: Model | undefined;\r\n\r\n\tlet selectedModelIds = [];\r\n\t$: selectedModelIds = atSelectedModel !== undefined ? [atSelectedModel.id] : selectedModels;\r\n\r\n\tlet selectedToolIds = [];\r\n\tlet webSearchEnabled = false;\r\n\r\n\tlet chat = null;\r\n\tlet tags = [];\r\n\r\n\tlet title = '';\r\n\tlet prompt = '';\r\n\r\n\tlet chatFiles = [];\r\n\tlet files = [];\r\n\tlet messages = [];\r\n\tlet history = {\r\n\t\tmessages: {},\r\n\t\tcurrentId: null\r\n\t};\r\n\r\n\tlet params = {};\r\n\r\n\tlet chatIdUnsubscriber: Unsubscriber | undefined;\r\n\r\n\t$: if (history.currentId !== null) {\r\n\t\tlet _messages = [];\r\n\r\n\t\tlet currentMessage = history.messages[history.currentId];\r\n\t\twhile (currentMessage !== null) {\r\n\t\t\t_messages.unshift({ ...currentMessage });\r\n\t\t\tcurrentMessage =\r\n\t\t\t\tcurrentMessage.parentId !== null ? history.messages[currentMessage.parentId] : null;\r\n\t\t}\r\n\t\tmessages = _messages;\r\n\t} else {\r\n\t\tmessages = [];\r\n\t}\r\n\r\n\t$: if (chatIdProp) {\r\n\t\t(async () => {\r\n\t\t\tconsole.log(chatIdProp);\r\n\t\t\tif (chatIdProp && (await loadChat())) {\r\n\t\t\t\tawait tick();\r\n\t\t\t\tloaded = true;\r\n\r\n\t\t\t\twindow.setTimeout(() => scrollToBottom(), 0);\r\n\t\t\t\tconst chatInput = document.getElementById('chat-textarea');\r\n\t\t\t\tchatInput?.focus();\r\n\t\t\t} else {\r\n\t\t\t\tawait goto('/');\r\n\t\t\t}\r\n\t\t})();\r\n\t}\r\n\r\n\tconst chatEventHandler = async (event, cb) => {\r\n\t\tif (event.chat_id === $chatId) {\r\n\t\t\tawait tick();\r\n\t\t\tconsole.log(event);\r\n\t\t\tlet message = history.messages[event.message_id];\r\n\r\n\t\t\tconst type = event?.data?.type ?? null;\r\n\t\t\tconst data = event?.data?.data ?? null;\r\n\r\n\t\t\tif (type === 'status') {\r\n\t\t\t\tif (message?.statusHistory) {\r\n\t\t\t\t\tmessage.statusHistory.push(data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmessage.statusHistory = [data];\r\n\t\t\t\t}\r\n\t\t\t} else if (type === 'citation') {\r\n\t\t\t\tif (message?.citations) {\r\n\t\t\t\t\tmessage.citations.push(data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmessage.citations = [data];\r\n\t\t\t\t}\r\n\t\t\t} else if (type === 'message') {\r\n\t\t\t\tmessage.content += data.content;\r\n\t\t\t} else if (type === 'replace') {\r\n\t\t\t\tmessage.content = data.content;\r\n\t\t\t} else if (type === 'action') {\r\n\t\t\t\tif (data.action === 'continue') {\r\n\t\t\t\t\tconst continueButton = document.getElementById('continue-response-button');\r\n\r\n\t\t\t\t\tif (continueButton) {\r\n\t\t\t\t\t\tcontinueButton.click();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (type === 'confirmation') {\r\n\t\t\t\teventCallback = cb;\r\n\r\n\t\t\t\teventConfirmationInput = false;\r\n\t\t\t\tshowEventConfirmation = true;\r\n\r\n\t\t\t\teventConfirmationTitle = data.title;\r\n\t\t\t\teventConfirmationMessage = data.message;\r\n\t\t\t} else if (type === 'input') {\r\n\t\t\t\teventCallback = cb;\r\n\r\n\t\t\t\teventConfirmationInput = true;\r\n\t\t\t\tshowEventConfirmation = true;\r\n\r\n\t\t\t\teventConfirmationTitle = data.title;\r\n\t\t\t\teventConfirmationMessage = data.message;\r\n\t\t\t\teventConfirmationInputPlaceholder = data.placeholder;\r\n\t\t\t\teventConfirmationInputValue = data?.value ?? '';\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('Unknown message type', data);\r\n\t\t\t}\r\n\r\n\t\t\tmessages = messages;\r\n\t\t}\r\n\t};\r\n\r\n\tconst onMessageHandler = async (event: {\r\n\t\torigin: string;\r\n\t\tdata: { type: string; text: string };\r\n\t}) => {\r\n\t\tif (event.origin !== window.origin) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Replace with your iframe's origin\r\n\t\tif (event.data.type === 'input:prompt') {\r\n\t\t\tconsole.debug(event.data.text);\r\n\r\n\t\t\tconst inputElement = document.getElementById('chat-textarea');\r\n\r\n\t\t\tif (inputElement) {\r\n\t\t\t\tprompt = event.data.text;\r\n\t\t\t\tinputElement.focus();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (event.data.type === 'action:submit') {\r\n\t\t\tconsole.debug(event.data.text);\r\n\r\n\t\t\tif (prompt !== '') {\r\n\t\t\t\tawait tick();\r\n\t\t\t\tsubmitPrompt(prompt);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (event.data.type === 'input:prompt:submit') {\r\n\t\t\tconsole.debug(event.data.text);\r\n\r\n\t\t\tif (prompt !== '') {\r\n\t\t\t\tawait tick();\r\n\t\t\t\tsubmitPrompt(event.data.text);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tonMount(async () => {\r\n\t\twindow.addEventListener('message', onMessageHandler);\r\n\t\t$socket?.on('chat-events', chatEventHandler);\r\n\r\n\t\tif (!$chatId) {\r\n\t\t\tchatIdUnsubscriber = chatId.subscribe(async (value) => {\r\n\t\t\t\tif (!value) {\r\n\t\t\t\t\tawait initNewChat();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif ($temporaryChatEnabled) {\r\n\t\t\t\tawait goto('/');\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tonDestroy(() => {\r\n\t\tchatIdUnsubscriber?.();\r\n\t\twindow.removeEventListener('message', onMessageHandler);\r\n\t\t$socket?.off('chat-events');\r\n\t});\r\n\r\n\t//////////////////////////\r\n\t// Web functions\r\n\t//////////////////////////\r\n\r\n\tconst initNewChat = async () => {\r\n\t\tif ($page.url.pathname.includes('/c/')) {\r\n\t\t\twindow.history.replaceState(history.state, '', `/`);\r\n\t\t}\r\n\r\n\t\tawait chatId.set('');\r\n\t\tautoScroll = true;\r\n\r\n\t\ttitle = '';\r\n\t\tmessages = [];\r\n\t\thistory = {\r\n\t\t\tmessages: {},\r\n\t\t\tcurrentId: null\r\n\t\t};\r\n\r\n\t\tchatFiles = [];\r\n\t\tparams = {};\r\n\r\n\t\tif ($page.url.searchParams.get('models')) {\r\n\t\t\tselectedModels = $page.url.searchParams.get('models')?.split(',');\r\n\t\t} else if ($settings?.models) {\r\n\t\t\tselectedModels = $settings?.models;\r\n\t\t} else if ($config?.default_models) {\r\n\t\t\tconsole.log($config?.default_models.split(',') ?? '');\r\n\t\t\tselectedModels = $config?.default_models.split(',');\r\n\t\t} else {\r\n\t\t\tselectedModels = [''];\r\n\t\t}\r\n\r\n\t\tif ($page.url.searchParams.get('web-search') === 'true') {\r\n\t\t\twebSearchEnabled = true;\r\n\t\t}\r\n\r\n\t\tif ($page.url.searchParams.get('q')) {\r\n\t\t\tprompt = $page.url.searchParams.get('q') ?? '';\r\n\t\t\tselectedToolIds = ($page.url.searchParams.get('tool_ids') ?? '')\r\n\t\t\t\t.split(',')\r\n\t\t\t\t.map((id) => id.trim())\r\n\t\t\t\t.filter((id) => id);\r\n\r\n\t\t\tif (prompt) {\r\n\t\t\t\tawait tick();\r\n\t\t\t\tsubmitPrompt(prompt);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($page.url.searchParams.get('call') === 'true') {\r\n\t\t\tshowCallOverlay.set(true);\r\n\t\t}\r\n\r\n\t\tselectedModels = selectedModels.map((modelId) =>\r\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\r\n\t\t);\r\n\r\n\t\tconst userSettings = await getUserSettings(localStorage.token);\r\n\r\n\t\tif (userSettings) {\r\n\t\t\tsettings.set(userSettings.ui);\r\n\t\t} else {\r\n\t\t\tsettings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\r\n\t\t}\r\n\r\n\t\tconst chatInput = document.getElementById('chat-textarea');\r\n\t\tsetTimeout(() => chatInput?.focus(), 0);\r\n\t};\r\n\r\n\tconst loadChat = async () => {\r\n\t\tchatId.set(chatIdProp);\r\n\t\tchat = await getChatById(localStorage.token, $chatId).catch(async (error) => {\r\n\t\t\tawait goto('/');\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (chat) {\r\n\t\t\ttags = await getTags();\r\n\t\t\tconst chatContent = chat.chat;\r\n\r\n\t\t\tif (chatContent) {\r\n\t\t\t\tconsole.log(chatContent);\r\n\r\n\t\t\t\tselectedModels =\r\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\r\n\t\t\t\t\t\t? chatContent.models\r\n\t\t\t\t\t\t: [chatContent.models ?? ''];\r\n\t\t\t\thistory =\r\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\r\n\t\t\t\t\t\t? chatContent.history\r\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\r\n\t\t\t\ttitle = chatContent.title;\r\n\r\n\t\t\t\tconst userSettings = await getUserSettings(localStorage.token);\r\n\r\n\t\t\t\tif (userSettings) {\r\n\t\t\t\t\tawait settings.set(userSettings.ui);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tawait settings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparams = chatContent?.params ?? {};\r\n\t\t\t\tchatFiles = chatContent?.files ?? [];\r\n\r\n\t\t\t\tautoScroll = true;\r\n\t\t\t\tawait tick();\r\n\r\n\t\t\t\tif (messages.length > 0) {\r\n\t\t\t\t\thistory.messages[messages.at(-1).id].done = true;\r\n\t\t\t\t}\r\n\t\t\t\tawait tick();\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst scrollToBottom = async () => {\r\n\t\tawait tick();\r\n\t\tif (messagesContainerElement) {\r\n\t\t\tmessagesContainerElement.scrollTop = messagesContainerElement.scrollHeight;\r\n\t\t}\r\n\t};\r\n\r\n\tconst createMessagesList = (responseMessageId) => {\r\n\t\tconst message = history.messages[responseMessageId];\r\n\t\tif (message.parentId) {\r\n\t\t\treturn [...createMessagesList(message.parentId), message];\r\n\t\t} else {\r\n\t\t\treturn [message];\r\n\t\t}\r\n\t};\r\n\r\n\tconst chatCompletedHandler = async (chatId, modelId, responseMessageId, messages) => {\r\n\t\tawait mermaid.run({\r\n\t\t\tquerySelector: '.mermaid'\r\n\t\t});\r\n\r\n\t\tconst res = await chatCompleted(localStorage.token, {\r\n\t\t\tmodel: modelId,\r\n\t\t\tmessages: messages.map((m) => ({\r\n\t\t\t\tid: m.id,\r\n\t\t\t\trole: m.role,\r\n\t\t\t\tcontent: m.content,\r\n\t\t\t\tinfo: m.info ? m.info : undefined,\r\n\t\t\t\ttimestamp: m.timestamp\r\n\t\t\t})),\r\n\t\t\tchat_id: chatId,\r\n\t\t\tsession_id: $socket?.id,\r\n\t\t\tid: responseMessageId\r\n\t\t}).catch((error) => {\r\n\t\t\ttoast.error(error);\r\n\t\t\tmessages.at(-1).error = { content: error };\r\n\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (res !== null) {\r\n\t\t\t// Update chat history with the new messages\r\n\t\t\tfor (const message of res.messages) {\r\n\t\t\t\thistory.messages[message.id] = {\r\n\t\t\t\t\t...history.messages[message.id],\r\n\t\t\t\t\t...(history.messages[message.id].content !== message.content\r\n\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\r\n\t\t\t\t\t\t: {}),\r\n\t\t\t\t\t...message\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($chatId == chatId) {\r\n\t\t\tif (!$temporaryChatEnabled) {\r\n\t\t\t\tchat = await updateChatById(localStorage.token, chatId, {\r\n\t\t\t\t\tmodels: selectedModels,\r\n\t\t\t\t\tmessages: messages,\r\n\t\t\t\t\thistory: history,\r\n\t\t\t\t\tparams: params,\r\n\t\t\t\t\tfiles: chatFiles\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcurrentChatPage.set(1);\r\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst chatActionHandler = async (chatId, actionId, modelId, responseMessageId, event = null) => {\r\n\t\tconst res = await chatAction(localStorage.token, actionId, {\r\n\t\t\tmodel: modelId,\r\n\t\t\tmessages: messages.map((m) => ({\r\n\t\t\t\tid: m.id,\r\n\t\t\t\trole: m.role,\r\n\t\t\t\tcontent: m.content,\r\n\t\t\t\tinfo: m.info ? m.info : undefined,\r\n\t\t\t\ttimestamp: m.timestamp\r\n\t\t\t})),\r\n\t\t\t...(event ? { event: event } : {}),\r\n\t\t\tchat_id: chatId,\r\n\t\t\tsession_id: $socket?.id,\r\n\t\t\tid: responseMessageId\r\n\t\t}).catch((error) => {\r\n\t\t\ttoast.error(error);\r\n\t\t\tmessages.at(-1).error = { content: error };\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (res !== null) {\r\n\t\t\t// Update chat history with the new messages\r\n\t\t\tfor (const message of res.messages) {\r\n\t\t\t\thistory.messages[message.id] = {\r\n\t\t\t\t\t...history.messages[message.id],\r\n\t\t\t\t\t...(history.messages[message.id].content !== message.content\r\n\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\r\n\t\t\t\t\t\t: {}),\r\n\t\t\t\t\t...message\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($chatId == chatId) {\r\n\t\t\tif (!$temporaryChatEnabled) {\r\n\t\t\t\tchat = await updateChatById(localStorage.token, chatId, {\r\n\t\t\t\t\tmodels: selectedModels,\r\n\t\t\t\t\tmessages: messages,\r\n\t\t\t\t\thistory: history,\r\n\t\t\t\t\tparams: params,\r\n\t\t\t\t\tfiles: chatFiles\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcurrentChatPage.set(1);\r\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst getChatEventEmitter = async (modelId: string, chatId: string = '') => {\r\n\t\treturn setInterval(() => {\r\n\t\t\t$socket?.emit('usage', {\r\n\t\t\t\taction: 'chat',\r\n\t\t\t\tmodel: modelId,\r\n\t\t\t\tchat_id: chatId\r\n\t\t\t});\r\n\t\t}, 1000);\r\n\t};\r\n\r\n\t//////////////////////////\r\n\t// Chat functions\r\n\t//////////////////////////\r\n\r\n\tconst submitPrompt = async (userPrompt, { _raw = false } = {}) => {\r\n\t\tlet _responses = [];\r\n\t\tconsole.log('submitPrompt', $chatId);\r\n\r\n\t\tselectedModels = selectedModels.map((modelId) =>\r\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\r\n\t\t);\r\n\r\n\t\tif (selectedModels.includes('')) {\r\n\t\t\ttoast.error($i18n.t('Model not selected'));\r\n\t\t} else if (messages.length != 0 && messages.at(-1).done != true) {\r\n\t\t\t// Response not done\r\n\t\t\tconsole.log('wait');\r\n\t\t} else if (messages.length != 0 && messages.at(-1).error) {\r\n\t\t\t// Error in response\r\n\t\t\ttoast.error(\r\n\t\t\t\t$i18n.t(\r\n\t\t\t\t\t`Oops! There was an error in the previous response. Please try again or contact admin.`\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t} else if (\r\n\t\t\tfiles.length > 0 &&\r\n\t\t\tfiles.filter((file) => file.type !== 'image' && file.status !== 'processed').length > 0\r\n\t\t) {\r\n\t\t\t// Upload not done\r\n\t\t\ttoast.error(\r\n\t\t\t\t$i18n.t(\r\n\t\t\t\t\t`Oops! Hold tight! Your files are still in the processing oven. We're cooking them up to perfection. Please be patient and we'll let you know once they're ready.`\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t} else if (\r\n\t\t\t($config?.file?.max_count ?? null) !== null &&\r\n\t\t\tfiles.length + chatFiles.length > $config?.file?.max_count\r\n\t\t) {\r\n\t\t\tconsole.log(chatFiles.length, files.length);\r\n\t\t\ttoast.error(\r\n\t\t\t\t$i18n.t(`You can only chat with a maximum of {{maxCount}} file(s) at a time.`, {\r\n\t\t\t\t\tmaxCount: $config?.file?.max_count\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\t// Reset chat input textarea\r\n\t\t\tconst chatTextAreaElement = document.getElementById('chat-textarea');\r\n\r\n\t\t\tif (chatTextAreaElement) {\r\n\t\t\t\tchatTextAreaElement.value = '';\r\n\t\t\t\tchatTextAreaElement.style.height = '';\r\n\t\t\t}\r\n\r\n\t\t\tconst _files = JSON.parse(JSON.stringify(files));\r\n\t\t\tchatFiles.push(..._files.filter((item) => ['doc', 'file', 'collection'].includes(item.type)));\r\n\t\t\tchatFiles = chatFiles.filter(\r\n\t\t\t\t// Remove duplicates\r\n\t\t\t\t(item, index, array) =>\r\n\t\t\t\t\tarray.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) === index\r\n\t\t\t);\r\n\r\n\t\t\tfiles = [];\r\n\r\n\t\t\tprompt = '';\r\n\r\n\t\t\t// Create user message\r\n\t\t\tlet userMessageId = uuidv4();\r\n\t\t\tlet userMessage = {\r\n\t\t\t\tid: userMessageId,\r\n\t\t\t\tparentId: messages.length !== 0 ? messages.at(-1).id : null,\r\n\t\t\t\tchildrenIds: [],\r\n\t\t\t\trole: 'user',\r\n\t\t\t\tcontent: userPrompt,\r\n\t\t\t\tfiles: _files.length > 0 ? _files : undefined,\r\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000), // Unix epoch\r\n\t\t\t\tmodels: selectedModels\r\n\t\t\t};\r\n\r\n\t\t\t// Add message to history and Set currentId to messageId\r\n\t\t\thistory.messages[userMessageId] = userMessage;\r\n\t\t\thistory.currentId = userMessageId;\r\n\r\n\t\t\t// Append messageId to childrenIds of parent message\r\n\t\t\tif (messages.length !== 0) {\r\n\t\t\t\thistory.messages[messages.at(-1).id].childrenIds.push(userMessageId);\r\n\t\t\t}\r\n\r\n\t\t\t// Wait until history/message have been updated\r\n\t\t\tawait tick();\r\n\t\t\t_responses = await sendPrompt(userPrompt, userMessageId, { newChat: true });\r\n\t\t}\r\n\r\n\t\treturn _responses;\r\n\t};\r\n\r\n\tconst sendPrompt = async (\r\n\t\tprompt: string,\r\n\t\tparentId: string,\r\n\t\t{ modelId = null, modelIdx = null, newChat = false } = {}\r\n\t) => {\r\n\t\tlet _responses: string[] = [];\r\n\r\n\t\t// If modelId is provided, use it, else use selected model\r\n\t\tlet selectedModelIds = modelId\r\n\t\t\t? [modelId]\r\n\t\t\t: atSelectedModel !== undefined\r\n\t\t\t\t? [atSelectedModel.id]\r\n\t\t\t\t: selectedModels;\r\n\r\n\t\t// Create response messages for each selected model\r\n\t\tconst responseMessageIds: Record<PropertyKey, string> = {};\r\n\t\tfor (const [_modelIdx, modelId] of selectedModelIds.entries()) {\r\n\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\r\n\r\n\t\t\tif (model) {\r\n\t\t\t\tlet responseMessageId = uuidv4();\r\n\t\t\t\tlet responseMessage = {\r\n\t\t\t\t\tparentId: parentId,\r\n\t\t\t\t\tid: responseMessageId,\r\n\t\t\t\t\tchildrenIds: [],\r\n\t\t\t\t\trole: 'assistant',\r\n\t\t\t\t\tcontent: '',\r\n\t\t\t\t\tmodel: model.id,\r\n\t\t\t\t\tmodelName: model.name ?? model.id,\r\n\t\t\t\t\tmodelIdx: modelIdx ? modelIdx : _modelIdx,\r\n\t\t\t\t\tuserContext: null,\r\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Add message to history and Set currentId to messageId\r\n\t\t\t\thistory.messages[responseMessageId] = responseMessage;\r\n\t\t\t\thistory.currentId = responseMessageId;\r\n\r\n\t\t\t\t// Append messageId to childrenIds of parent message\r\n\t\t\t\tif (parentId !== null) {\r\n\t\t\t\t\thistory.messages[parentId].childrenIds = [\r\n\t\t\t\t\t\t...history.messages[parentId].childrenIds,\r\n\t\t\t\t\t\tresponseMessageId\r\n\t\t\t\t\t];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresponseMessageIds[`${modelId}-${modelIdx ? modelIdx : _modelIdx}`] = responseMessageId;\r\n\t\t\t}\r\n\t\t}\r\n\t\tawait tick();\r\n\r\n\t\t// Create new chat if only one message in messages\r\n\t\tif (newChat && messages.length == 2) {\r\n\t\t\tif (!$temporaryChatEnabled) {\r\n\t\t\t\tchat = await createNewChat(localStorage.token, {\r\n\t\t\t\t\tid: $chatId,\r\n\t\t\t\t\ttitle: $i18n.t('New Chat'),\r\n\t\t\t\t\tmodels: selectedModels,\r\n\t\t\t\t\tsystem: $settings.system ?? undefined,\r\n\t\t\t\t\tparams: params,\r\n\t\t\t\t\tmessages: messages,\r\n\t\t\t\t\thistory: history,\r\n\t\t\t\t\ttags: [],\r\n\t\t\t\t\ttimestamp: Date.now()\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcurrentChatPage.set(1);\r\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\r\n\t\t\t\tawait chatId.set(chat.id);\r\n\t\t\t} else {\r\n\t\t\t\tawait chatId.set('local');\r\n\t\t\t}\r\n\t\t\tawait tick();\r\n\t\t}\r\n\r\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\r\n\r\n\t\tawait Promise.all(\r\n\t\t\tselectedModelIds.map(async (modelId, _modelIdx) => {\r\n\t\t\t\tconsole.log('modelId', modelId);\r\n\t\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\r\n\r\n\t\t\t\tif (model) {\r\n\t\t\t\t\t// If there are image files, check if model is vision capable\r\n\t\t\t\t\tconst hasImages = messages.some((message) =>\r\n\t\t\t\t\t\tmessage.files?.some((file) => file.type === 'image')\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif (hasImages && !(model.info?.meta?.capabilities?.vision ?? true)) {\r\n\t\t\t\t\t\ttoast.error(\r\n\t\t\t\t\t\t\t$i18n.t('Model {{modelName}} is not vision capable', {\r\n\t\t\t\t\t\t\t\tmodelName: model.name ?? model.id\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet responseMessageId =\r\n\t\t\t\t\t\tresponseMessageIds[`${modelId}-${modelIdx ? modelIdx : _modelIdx}`];\r\n\t\t\t\t\tlet responseMessage = history.messages[responseMessageId];\r\n\r\n\t\t\t\t\tlet userContext = null;\r\n\t\t\t\t\tif ($settings?.memory ?? false) {\r\n\t\t\t\t\t\tif (userContext === null) {\r\n\t\t\t\t\t\t\tconst res = await queryMemory(localStorage.token, prompt).catch((error) => {\r\n\t\t\t\t\t\t\t\ttoast.error(error);\r\n\t\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tif (res) {\r\n\t\t\t\t\t\t\t\tif (res.documents[0].length > 0) {\r\n\t\t\t\t\t\t\t\t\tuserContext = res.documents[0].reduce((acc, doc, index) => {\r\n\t\t\t\t\t\t\t\t\t\tconst createdAtTimestamp = res.metadatas[0][index].created_at;\r\n\t\t\t\t\t\t\t\t\t\tconst createdAtDate = new Date(createdAtTimestamp * 1000)\r\n\t\t\t\t\t\t\t\t\t\t\t.toISOString()\r\n\t\t\t\t\t\t\t\t\t\t\t.split('T')[0];\r\n\t\t\t\t\t\t\t\t\t\treturn `${acc}${index + 1}. [${createdAtDate}]. ${doc}\\n`;\r\n\t\t\t\t\t\t\t\t\t}, '');\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tconsole.log(userContext);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresponseMessage.userContext = userContext;\r\n\r\n\t\t\t\t\tconst chatEventEmitter = await getChatEventEmitter(model.id, _chatId);\r\n\t\t\t\t\tif (webSearchEnabled) {\r\n\t\t\t\t\t\tawait getWebSearchResults(model.id, parentId, responseMessageId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet _response = null;\r\n\t\t\t\t\tif (model?.owned_by === 'openai') {\r\n\t\t\t\t\t\t_response = await sendPromptOpenAI(model, prompt, responseMessageId, _chatId);\r\n\t\t\t\t\t} else if (model) {\r\n\t\t\t\t\t\t_response = await sendPromptOllama(model, prompt, responseMessageId, _chatId);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_responses.push(_response);\r\n\r\n\t\t\t\t\tif (chatEventEmitter) clearInterval(chatEventEmitter);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tcurrentChatPage.set(1);\r\n\t\tchats.set(await getChatList(localStorage.token, $currentChatPage));\r\n\r\n\t\treturn _responses;\r\n\t};\r\n\r\n\tconst sendPromptOllama = async (model, userPrompt, responseMessageId, _chatId) => {\r\n\t\tlet _response: string | null = null;\r\n\r\n\t\tconst responseMessage = history.messages[responseMessageId];\r\n\t\tconst userMessage = history.messages[responseMessage.parentId];\r\n\r\n\t\t// Wait until history/message have been updated\r\n\t\tawait tick();\r\n\r\n\t\t// Scroll down\r\n\t\tscrollToBottom();\r\n\r\n\t\tconst messagesBody = [\r\n\t\t\tparams?.system || $settings.system || (responseMessage?.userContext ?? null)\r\n\t\t\t\t? {\r\n\t\t\t\t\t\trole: 'system',\r\n\t\t\t\t\t\tcontent: `${promptTemplate(\r\n\t\t\t\t\t\t\tparams?.system ?? $settings?.system ?? '',\r\n\t\t\t\t\t\t\t$user.name,\r\n\t\t\t\t\t\t\t$settings?.userLocation\r\n\t\t\t\t\t\t\t\t? await getAndUpdateUserLocation(localStorage.token)\r\n\t\t\t\t\t\t\t\t: undefined\r\n\t\t\t\t\t\t)}${\r\n\t\t\t\t\t\t\t(responseMessage?.userContext ?? null)\r\n\t\t\t\t\t\t\t\t? `\\n\\nUser Context:\\n${responseMessage?.userContext ?? ''}`\r\n\t\t\t\t\t\t\t\t: ''\r\n\t\t\t\t\t\t}`\r\n\t\t\t\t\t}\r\n\t\t\t\t: undefined,\r\n\t\t\t...messages\r\n\t\t]\r\n\t\t\t.filter((message) => message?.content?.trim())\r\n\t\t\t.map((message) => {\r\n\t\t\t\t// Prepare the base message object\r\n\t\t\t\tconst baseMessage = {\r\n\t\t\t\t\trole: message.role,\r\n\t\t\t\t\tcontent: message.content\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Extract and format image URLs if any exist\r\n\t\t\t\tconst imageUrls = message.files\r\n\t\t\t\t\t?.filter((file) => file.type === 'image')\r\n\t\t\t\t\t.map((file) => file.url.slice(file.url.indexOf(',') + 1));\r\n\r\n\t\t\t\t// Add images array only if it contains elements\r\n\t\t\t\tif (imageUrls && imageUrls.length > 0 && message.role === 'user') {\r\n\t\t\t\t\tbaseMessage.images = imageUrls;\r\n\t\t\t\t}\r\n\t\t\t\treturn baseMessage;\r\n\t\t\t});\r\n\r\n\t\tlet lastImageIndex = -1;\r\n\r\n\t\t// Find the index of the last object with images\r\n\t\tmessagesBody.forEach((item, index) => {\r\n\t\t\tif (item.images) {\r\n\t\t\t\tlastImageIndex = index;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Remove images from all but the last one\r\n\t\tmessagesBody.forEach((item, index) => {\r\n\t\t\tif (index !== lastImageIndex) {\r\n\t\t\t\tdelete item.images;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tlet files = JSON.parse(JSON.stringify(chatFiles));\r\n\t\tif (model?.info?.meta?.knowledge ?? false) {\r\n\t\t\t// Only initialize and add status if knowledge exists\r\n\t\t\tresponseMessage.statusHistory = [\r\n\t\t\t\t{\r\n\t\t\t\t\taction: 'knowledge_search',\r\n\t\t\t\t\tdescription: $i18n.t(`Searching Knowledge for \"{{searchQuery}}\"`, {\r\n\t\t\t\t\t\tsearchQuery: userMessage.content\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tdone: false\r\n\t\t\t\t}\r\n\t\t\t];\r\n\t\t\tfiles.push(...model.info.meta.knowledge);\r\n\t\t\tmessages = messages; // Trigger Svelte update\r\n\t\t}\r\n\t\tfiles.push(\r\n\t\t\t...(userMessage?.files ?? []).filter((item) =>\r\n\t\t\t\t['doc', 'file', 'collection'].includes(item.type)\r\n\t\t\t),\r\n\t\t\t...(responseMessage?.files ?? []).filter((item) => ['web_search_results'].includes(item.type))\r\n\t\t);\r\n\r\n\t\tscrollToBottom();\r\n\r\n\t\teventTarget.dispatchEvent(\r\n\t\t\tnew CustomEvent('chat:start', {\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tid: responseMessageId\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tawait tick();\r\n\r\n\t\tconst [res, controller] = await generateChatCompletion(localStorage.token, {\r\n\t\t\tstream: true,\r\n\t\t\tmodel: model.id,\r\n\t\t\tmessages: messagesBody,\r\n\t\t\toptions: {\r\n\t\t\t\t...{ ...($settings?.params ?? {}), ...params },\r\n\t\t\t\tstop:\r\n\t\t\t\t\t(params?.stop ?? $settings?.params?.stop ?? undefined)\r\n\t\t\t\t\t\t? (params?.stop.split(',').map((token) => token.trim()) ?? $settings.params.stop).map(\r\n\t\t\t\t\t\t\t\t(str) => decodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t: undefined,\r\n\t\t\t\tnum_predict: params?.max_tokens ?? $settings?.params?.max_tokens ?? undefined,\r\n\t\t\t\trepeat_penalty:\r\n\t\t\t\t\tparams?.frequency_penalty ?? $settings?.params?.frequency_penalty ?? undefined\r\n\t\t\t},\r\n\t\t\tformat: $settings.requestFormat ?? undefined,\r\n\t\t\tkeep_alive: $settings.keepAlive ?? undefined,\r\n\t\t\ttool_ids: selectedToolIds.length > 0 ? selectedToolIds : undefined,\r\n\t\t\tfiles: files.length > 0 ? files : undefined,\r\n\t\t\tsession_id: $socket?.id,\r\n\t\t\tchat_id: $chatId,\r\n\t\t\tid: responseMessageId\r\n\t\t});\r\n\r\n\t\tif (res && res.ok) {\r\n\t\t\tconsole.log('controller', controller);\r\n\r\n\t\t\tconst reader = res.body\r\n\t\t\t\t.pipeThrough(new TextDecoderStream())\r\n\t\t\t\t.pipeThrough(splitStream('\\n'))\r\n\t\t\t\t.getReader();\r\n\r\n\t\t\twhile (true) {\r\n\t\t\t\tconst { value, done } = await reader.read();\r\n\t\t\t\tif (done || stopResponseFlag || _chatId !== $chatId) {\r\n\t\t\t\t\tresponseMessage.done = true;\r\n\t\t\t\t\tmessages = messages;\r\n\r\n\t\t\t\t\tif (stopResponseFlag) {\r\n\t\t\t\t\t\tcontroller.abort('User: Stop Response');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst messages = createMessagesList(responseMessageId);\r\n\t\t\t\t\t\tawait chatCompletedHandler(_chatId, model.id, responseMessageId, messages);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_response = responseMessage.content;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet lines = value.split('\\n');\r\n\r\n\t\t\t\t\tfor (const line of lines) {\r\n\t\t\t\t\t\tif (line !== '') {\r\n\t\t\t\t\t\t\tconsole.log(line);\r\n\t\t\t\t\t\t\tlet data = JSON.parse(line);\r\n\r\n\t\t\t\t\t\t\tif ('citations' in data) {\r\n\t\t\t\t\t\t\t\tresponseMessage.citations = data.citations;\r\n\t\t\t\t\t\t\t\t// Only remove status if it was initially set\r\n\t\t\t\t\t\t\t\tif (model?.info?.meta?.knowledge ?? false) {\r\n\t\t\t\t\t\t\t\t\tresponseMessage.statusHistory = responseMessage.statusHistory.filter(\r\n\t\t\t\t\t\t\t\t\t\t(status) => status.action !== 'knowledge_search'\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ('detail' in data) {\r\n\t\t\t\t\t\t\t\tthrow data;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (data.done == false) {\r\n\t\t\t\t\t\t\t\tif (responseMessage.content == '' && data.message.content == '\\n') {\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tresponseMessage.content += data.message.content;\r\n\r\n\t\t\t\t\t\t\t\t\tif (navigator.vibrate && ($settings?.hapticFeedback ?? false)) {\r\n\t\t\t\t\t\t\t\t\t\tnavigator.vibrate(5);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tconst messageContentParts = getMessageContentParts(\r\n\t\t\t\t\t\t\t\t\t\tresponseMessage.content,\r\n\t\t\t\t\t\t\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\tmessageContentParts.pop();\r\n\r\n\t\t\t\t\t\t\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\r\n\t\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\t\tmessageContentParts.length > 0 &&\r\n\t\t\t\t\t\t\t\t\t\tmessageContentParts[messageContentParts.length - 1] !==\r\n\t\t\t\t\t\t\t\t\t\t\tresponseMessage.lastSentence\r\n\t\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\t\tresponseMessage.lastSentence =\r\n\t\t\t\t\t\t\t\t\t\t\tmessageContentParts[messageContentParts.length - 1];\r\n\t\t\t\t\t\t\t\t\t\teventTarget.dispatchEvent(\r\n\t\t\t\t\t\t\t\t\t\t\tnew CustomEvent('chat', {\r\n\t\t\t\t\t\t\t\t\t\t\t\tdetail: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: responseMessageId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontent: messageContentParts[messageContentParts.length - 1]\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tmessages = messages;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tresponseMessage.done = true;\r\n\r\n\t\t\t\t\t\t\t\tif (responseMessage.content == '') {\r\n\t\t\t\t\t\t\t\t\tresponseMessage.error = {\r\n\t\t\t\t\t\t\t\t\t\tcode: 400,\r\n\t\t\t\t\t\t\t\t\t\tcontent: `Oops! No text generated from Ollama, Please try again.`\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tresponseMessage.context = data.context ?? null;\r\n\t\t\t\t\t\t\t\tresponseMessage.info = {\r\n\t\t\t\t\t\t\t\t\ttotal_duration: data.total_duration,\r\n\t\t\t\t\t\t\t\t\tload_duration: data.load_duration,\r\n\t\t\t\t\t\t\t\t\tsample_count: data.sample_count,\r\n\t\t\t\t\t\t\t\t\tsample_duration: data.sample_duration,\r\n\t\t\t\t\t\t\t\t\tprompt_eval_count: data.prompt_eval_count,\r\n\t\t\t\t\t\t\t\t\tprompt_eval_duration: data.prompt_eval_duration,\r\n\t\t\t\t\t\t\t\t\teval_count: data.eval_count,\r\n\t\t\t\t\t\t\t\t\teval_duration: data.eval_duration\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\tmessages = messages;\r\n\r\n\t\t\t\t\t\t\t\tif ($settings.notificationEnabled && !document.hasFocus()) {\r\n\t\t\t\t\t\t\t\t\tconst notification = new Notification(`${model.id}`, {\r\n\t\t\t\t\t\t\t\t\t\tbody: responseMessage.content,\r\n\t\t\t\t\t\t\t\t\t\ticon: `${WEBUI_BASE_URL}/static/favicon.png`\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif ($settings?.responseAutoCopy ?? false) {\r\n\t\t\t\t\t\t\t\t\tcopyToClipboard(responseMessage.content);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif ($settings.responseAutoPlayback && !$showCallOverlay) {\r\n\t\t\t\t\t\t\t\t\tawait tick();\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById(`speak-button-${responseMessage.id}`)?.click();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t\tif ('detail' in error) {\r\n\t\t\t\t\t\ttoast.error(error.detail);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (autoScroll) {\r\n\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (res !== null) {\r\n\t\t\t\tconst error = await res.json();\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t\tif ('detail' in error) {\r\n\t\t\t\t\ttoast.error(error.detail);\r\n\t\t\t\t\tresponseMessage.error = { content: error.detail };\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoast.error(error.error);\r\n\t\t\t\t\tresponseMessage.error = { content: error.error };\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttoast.error(\r\n\t\t\t\t\t$i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, { provider: 'Ollama' })\r\n\t\t\t\t);\r\n\t\t\t\tresponseMessage.error = {\r\n\t\t\t\t\tcontent: $i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, {\r\n\t\t\t\t\t\tprovider: 'Ollama'\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tresponseMessage.done = true;\r\n\r\n\t\t\tif (responseMessage.statusHistory) {\r\n\t\t\t\tresponseMessage.statusHistory = responseMessage.statusHistory.filter(\r\n\t\t\t\t\t(status) => status.action !== 'knowledge_search'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tmessages = messages;\r\n\t\t}\r\n\t\tawait saveChatHandler(_chatId);\r\n\r\n\t\tstopResponseFlag = false;\r\n\t\tawait tick();\r\n\r\n\t\tlet lastMessageContentPart =\r\n\t\t\tgetMessageContentParts(\r\n\t\t\t\tresponseMessage.content,\r\n\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\r\n\t\t\t)?.at(-1) ?? '';\r\n\t\tif (lastMessageContentPart) {\r\n\t\t\teventTarget.dispatchEvent(\r\n\t\t\t\tnew CustomEvent('chat', {\r\n\t\t\t\t\tdetail: { id: responseMessageId, content: lastMessageContentPart }\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\teventTarget.dispatchEvent(\r\n\t\t\tnew CustomEvent('chat:finish', {\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tid: responseMessageId,\r\n\t\t\t\t\tcontent: responseMessage.content\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tif (autoScroll) {\r\n\t\t\tscrollToBottom();\r\n\t\t}\r\n\r\n\t\tif (messages.length == 2 && messages.at(1).content !== '' && selectedModels[0] === model.id) {\r\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\r\n\t\t\tconst _title = await generateChatTitle(userPrompt);\r\n\t\t\tawait setChatTitle(_chatId, _title);\r\n\t\t}\r\n\r\n\t\treturn _response;\r\n\t};\r\n\r\n\tconst sendPromptOpenAI = async (model, userPrompt, responseMessageId, _chatId) => {\r\n\t\tlet _response = null;\r\n\r\n\t\tconst responseMessage = history.messages[responseMessageId];\r\n\t\tconst userMessage = history.messages[responseMessage.parentId];\r\n\r\n\t\tlet files = JSON.parse(JSON.stringify(chatFiles));\r\n\t\tif (model?.info?.meta?.knowledge ?? false) {\r\n\t\t\t// Only initialize and add status if knowledge exists\r\n\t\t\tresponseMessage.statusHistory = [\r\n\t\t\t\t{\r\n\t\t\t\t\taction: 'knowledge_search',\r\n\t\t\t\t\tdescription: $i18n.t(`Searching Knowledge for \"{{searchQuery}}\"`, {\r\n\t\t\t\t\t\tsearchQuery: userMessage.content\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tdone: false\r\n\t\t\t\t}\r\n\t\t\t];\r\n\t\t\tfiles.push(...model.info.meta.knowledge);\r\n\t\t\tmessages = messages; // Trigger Svelte update\r\n\t\t}\r\n\t\tfiles.push(\r\n\t\t\t...(userMessage?.files ?? []).filter((item) =>\r\n\t\t\t\t['doc', 'file', 'collection'].includes(item.type)\r\n\t\t\t),\r\n\t\t\t...(responseMessage?.files ?? []).filter((item) => ['web_search_results'].includes(item.type))\r\n\t\t);\r\n\r\n\t\tscrollToBottom();\r\n\r\n\t\teventTarget.dispatchEvent(\r\n\t\t\tnew CustomEvent('chat:start', {\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tid: responseMessageId\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t\tawait tick();\r\n\r\n\t\ttry {\r\n\t\t\tconst [res, controller] = await generateOpenAIChatCompletion(\r\n\t\t\t\tlocalStorage.token,\r\n\t\t\t\t{\r\n\t\t\t\t\tstream: true,\r\n\t\t\t\t\tmodel: model.id,\r\n\t\t\t\t\tstream_options:\r\n\t\t\t\t\t\t(model.info?.meta?.capabilities?.usage ?? false)\r\n\t\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\t\tinclude_usage: true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\tmessages: [\r\n\t\t\t\t\t\tparams?.system || $settings.system || (responseMessage?.userContext ?? null)\r\n\t\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\t\trole: 'system',\r\n\t\t\t\t\t\t\t\t\tcontent: `${promptTemplate(\r\n\t\t\t\t\t\t\t\t\t\tparams?.system ?? $settings?.system ?? '',\r\n\t\t\t\t\t\t\t\t\t\t$user.name,\r\n\t\t\t\t\t\t\t\t\t\t$settings?.userLocation\r\n\t\t\t\t\t\t\t\t\t\t\t? await getAndUpdateUserLocation(localStorage.token)\r\n\t\t\t\t\t\t\t\t\t\t\t: undefined\r\n\t\t\t\t\t\t\t\t\t)}${\r\n\t\t\t\t\t\t\t\t\t\t(responseMessage?.userContext ?? null)\r\n\t\t\t\t\t\t\t\t\t\t\t? `\\n\\nUser Context:\\n${responseMessage?.userContext ?? ''}`\r\n\t\t\t\t\t\t\t\t\t\t\t: ''\r\n\t\t\t\t\t\t\t\t\t}`\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\t\t...messages\r\n\t\t\t\t\t]\r\n\t\t\t\t\t\t.filter((message) => message?.content?.trim())\r\n\t\t\t\t\t\t.map((message, idx, arr) => ({\r\n\t\t\t\t\t\t\trole: message.role,\r\n\t\t\t\t\t\t\t...((message.files?.filter((file) => file.type === 'image').length > 0 ?? false) &&\r\n\t\t\t\t\t\t\tmessage.role === 'user'\r\n\t\t\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\t\t\tcontent: [\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\t\t\t\t\t\ttext:\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tarr.length - 1 !== idx\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? message.content\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: (message?.raContent ?? message.content)\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t...message.files\r\n\t\t\t\t\t\t\t\t\t\t\t\t.filter((file) => file.type === 'image')\r\n\t\t\t\t\t\t\t\t\t\t\t\t.map((file) => ({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image_url',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\timage_url: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: file.url\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}))\r\n\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t: {\r\n\t\t\t\t\t\t\t\t\t\tcontent:\r\n\t\t\t\t\t\t\t\t\t\t\tarr.length - 1 !== idx\r\n\t\t\t\t\t\t\t\t\t\t\t\t? message.content\r\n\t\t\t\t\t\t\t\t\t\t\t\t: (message?.raContent ?? message.content)\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})),\r\n\t\t\t\t\tseed: params?.seed ?? $settings?.params?.seed ?? undefined,\r\n\t\t\t\t\tstop:\r\n\t\t\t\t\t\t(params?.stop ?? $settings?.params?.stop ?? undefined)\r\n\t\t\t\t\t\t\t? (params?.stop.split(',').map((token) => token.trim()) ?? $settings.params.stop).map(\r\n\t\t\t\t\t\t\t\t\t(str) => decodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\ttemperature: params?.temperature ?? $settings?.params?.temperature ?? undefined,\r\n\t\t\t\t\ttop_p: params?.top_p ?? $settings?.params?.top_p ?? undefined,\r\n\t\t\t\t\tfrequency_penalty:\r\n\t\t\t\t\t\tparams?.frequency_penalty ?? $settings?.params?.frequency_penalty ?? undefined,\r\n\t\t\t\t\tmax_tokens: params?.max_tokens ?? $settings?.params?.max_tokens ?? undefined,\r\n\t\t\t\t\ttool_ids: selectedToolIds.length > 0 ? selectedToolIds : undefined,\r\n\t\t\t\t\tfiles: files.length > 0 ? files : undefined,\r\n\t\t\t\t\tsession_id: $socket?.id,\r\n\t\t\t\t\tchat_id: $chatId,\r\n\t\t\t\t\tid: responseMessageId\r\n\t\t\t\t},\r\n\t\t\t\t`${WEBUI_BASE_URL}/api`\r\n\t\t\t);\r\n\r\n\t\t\t// Wait until history/message have been updated\r\n\t\t\tawait tick();\r\n\r\n\t\t\tscrollToBottom();\r\n\r\n\t\t\tif (res && res.ok && res.body) {\r\n\t\t\t\tconst textStream = await createOpenAITextStream(res.body, $settings.splitLargeChunks);\r\n\r\n\t\t\t\tfor await (const update of textStream) {\r\n\t\t\t\t\tconst { value, done, citations, error, usage } = update;\r\n\t\t\t\t\tif (error) {\r\n\t\t\t\t\t\tawait handleOpenAIError(error, null, model, responseMessage);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (done || stopResponseFlag || _chatId !== $chatId) {\r\n\t\t\t\t\t\tresponseMessage.done = true;\r\n\t\t\t\t\t\tmessages = messages;\r\n\r\n\t\t\t\t\t\tif (stopResponseFlag) {\r\n\t\t\t\t\t\t\tcontroller.abort('User: Stop Response');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst messages = createMessagesList(responseMessageId);\r\n\r\n\t\t\t\t\t\t\tawait chatCompletedHandler(_chatId, model.id, responseMessageId, messages);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_response = responseMessage.content;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (usage) {\r\n\t\t\t\t\t\tresponseMessage.info = { ...usage, openai: true };\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (citations) {\r\n\t\t\t\t\t\tresponseMessage.citations = citations;\r\n\t\t\t\t\t\t// Only remove status if it was initially set\r\n\t\t\t\t\t\tif (model?.info?.meta?.knowledge ?? false) {\r\n\t\t\t\t\t\t\tresponseMessage.statusHistory = responseMessage.statusHistory.filter(\r\n\t\t\t\t\t\t\t\t(status) => status.action !== 'knowledge_search'\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (responseMessage.content == '' && value == '\\n') {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresponseMessage.content += value;\r\n\r\n\t\t\t\t\t\tif (navigator.vibrate && ($settings?.hapticFeedback ?? false)) {\r\n\t\t\t\t\t\t\tnavigator.vibrate(5);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst messageContentParts = getMessageContentParts(\r\n\t\t\t\t\t\t\tresponseMessage.content,\r\n\t\t\t\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tmessageContentParts.pop();\r\n\r\n\t\t\t\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tmessageContentParts.length > 0 &&\r\n\t\t\t\t\t\t\tmessageContentParts[messageContentParts.length - 1] !== responseMessage.lastSentence\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tresponseMessage.lastSentence = messageContentParts[messageContentParts.length - 1];\r\n\t\t\t\t\t\t\teventTarget.dispatchEvent(\r\n\t\t\t\t\t\t\t\tnew CustomEvent('chat', {\r\n\t\t\t\t\t\t\t\t\tdetail: {\r\n\t\t\t\t\t\t\t\t\t\tid: responseMessageId,\r\n\t\t\t\t\t\t\t\t\t\tcontent: messageContentParts[messageContentParts.length - 1]\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tmessages = messages;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (autoScroll) {\r\n\t\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($settings.notificationEnabled && !document.hasFocus()) {\r\n\t\t\t\t\tconst notification = new Notification(`${model.id}`, {\r\n\t\t\t\t\t\tbody: responseMessage.content,\r\n\t\t\t\t\t\ticon: `${WEBUI_BASE_URL}/static/favicon.png`\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($settings.responseAutoCopy) {\r\n\t\t\t\t\tcopyToClipboard(responseMessage.content);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($settings.responseAutoPlayback && !$showCallOverlay) {\r\n\t\t\t\t\tawait tick();\r\n\r\n\t\t\t\t\tdocument.getElementById(`speak-button-${responseMessage.id}`)?.click();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tawait handleOpenAIError(null, res, model, responseMessage);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tawait handleOpenAIError(error, null, model, responseMessage);\r\n\t\t}\r\n\r\n\t\tawait saveChatHandler(_chatId);\r\n\r\n\t\tmessages = messages;\r\n\r\n\t\tstopResponseFlag = false;\r\n\t\tawait tick();\r\n\r\n\t\tlet lastMessageContentPart =\r\n\t\t\tgetMessageContentParts(\r\n\t\t\t\tresponseMessage.content,\r\n\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\r\n\t\t\t)?.at(-1) ?? '';\r\n\t\tif (lastMessageContentPart) {\r\n\t\t\teventTarget.dispatchEvent(\r\n\t\t\t\tnew CustomEvent('chat', {\r\n\t\t\t\t\tdetail: { id: responseMessageId, content: lastMessageContentPart }\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\teventTarget.dispatchEvent(\r\n\t\t\tnew CustomEvent('chat:finish', {\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tid: responseMessageId,\r\n\t\t\t\t\tcontent: responseMessage.content\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tif (autoScroll) {\r\n\t\t\tscrollToBottom();\r\n\t\t}\r\n\r\n\t\tif (messages.length == 2 && selectedModels[0] === model.id) {\r\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\r\n\r\n\t\t\tconst _title = await generateChatTitle(userPrompt);\r\n\t\t\tawait setChatTitle(_chatId, _title);\r\n\t\t}\r\n\r\n\t\treturn _response;\r\n\t};\r\n\r\n\tconst handleOpenAIError = async (error, res: Response | null, model, responseMessage) => {\r\n\t\tlet errorMessage = '';\r\n\t\tlet innerError;\r\n\r\n\t\tif (error) {\r\n\t\t\tinnerError = error;\r\n\t\t} else if (res !== null) {\r\n\t\t\tinnerError = await res.json();\r\n\t\t}\r\n\t\tconsole.error(innerError);\r\n\t\tif ('detail' in innerError) {\r\n\t\t\ttoast.error(innerError.detail);\r\n\t\t\terrorMessage = innerError.detail;\r\n\t\t} else if ('error' in innerError) {\r\n\t\t\tif ('message' in innerError.error) {\r\n\t\t\t\ttoast.error(innerError.error.message);\r\n\t\t\t\terrorMessage = innerError.error.message;\r\n\t\t\t} else {\r\n\t\t\t\ttoast.error(innerError.error);\r\n\t\t\t\terrorMessage = innerError.error;\r\n\t\t\t}\r\n\t\t} else if ('message' in innerError) {\r\n\t\t\ttoast.error(innerError.message);\r\n\t\t\terrorMessage = innerError.message;\r\n\t\t}\r\n\r\n\t\tresponseMessage.error = {\r\n\t\t\tcontent:\r\n\t\t\t\t$i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, {\r\n\t\t\t\t\tprovider: model.name ?? model.id\r\n\t\t\t\t}) +\r\n\t\t\t\t'\\n' +\r\n\t\t\t\terrorMessage\r\n\t\t};\r\n\t\tresponseMessage.done = true;\r\n\r\n\t\tif (responseMessage.statusHistory) {\r\n\t\t\tresponseMessage.statusHistory = responseMessage.statusHistory.filter(\r\n\t\t\t\t(status) => status.action !== 'knowledge_search'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tmessages = messages;\r\n\t};\r\n\r\n\tconst stopResponse = () => {\r\n\t\tstopResponseFlag = true;\r\n\t\tconsole.log('stopResponse');\r\n\t};\r\n\r\n\tconst regenerateResponse = async (message) => {\r\n\t\tconsole.log('regenerateResponse');\r\n\r\n\t\tif (messages.length != 0) {\r\n\t\t\tlet userMessage = history.messages[message.parentId];\r\n\t\t\tlet userPrompt = userMessage.content;\r\n\r\n\t\t\tif ((userMessage?.models ?? [...selectedModels]).length == 1) {\r\n\t\t\t\t// If user message has only one model selected, sendPrompt automatically selects it for regeneration\r\n\t\t\t\tawait sendPrompt(userPrompt, userMessage.id);\r\n\t\t\t} else {\r\n\t\t\t\t// If there are multiple models selected, use the model of the response message for regeneration\r\n\t\t\t\t// e.g. many model chat\r\n\t\t\t\tawait sendPrompt(userPrompt, userMessage.id, {\r\n\t\t\t\t\tmodelId: message.model,\r\n\t\t\t\t\tmodelIdx: message.modelIdx\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst continueGeneration = async () => {\r\n\t\tconsole.log('continueGeneration');\r\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\r\n\r\n\t\tif (messages.length != 0 && messages.at(-1).done == true) {\r\n\t\t\tconst responseMessage = history.messages[history.currentId];\r\n\t\t\tresponseMessage.done = false;\r\n\t\t\tawait tick();\r\n\r\n\t\t\tconst model = $models.filter((m) => m.id === responseMessage.model).at(0);\r\n\r\n\t\t\tif (model) {\r\n\t\t\t\tif (model?.owned_by === 'openai') {\r\n\t\t\t\t\tawait sendPromptOpenAI(\r\n\t\t\t\t\t\tmodel,\r\n\t\t\t\t\t\thistory.messages[responseMessage.parentId].content,\r\n\t\t\t\t\t\tresponseMessage.id,\r\n\t\t\t\t\t\t_chatId\r\n\t\t\t\t\t);\r\n\t\t\t\t} else\r\n\t\t\t\t\tawait sendPromptOllama(\r\n\t\t\t\t\t\tmodel,\r\n\t\t\t\t\t\thistory.messages[responseMessage.parentId].content,\r\n\t\t\t\t\t\tresponseMessage.id,\r\n\t\t\t\t\t\t_chatId\r\n\t\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\r\n\t\t}\r\n\t};\r\n\r\n\tconst generateChatTitle = async (userPrompt) => {\r\n\t\tif ($settings?.title?.auto ?? true) {\r\n\t\t\tconst title = await generateTitle(\r\n\t\t\t\tlocalStorage.token,\r\n\t\t\t\tselectedModels[0],\r\n\t\t\t\tuserPrompt,\r\n\t\t\t\t$chatId\r\n\t\t\t).catch((error) => {\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t\treturn 'New Chat';\r\n\t\t\t});\r\n\r\n\t\t\treturn title;\r\n\t\t} else {\r\n\t\t\treturn `${userPrompt}`;\r\n\t\t}\r\n\t};\r\n\r\n\tconst setChatTitle = async (_chatId, _title) => {\r\n\t\tif (_chatId === $chatId) {\r\n\t\t\ttitle = _title;\r\n\t\t}\r\n\r\n\t\tif (!$temporaryChatEnabled) {\r\n\t\t\tchat = await updateChatById(localStorage.token, _chatId, { title: _title });\r\n\r\n\t\t\tcurrentChatPage.set(1);\r\n\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\r\n\t\t}\r\n\t};\r\n\r\n\tconst getWebSearchResults = async (model: string, parentId: string, responseId: string) => {\r\n\t\tconst responseMessage = history.messages[responseId];\r\n\t\tconst userMessage = history.messages[parentId];\r\n\r\n\t\tresponseMessage.statusHistory = [\r\n\t\t\t{\r\n\t\t\t\tdone: false,\r\n\t\t\t\taction: 'web_search',\r\n\t\t\t\tdescription: $i18n.t('Generating search query')\r\n\t\t\t}\r\n\t\t];\r\n\t\tmessages = messages;\r\n\r\n\t\tconst prompt = userMessage.content;\r\n\t\tlet searchQuery = await generateSearchQuery(localStorage.token, model, messages, prompt).catch(\r\n\t\t\t(error) => {\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t\treturn prompt;\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tif (!searchQuery) {\r\n\t\t\ttoast.warning($i18n.t('No search query generated'));\r\n\t\t\tresponseMessage.statusHistory.push({\r\n\t\t\t\tdone: true,\r\n\t\t\t\terror: true,\r\n\t\t\t\taction: 'web_search',\r\n\t\t\t\tdescription: 'No search query generated'\r\n\t\t\t});\r\n\r\n\t\t\tmessages = messages;\r\n\t\t}\r\n\r\n\t\tresponseMessage.statusHistory.push({\r\n\t\t\tdone: false,\r\n\t\t\taction: 'web_search',\r\n\t\t\tdescription: $i18n.t(`Searching \"{{searchQuery}}\"`, { searchQuery })\r\n\t\t});\r\n\t\tmessages = messages;\r\n\r\n\t\tconst results = await runWebSearch(localStorage.token, searchQuery).catch((error) => {\r\n\t\t\tconsole.log(error);\r\n\t\t\ttoast.error(error);\r\n\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (results) {\r\n\t\t\tresponseMessage.statusHistory.push({\r\n\t\t\t\tdone: true,\r\n\t\t\t\taction: 'web_search',\r\n\t\t\t\tdescription: $i18n.t('Searched {{count}} sites', { count: results.filenames.length }),\r\n\t\t\t\tquery: searchQuery,\r\n\t\t\t\turls: results.filenames\r\n\t\t\t});\r\n\r\n\t\t\tif (responseMessage?.files ?? undefined === undefined) {\r\n\t\t\t\tresponseMessage.files = [];\r\n\t\t\t}\r\n\r\n\t\t\tresponseMessage.files.push({\r\n\t\t\t\tcollection_name: results.collection_name,\r\n\t\t\t\tname: searchQuery,\r\n\t\t\t\ttype: 'web_search_results',\r\n\t\t\t\turls: results.filenames\r\n\t\t\t});\r\n\r\n\t\t\tmessages = messages;\r\n\t\t} else {\r\n\t\t\tresponseMessage.statusHistory.push({\r\n\t\t\t\tdone: true,\r\n\t\t\t\terror: true,\r\n\t\t\t\taction: 'web_search',\r\n\t\t\t\tdescription: 'No search results found'\r\n\t\t\t});\r\n\t\t\tmessages = messages;\r\n\t\t}\r\n\t};\r\n\r\n\tconst getTags = async () => {\r\n\t\treturn await getTagsById(localStorage.token, $chatId).catch(async (error) => {\r\n\t\t\treturn [];\r\n\t\t});\r\n\t};\r\n\r\n\tconst saveChatHandler = async (_chatId) => {\r\n\t\tif ($chatId == _chatId) {\r\n\t\t\tif (!$temporaryChatEnabled) {\r\n\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\r\n\t\t\t\t\tmessages: messages,\r\n\t\t\t\t\thistory: history,\r\n\t\t\t\t\tmodels: selectedModels,\r\n\t\t\t\t\tparams: params,\r\n\t\t\t\t\tfiles: chatFiles\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcurrentChatPage.set(1);\r\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tconst mergeResponses = async (messageId, responses, _chatId) => {\r\n\t\tconsole.log('mergeResponses', messageId, responses);\r\n\t\tconst message = history.messages[messageId];\r\n\t\tconst mergedResponse = {\r\n\t\t\tstatus: true,\r\n\t\t\tcontent: ''\r\n\t\t};\r\n\t\tmessage.merged = mergedResponse;\r\n\t\tmessages = messages;\r\n\r\n\t\ttry {\r\n\t\t\tconst [res, controller] = await generateMoACompletion(\r\n\t\t\t\tlocalStorage.token,\r\n\t\t\t\tmessage.model,\r\n\t\t\t\thistory.messages[message.parentId].content,\r\n\t\t\t\tresponses\r\n\t\t\t);\r\n\r\n\t\t\tif (res && res.ok && res.body) {\r\n\t\t\t\tconst textStream = await createOpenAITextStream(res.body, $settings.splitLargeChunks);\r\n\t\t\t\tfor await (const update of textStream) {\r\n\t\t\t\t\tconst { value, done, citations, error, usage } = update;\r\n\t\t\t\t\tif (error || done) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (mergedResponse.content == '' && value == '\\n') {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmergedResponse.content += value;\r\n\t\t\t\t\t\tmessages = messages;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (autoScroll) {\r\n\t\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tawait saveChatHandler(_chatId);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(res);\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<svelte:head>\r\n\t<title>\r\n\t\t{title\r\n\t\t\t? `${title.length > 30 ? `${title.slice(0, 30)}...` : title} | ${$WEBUI_NAME}`\r\n\t\t\t: `${$WEBUI_NAME}`}\r\n\t</title>\r\n</svelte:head>\r\n\r\n<audio id=\"audioElement\" src=\"\" style=\"display: none;\" />\r\n\r\n<EventConfirmDialog\r\n\tbind:show={showEventConfirmation}\r\n\ttitle={eventConfirmationTitle}\r\n\tmessage={eventConfirmationMessage}\r\n\tinput={eventConfirmationInput}\r\n\tinputPlaceholder={eventConfirmationInputPlaceholder}\r\n\tinputValue={eventConfirmationInputValue}\r\n\ton:confirm={(e) => {\r\n\t\tif (e.detail) {\r\n\t\t\teventCallback(e.detail);\r\n\t\t} else {\r\n\t\t\teventCallback(true);\r\n\t\t}\r\n\t}}\r\n\ton:cancel={() => {\r\n\t\teventCallback(false);\r\n\t}}\r\n/>\r\n\r\n{#if !chatIdProp || (loaded && chatIdProp)}\r\n\t<div\r\n\t\tclass=\"h-screen max-h-[100dvh] {$showSidebar\r\n\t\t\t? 'md:max-w-[calc(100%-260px)]'\r\n\t\t\t: ''} w-full max-w-full flex flex-col\"\r\n\t>\r\n\t\t{#if $settings?.backgroundImageUrl ?? null}\r\n\t\t\t<div\r\n\t\t\t\tclass=\"absolute {$showSidebar\r\n\t\t\t\t\t? 'md:max-w-[calc(100%-260px)] md:translate-x-[260px]'\r\n\t\t\t\t\t: ''} top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat\"\r\n\t\t\t\tstyle=\"background-image: url({$settings.backgroundImageUrl})  \"\r\n\t\t\t/>\r\n\r\n\t\t\t<div\r\n\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-gradient-to-t from-white to-white/85 dark:from-gray-900 dark:to-[#171717]/90 z-0\"\r\n\t\t\t/>\r\n\t\t{/if}\r\n\r\n\t\t<Navbar\r\n\t\t\t{title}\r\n\t\t\tbind:selectedModels\r\n\t\t\tbind:showModelSelector\r\n\t\t\tbind:showControls\r\n\t\t\tshareEnabled={messages.length > 0}\r\n\t\t\t{chat}\r\n\t\t\t{initNewChat}\r\n\t\t/>\r\n\r\n\t\t{#if $banners.length > 0 && messages.length === 0 && !$chatId && selectedModels.length <= 1}\r\n\t\t\t<div\r\n\t\t\t\tclass=\"absolute top-[4.25rem] w-full {$showSidebar\r\n\t\t\t\t\t? 'md:max-w-[calc(100%-260px)]'\r\n\t\t\t\t\t: ''} {showControls ? 'lg:pr-[24rem]' : ''} z-20\"\r\n\t\t\t>\r\n\t\t\t\t<div class=\" flex flex-col gap-1 w-full\">\r\n\t\t\t\t\t{#each $banners.filter( (b) => (b.dismissible ? !JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]').includes(b.id) : true) ) as banner}\r\n\t\t\t\t\t\t<Banner\r\n\t\t\t\t\t\t\t{banner}\r\n\t\t\t\t\t\t\ton:dismiss={(e) => {\r\n\t\t\t\t\t\t\t\tconst bannerId = e.detail;\r\n\r\n\t\t\t\t\t\t\t\tlocalStorage.setItem(\r\n\t\t\t\t\t\t\t\t\t'dismissedBannerIds',\r\n\t\t\t\t\t\t\t\t\tJSON.stringify(\r\n\t\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t\tbannerId,\r\n\t\t\t\t\t\t\t\t\t\t\t...JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]')\r\n\t\t\t\t\t\t\t\t\t\t].filter((id) => $banners.find((b) => b.id === id))\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t{/each}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t{/if}\r\n\r\n\t\t<div class=\"flex flex-col flex-auto z-10\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\" pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full z-10 scrollbar-hidden {showControls\r\n\t\t\t\t\t? 'lg:pr-[24rem]'\r\n\t\t\t\t\t: ''}\"\r\n\t\t\t\tid=\"messages-container\"\r\n\t\t\t\tbind:this={messagesContainerElement}\r\n\t\t\t\ton:scroll={(e) => {\r\n\t\t\t\t\tautoScroll =\r\n\t\t\t\t\t\tmessagesContainerElement.scrollHeight - messagesContainerElement.scrollTop <=\r\n\t\t\t\t\t\tmessagesContainerElement.clientHeight + 5;\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<div class=\" h-full w-full flex flex-col {chatIdProp ? 'py-4' : 'pt-2 pb-4'}\">\r\n\t\t\t\t\t<Messages\r\n\t\t\t\t\t\tchatId={$chatId}\r\n\t\t\t\t\t\t{selectedModels}\r\n\t\t\t\t\t\t{processing}\r\n\t\t\t\t\t\tbind:history\r\n\t\t\t\t\t\tbind:messages\r\n\t\t\t\t\t\tbind:autoScroll\r\n\t\t\t\t\t\tbind:prompt\r\n\t\t\t\t\t\tbottomPadding={files.length > 0}\r\n\t\t\t\t\t\t{sendPrompt}\r\n\t\t\t\t\t\t{continueGeneration}\r\n\t\t\t\t\t\t{regenerateResponse}\r\n\t\t\t\t\t\t{mergeResponses}\r\n\t\t\t\t\t\t{chatActionHandler}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class={showControls ? 'lg:pr-[24rem]' : ''}>\r\n\t\t\t\t<MessageInput\r\n\t\t\t\t\tbind:files\r\n\t\t\t\t\tbind:prompt\r\n\t\t\t\t\tbind:autoScroll\r\n\t\t\t\t\tbind:selectedToolIds\r\n\t\t\t\t\tbind:webSearchEnabled\r\n\t\t\t\t\tbind:atSelectedModel\r\n\t\t\t\t\tavailableToolIds={selectedModelIds.reduce((a, e, i, arr) => {\r\n\t\t\t\t\t\tconst model = $models.find((m) => m.id === e);\r\n\t\t\t\t\t\tif (model?.info?.meta?.toolIds ?? false) {\r\n\t\t\t\t\t\t\treturn [...new Set([...a, ...model.info.meta.toolIds])];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn a;\r\n\t\t\t\t\t}, [])}\r\n\t\t\t\t\ttransparentBackground={$settings?.backgroundImageUrl ?? false}\r\n\t\t\t\t\t{selectedModels}\r\n\t\t\t\t\t{messages}\r\n\t\t\t\t\t{submitPrompt}\r\n\t\t\t\t\t{stopResponse}\r\n\t\t\t\t\ton:call={() => {\r\n\t\t\t\t\t\tshowControls = true;\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n\r\n<ChatControls\r\n\tmodels={selectedModelIds.reduce((a, e, i, arr) => {\r\n\t\tconst model = $models.find((m) => m.id === e);\r\n\t\tif (model) {\r\n\t\t\treturn [...a, model];\r\n\t\t}\r\n\t\treturn a;\r\n\t}, [])}\r\n\tbind:show={showControls}\r\n\tbind:chatFiles\r\n\tbind:params\r\n\tbind:files\r\n\t{submitPrompt}\r\n\t{stopResponse}\r\n\tmodelId={selectedModelIds?.at(0) ?? null}\r\n\tchatId={$chatId}\r\n\t{eventTarget}\r\n/>\r\n","<script lang=\"ts\">\r\n\timport { getContext } from 'svelte';\r\n\timport Modal from '../common/Modal.svelte';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let show = false;\r\n</script>\r\n\r\n<Modal bind:show>\r\n\t<div class=\"text-gray-700 dark:text-gray-100\">\r\n\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pt-4\">\r\n\t\t\t<div class=\" text-lg font-medium self-center\">{$i18n.t('Keyboard shortcuts')}</div>\r\n\t\t\t<button\r\n\t\t\t\tclass=\"self-center\"\r\n\t\t\t\ton:click={() => {\r\n\t\t\t\t\tshow = false;\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<svg\r\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\tclass=\"w-5 h-5\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<path\r\n\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</svg>\r\n\t\t\t</button>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"flex flex-col md:flex-row w-full p-5 md:space-x-4 dark:text-gray-200\">\r\n\t\t\t<div class=\" flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6\">\r\n\t\t\t\t<div class=\"flex flex-col space-y-3 w-full self-start\">\r\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\r\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Open new chat')}</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tCtrl/\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tShift\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tO\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\r\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Focus chat input')}</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tShift\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tEsc\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\r\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Copy last code block')}</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tCtrl/\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tShift\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t;\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\r\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Copy last response')}</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tCtrl/\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tShift\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tC\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"flex flex-col space-y-3 w-full self-start\">\r\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\r\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Toggle settings')}</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tCtrl/\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t.\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\r\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Toggle sidebar')}</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tCtrl/\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tShift\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tS\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\r\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Delete chat')}</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tCtrl/\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tShift\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\r\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Show shortcuts')}</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tCtrl/\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t/\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div class=\" flex justify-between dark:text-gray-300 px-5\">\r\n\t\t\t<div class=\" text-lg font-medium self-center\">{$i18n.t('Input commands')}</div>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"flex flex-col md:flex-row w-full p-5 md:space-x-4 dark:text-gray-200\">\r\n\t\t\t<div class=\" flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6\">\r\n\t\t\t\t<div class=\"flex flex-col space-y-3 w-full self-start\">\r\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\r\n\t\t\t\t\t\t<div class=\" text-sm\">\r\n\t\t\t\t\t\t\t{$i18n.t('Attach file')}\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t#\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\r\n\t\t\t\t\t\t<div class=\" text-sm\">\r\n\t\t\t\t\t\t\t{$i18n.t('Add custom prompt')}\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t/\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\r\n\t\t\t\t\t\t<div class=\" text-sm\">\r\n\t\t\t\t\t\t\t{$i18n.t('Select model')}\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t@\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</Modal>\r\n\r\n<style>\r\n\tinput::-webkit-outer-spin-button,\r\n\tinput::-webkit-inner-spin-button {\r\n\t\t/* display: none; <- Crashes Chrome on hover */\r\n\t\t-webkit-appearance: none;\r\n\t\tmargin: 0; /* <-- Apparently some margin are still there even though it's hidden */\r\n\t}\r\n\r\n\t.tabs::-webkit-scrollbar {\r\n\t\tdisplay: none; /* for Chrome, Safari and Opera */\r\n\t}\r\n\r\n\t.tabs {\r\n\t\t-ms-overflow-style: none; /* IE and Edge */\r\n\t\tscrollbar-width: none; /* Firefox */\r\n\t}\r\n\r\n\tinput[type='number'] {\r\n\t\t-moz-appearance: textfield; /* Firefox */\r\n\t}\r\n</style>\r\n","<script lang=\"ts\">\r\n\texport let className = 'w-4 h-4';\r\n\texport let strokeWidth = '2';\r\n</script>\r\n\r\n<svg\r\n\txmlns=\"http://www.w3.org/2000/svg\"\r\n\tfill=\"none\"\r\n\tviewBox=\"0 0 24 24\"\r\n\tstroke-width={strokeWidth}\r\n\tstroke=\"currentColor\"\r\n\tclass={className}\r\n>\r\n\t<path\r\n\t\tstroke-linecap=\"round\"\r\n\t\tstroke-linejoin=\"round\"\r\n\t\td=\"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z\"\r\n\t/>\r\n</svg>\r\n","<script lang=\"ts\">\r\n\texport let className = 'size-4';\r\n\texport let strokeWidth = '2';\r\n</script>\r\n\r\n<svg\r\n\taria-hidden=\"true\"\r\n\txmlns=\"http://www.w3.org/2000/svg\"\r\n\tfill=\"currentColor\"\r\n\tviewBox=\"0 0 24 24\"\r\n\tstroke-width={strokeWidth}\r\n\tclass={className}\r\n>\r\n\t<path\r\n\t\tfill-rule=\"evenodd\"\r\n\t\td=\"M2 7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7Zm5.01 1H5v2.01h2.01V8Zm3 0H8v2.01h2.01V8Zm3 0H11v2.01h2.01V8Zm3 0H14v2.01h2.01V8Zm3 0H17v2.01h2.01V8Zm-12 3H5v2.01h2.01V11Zm3 0H8v2.01h2.01V11Zm3 0H11v2.01h2.01V11Zm3 0H14v2.01h2.01V11Zm3 0H17v2.01h2.01V11Zm-12 3H5v2.01h2.01V14ZM8 14l-.001 2 8.011.01V14H8Zm11.01 0H17v2.01h2.01V14Z\"\r\n\t\tclip-rule=\"evenodd\"\r\n\t/>\r\n</svg>\r\n","<script lang=\"ts\">\r\n\timport { DropdownMenu } from 'bits-ui';\r\n\timport { getContext } from 'svelte';\r\n\r\n\timport { showSettings } from '$lib/stores';\r\n\timport { flyAndScale } from '$lib/utils/transitions';\r\n\r\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\r\n\timport QuestionMarkCircle from '$lib/components/icons/QuestionMarkCircle.svelte';\r\n\timport Lifebuoy from '$lib/components/icons/Lifebuoy.svelte';\r\n\timport Keyboard from '$lib/components/icons/Keyboard.svelte';\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let showDocsHandler: Function;\r\n\texport let showShortcutsHandler: Function;\r\n\r\n\texport let onClose: Function = () => {};\r\n</script>\r\n\r\n<Dropdown\r\n\ton:change={(e) => {\r\n\t\tif (e.detail === false) {\r\n\t\t\tonClose();\r\n\t\t}\r\n\t}}\r\n>\r\n\t<slot />\r\n\r\n\t<div slot=\"content\">\r\n\t\t<DropdownMenu.Content\r\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\r\n\t\t\tsideOffset={4}\r\n\t\t\tside=\"top\"\r\n\t\t\talign=\"end\"\r\n\t\t\ttransition={flyAndScale}\r\n\t\t>\r\n\t\t\t<DropdownMenu.Item\r\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\tid=\"chat-share-button\"\r\n\t\t\t\ton:click={() => {\r\n\t\t\t\t\twindow.open('https://docs.openwebui.com', '_blank');\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<QuestionMarkCircle className=\"size-5\" />\r\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Documentation')}</div>\r\n\t\t\t</DropdownMenu.Item>\r\n\r\n\t\t\t<DropdownMenu.Item\r\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\tid=\"chat-share-button\"\r\n\t\t\t\ton:click={() => {\r\n\t\t\t\t\tshowShortcutsHandler();\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<Keyboard className=\"size-5\" />\r\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Keyboard shortcuts')}</div>\r\n\t\t\t</DropdownMenu.Item>\r\n\t\t</DropdownMenu.Content>\r\n\t</div>\r\n</Dropdown>\r\n","<script lang=\"ts\">\r\n\timport { onMount, tick, getContext } from 'svelte';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\timport ShortcutsModal from '../chat/ShortcutsModal.svelte';\r\n\timport Tooltip from '../common/Tooltip.svelte';\r\n\timport HelpMenu from './Help/HelpMenu.svelte';\r\n\r\n\tlet showShortcuts = false;\r\n</script>\r\n\r\n<div class=\" hidden lg:flex fixed bottom-0 right-0 px-2 py-2 z-20\">\r\n\t<button\r\n\t\tid=\"show-shortcuts-button\"\r\n\t\tclass=\"hidden\"\r\n\t\ton:click={() => {\r\n\t\t\tshowShortcuts = !showShortcuts;\r\n\t\t}}\r\n\t/>\r\n\r\n\t<HelpMenu\r\n\t\tshowDocsHandler={() => {\r\n\t\t\tshowShortcuts = !showShortcuts;\r\n\t\t}}\r\n\t\tshowShortcutsHandler={() => {\r\n\t\t\tshowShortcuts = !showShortcuts;\r\n\t\t}}\r\n\t>\r\n\t\t<Tooltip content={$i18n.t('Help')} placement=\"left\">\r\n\t\t\t<button\r\n\t\t\t\tclass=\"text-gray-600 dark:text-gray-300 bg-gray-300/20 size-5 flex items-center justify-center text-[0.7rem] rounded-full\"\r\n\t\t\t>\r\n\t\t\t\t?\r\n\t\t\t</button>\r\n\t\t</Tooltip>\r\n\t</HelpMenu>\r\n</div>\r\n\r\n<ShortcutsModal bind:show={showShortcuts} />\r\n"],"names":["ctx","disabled","$$props","open","onOpenChange","updateOption","ids","subOpen","setSubMenuCtx","next","$$invalidate","idValues","derived","$menuId","$triggerId","div_levels","insert_hydration","target","div","anchor","transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","id","side","align","sideOffset","alignOffset","collisionPadding","avoidCollisions","collisionBoundary","sameWidth","fitViewport","strategy","overlap","el","subMenu","getAttrs","getSubmenuCtx","dispatch","createDispatcher","attrs","$$value","builder","$subMenu","updateSubPositioning","subTrigger","options","getSubTrigger","disabledStore","$subTrigger","disabledAttrs","$disabledStore","createParser","onParse","isFirstChunk","buffer","startingPosition","startingFieldLength","eventId","eventName","data","reset","feed","chunk","hasBom","BOM","length","position","discardTrailingNewline","lineLength","fieldLength","character","index","parseEventStreamLine","lineBuffer","noValue","field","step","valueLength","value","retry","charCode","EventSourceParserStream","parser","controller","event","createOpenAITextStream","responseBody","splitLargeDeltas","eventStream","iterator","openAIStreamToIterator","streamLargeDeltasAsRandomChunks","reader","done","parsedData","_c","_b","_a","e","textStreamUpdate","content","chunkSize","sleep","ms","resolve","create_if_block_1","t0_value","t3_value","if_block0","create_if_block_4","if_block1","create_if_block_3","if_block2","create_if_block_2","attr","div0","div0_class_value","div5","append_hydration","div3","div1","div2","div4","current","dirty","set_data","t0","t3","div5_transition","create_bidirectional_transition","fade","button","create_if_block","createEventDispatcher","banner","dismissed","mounted","classNames","dismiss","onMount","svg","path0","path1","className","path","i","hr","each_blocks","t","t_value","tooltip_changes","t1","t1_value","show_if","flyAndScale","i18n","getContext","uploadFilesHandler","selectedToolIds","webSearchEnabled","tools","onClose","show","toolId","strokeWidth","set_style","t2_value","div6","t2","VISUALIZER_BUFFER_LENGTH","recording","loading","confirmed","durationSeconds","durationCounter","transcription","startDurationCounter","stopDurationCounter","formatSeconds","seconds","minutes","remainingSeconds","formattedSeconds","speechRecognition","mediaRecorder","audioChunks","MIN_DECIBELS","visualizerData","calculateRMS","sumSquares","normalizedValue","normalizeRMS","rms","scaledRMS","analyseAudio","stream","audioContext","audioStreamSource","analyser","bufferLength","domainData","timeDomainData","processFrame","rmsLevel","transcribeHandler","audioBlob","tick","file","blobToFile","res","transcribeAudio","error","toast","startRecording","$settings","$config","inactivityTimeout","timeoutId","transcript","confirmRecording","$i18n","stopRecording","overlayElement","div8","div7","t4","t4_value","button_class_value","files","prompt","command","selectedPromptIdx","filteredPrompts","selectUp","selectDown","confirmPrompt","text","clipboardText","err","clipboardItems","imageUrl","item","type","blob","chatInputElement","words","findWordIndices","word","promptIdx","$prompts","p","a","b","func","show_if_1","t6_value","t6","s","selectedIdx","filteredItems","filteredDocs","collections","findByName","obj","confirmSelect","doc","removeLastWordFromString","confirmSelectWeb","url","confirmSelectYoutube","docIdx","isValidHttpUrl","$documents","arr","tag","filteredCollections","collection","src_url_equal","img","img_src_value","img_alt_value","_d","filteredModels","model","modelIdx","$models","show_if_2","commandElement","uploadWeb","uploadWebToVectorDB","f","uploadYoutubeTranscription","uploadYoutubeTranscriptionToVectorDB","WEBUI_BASE_URL","span","textarea","textarea_placeholder_value","form","inputmenu_changes","fileitem_changes","create_if_block_6","button_disabled_value","create_if_block_8","create_if_block_7","input","transparentBackground","submitPrompt","stopResponse","autoScroll","atSelectedModel","selectedModels","chatTextAreaElement","filesInputElement","commandsElement","inputFiles","dragged","user","availableToolIds","messages","visionCapableModels","scrollToBottom","element","uploadFileHandler","fileItem","uploadedFile","uploadFile","WEBUI_API_BASE_URL","SUPPORTED_FILE_TYPE","SUPPORTED_FILE_EXTENSIONS","processFileItem","processDocToVectorDB","inputFilesHandler","dropZone","handleKeyDown","onDragOver","onDragLeave","onDrop","_inputFiles","response","func_1","fileIdx","func_2","$_user","$mobile","isCtrlPressed","commandsContainerElement","regenerateButton","userMessageElement","editButton","commandOptionButton","fullPrompt","clipboardData","track","showCallOverlay","m","selector_changes","showSetDefault","saveDefaultModel","it","settings","updateUserSettings","selectedModelIdx","tags","Tags","tags_changes","saveAs","fileSaver","shareEnabled","shareHandler","downloadHandler","chat","downloadTxt","_chat","chatText","message","downloadPdf","downloadChatAsPDF","downloadJSONExport","usermenu_changes","nav","initNewChat","title","$WEBUI_NAME","showModelSelector","showControls","showShareChatModal","showDownloadChatModal","showSidebar","$showSidebar","showArchivedChats","option","option_value_value","add_render_callback","select0","select1","option0","option1","tab","selectedId","valvesSpec","valves","debounceTimer","debounceSubmitHandler","submitHandler","getUserValves","getToolUserValvesById","getToolUserValvesSpecById","getFunctionUserValvesById","getFunctionUserValvesSpecById","property","updateToolUserValvesById","updateFunctionUserValvesById","select_value","set_input_value","hr0","hr1","models","chatFiles","params","devices","device","button0","button1","create_if_block_9","_f","_e","_i","_h","_g","style","circle0","circle1","circle2","video","canvas","create_if_block_5","eventTarget","chatId","modelId","wakeLock","assistantSpeaking","emoji","camera","cameraStream","chatStreaming","hasStartedSpeaking","audioStream","videoInputDevices","selectedVideoInputDeviceId","getVideoInputDevices","startCamera","startVideoStream","stopVideoStream","takeScreenshot","context","dataURL","stopCamera","_responses","stopRecordingCallback","_continue","$showCallOverlay","_audioChunks","stopAudioStream","lastSoundTime","stopAllAudio","finishedMessages","currentMessageId","currentUtterance","speakSpeechSynthesisHandler","voices","getVoicesLoop","voice","v","r","playAudio","audio","audioElement","audioAbortController","audioCache","emojiCache","fetchAudio","generateEmoji","synthesizeOpenAISpeech","blobUrl","monitorAndPlayAudio","signal","setWakeLock","chatStartHandler","chatEventHandler","chatFinishHandler","onDestroy","div1_intro","create_in_transition","fly","size","modalElement","isTopModal","modals","slide","largeScreen","mediaQuery","handleMediaQuery","messageinput_changes","each_value","ensure_array_like","chatcontrols_changes","processing","chatIdProp","loaded","stopResponseFlag","messagesContainerElement","showEventConfirmation","eventConfirmationTitle","eventConfirmationMessage","eventConfirmationInput","eventConfirmationInputPlaceholder","eventConfirmationInputValue","eventCallback","selectedModelIds","history","chatIdUnsubscriber","cb","$chatId","continueButton","onMessageHandler","inputElement","$socket","$temporaryChatEnabled","goto","$page","userSettings","getUserSettings","chatInput","loadChat","getChatById","getTags","chatContent","convertMessagesToHistory","createMessagesList","responseMessageId","chatCompletedHandler","mermaid","chatCompleted","updateChatById","currentChatPage","chats","getChatList","$currentChatPage","chatActionHandler","actionId","chatAction","getChatEventEmitter","userPrompt","_raw","_files","array","userMessageId","uuidv4","userMessage","sendPrompt","parentId","newChat","responseMessageIds","_modelIdx","responseMessage","createNewChat","_chatId","userContext","queryMemory","acc","createdAtTimestamp","createdAtDate","chatEventEmitter","getWebSearchResults","_response","sendPromptOpenAI","sendPromptOllama","messagesBody","promptTemplate","$user","getAndUpdateUserLocation","baseMessage","imageUrls","lastImageIndex","generateChatCompletion","token","str","splitStream","lines","line","status","messageContentParts","getMessageContentParts","notification","copyToClipboard","_j","saveChatHandler","lastMessageContentPart","_m","_l","_k","_title","generateChatTitle","setChatTitle","generateOpenAIChatCompletion","idx","textStream","update","citations","usage","handleOpenAIError","_o","_n","_p","_s","_r","_q","errorMessage","innerError","regenerateResponse","continueGeneration","generateTitle","responseId","searchQuery","generateSearchQuery","results","runWebSearch","getTagsById","mergeResponses","messageId","responses","mergedResponse","generateMoACompletion","bannerId","$banners","_messages","currentMessage","div68","div50","div49","div25","div12","div11","div18","div13","div17","div24","div19","div23","div48","div30","div26","div29","div36","div31","div35","div42","div37","div41","div47","div43","div46","div52","div51","div67","div66","div65","div56","div53","div55","div60","div57","div59","div64","div61","div63","t11","t11_value","t17","t17_value","t25","t25_value","t33","t33_value","t39","t39_value","t47","t47_value","t55","t55_value","t61","t61_value","t63","t63_value","t67","t67_value","t71","t71_value","showDocsHandler","showShortcutsHandler","showShortcuts"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4]}